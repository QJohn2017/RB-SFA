Notebook[{

Cell[CellGroupData[{
Cell[TextData[{
 StyleBox["RB-SFA: High Harmonic Generation in the Strong Field Approximation \
via ",
  FontSize->24],
 StyleBox["Mathematica",
  FontSize->24,
  FontSlant->"Italic"]
}], "Title"],

Cell["\[Copyright] Emilio Pisanty 2014-2016. Licensed under GPL and \
CC-BY-SA.", "Text"],

Cell[CellGroupData[{

Cell["Introduction", "Subchapter",
 CellTags->"Introduction"],

Cell[CellGroupData[{

Cell["Readme", "Subsection"],

Cell[TextData[{
 "RB-SFA is a compact and flexible ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 " package for calculating High Harmonic Generation emission within the \
Strong Field Approximation. It combines ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 "\[CloseCurlyQuote]s analytical integration capabilities with its numerical \
calculation capacities to offer a fast and user-friendly plug-and-play solver \
for calculating harmonic spectra and other properties. In addition, it can \
calculate first-order nondipole corrections to the SFA results to evaluate \
the effect of the driving laser\[CloseCurlyQuote]s magnetic field on harmonic \
spectra.\n\nThe name RB-SFA comes from its first application (as Rotating \
Bicircular High Harmonic Generation in the Strong field Approximation) but \
the code is general so RB-SFA just stands for itself now. This first \
application was used to calculate the polarization properties of the \
harmonics produced by multi-colour circularly polarized fields, as reported \
in the paper\n\n    Spin conservation in high-order-harmonic generation using \
bicircular fields. E. Pisanty, S. Sukiasyan and M. Ivanov. ",
 StyleBox[ButtonBox["Phys. Rev. A",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.90.043829"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.90.043829"],
  FontSlant->"Italic"],
 ButtonBox[" ",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.90.043829"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.90.043829"],
 StyleBox[ButtonBox["90",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.90.043829"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.90.043829"],
  FontWeight->"Bold"],
 ButtonBox[", 043829 (2014)",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.90.043829"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.90.043829"],
 ", ",
 ButtonBox["arXiv:1404.6242",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://arxiv.org/abs/1404.6242"], None},
  ButtonNote->"http://arxiv.org/abs/1404.6242"],
 ".\n\nThis code is dual-licensed under the ",
 ButtonBox["GPL",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://www.gnu.org/licenses/gpl-3.0.en.html"], None},
  ButtonNote->"http://www.gnu.org/licenses/gpl-3.0.en.html"],
 " and ",
 ButtonBox["CC-BY-SA",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["https://creativecommons.org/licenses/by-sa/4.0/"], None},
  ButtonNote->"https://creativecommons.org/licenses/by-sa/4.0/"],
 " licenses. If you use this code or its results in an academic publication, \
please cite the paper above or the GitHub repository where the latest version \
will always be available. An example citation is \n\n    E. Pisanty. RB-SFA: \
High Harmonic Generation in the Strong Field Approximation via ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 ". ",
 ButtonBox["https://github.com/episanty/RB-SFA",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["https://github.com/episanty/RB-SFA"], None},
  ButtonNote->"https://github.com/episanty/RB-SFA"],
 " (2014).\n\nThis software consists of this notebook, which contains the \
code and its documentation, a corresponding auto-generated package file. This \
notebook also contains a Usage and Examples section which explains how to use \
the code and documents the calculations used in the original publication."
}], "Text"]
}, Closed]],

Cell[CellGroupData[{

Cell["Specifications", "Subsection"],

Cell[TextData[{
 "This code calculates the harmonic dipole as per the original Lewenstein ",
 StyleBox["et al.",
  FontSlant->"Italic"],
 " paper,\n\n    M. Lewenstein, Ph. Balcou, M.Yu. Ivanov, A. L\
\[CloseCurlyQuote]Huillier and P.B. Corkum. Theory of high-harmonic \
generation by low-frequency laser fields.",
 StyleBox[" ",
  FontSlant->"Italic"],
 StyleBox[ButtonBox["Phys. Rev. A",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.49.2117"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.49.2117"],
  FontSlant->"Italic"],
 ButtonBox[" ",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.49.2117"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.49.2117"],
 StyleBox[ButtonBox["49",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.49.2117"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.49.2117"],
  FontWeight->"Bold"],
 ButtonBox[" no. 3, 2117 (1994).",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.49.2117"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.49.2117"],
 "\n    \nThe time-dependent dipole is given by\n\n          ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     StyleBox["D",
      FontWeight->"Bold"], "(", "t", ")"}], "=", 
    RowBox[{
     RowBox[{"\[ImaginaryI]", 
      RowBox[{
       SubsuperscriptBox["\[Integral]", "0", "t"], 
       RowBox[{
        RowBox[{"\[DifferentialD]", 
         RowBox[{"t", "'"}]}], 
        RowBox[{"\[Integral]", 
         RowBox[{
          RowBox[{
           SuperscriptBox["\[DifferentialD]", "3"], 
           StyleBox["p",
            FontWeight->"Bold"]}], " ", 
          RowBox[{
           StyleBox["d",
            FontWeight->"Bold"], "(", 
           RowBox[{
            StyleBox["\[Pi]",
             FontWeight->"Bold"], "(", 
            RowBox[{
             StyleBox["p",
              FontWeight->"Bold"], ",", "t"}], ")"}], ")"}], " ", "\[Times]", 
          " ", 
          RowBox[{
           RowBox[{
            StyleBox["F",
             FontWeight->"Bold"], "(", 
            RowBox[{"t", "'"}], ")"}], "\[CenterDot]", 
           RowBox[{
            StyleBox["d",
             FontWeight->"Bold"], "(", 
            RowBox[{
             StyleBox["\[Pi]",
              FontWeight->"Bold"], "(", 
             RowBox[{
              StyleBox["p",
               FontWeight->"Bold"], ",", 
              RowBox[{"t", "'"}]}], ")"}], ")"}]}], "\[Times]", 
          RowBox[{"exp", "[", 
           RowBox[{
            RowBox[{"-", "\[ImaginaryI]"}], " ", 
            RowBox[{"S", "(", 
             RowBox[{
              StyleBox["p",
               FontWeight->"Bold"], ",", "t", ",", 
              RowBox[{"t", "'"}]}], ")"}]}], "]"}]}]}]}]}]}], "+", 
     RowBox[{"c", ".", "c", "."}]}]}], TraditionalForm]]],
 "\n\nHere ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    StyleBox["F",
     FontWeight->"Bold"], "(", "t", ")"}], TraditionalForm]]],
 "is the time-dependent applied electric field, with vector potential ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    StyleBox["A",
     FontWeight->"Bold"], "(", "t", ")"}], TraditionalForm]]],
 "; the electron charge is taken to be ",
 Cell[BoxData[
  FormBox[
   RowBox[{"-", "1"}], TraditionalForm]]],
 ". The integration time ",
 Cell[BoxData[
  FormBox[
   RowBox[{"t", "'"}], TraditionalForm]]],
 " can be interpreted as the ionization time and the integration limit ",
 Cell[BoxData[
  FormBox["t", TraditionalForm]]],
 " represents the recollision time. (Upon applying the saddle-point \
approximation to the temporal integrals these notions apply exactly to the \
corresponding quantum orbits.) The ionization and recollision events are \
governed by the corresponding dipole matrix elements, which are taken for a \
hydrogenic 1s-type orbital with characteristic momentum \[Kappa] and \
ionization potential ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["I", "p"], "=", 
    RowBox[{
     FractionBox["1", "2"], 
     SuperscriptBox["\[Kappa]", "2"]}]}], TraditionalForm]]],
 ":\n\n    ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     StyleBox["d",
      FontWeight->"Bold"], "(", 
     StyleBox["p",
      FontWeight->"Bold"], ")"}], "=", 
    RowBox[{
     RowBox[{
      TemplateBox[{StyleBox["p", FontWeight -> "Bold"]},
       "Bra"], 
      OverscriptBox[
       StyleBox["d",
        FontWeight->"Bold"], "^"], 
      TemplateBox[{"g"},
       "Ket"]}], "=", 
     RowBox[{
      FractionBox[
       RowBox[{"8", "\[ImaginaryI]"}], "\[Pi]"], 
      FractionBox[
       RowBox[{
        SqrtBox[
         RowBox[{"2", 
          SuperscriptBox["\[Kappa]", "5"]}]], 
        StyleBox["p",
         FontWeight->"Bold"]}], 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           StyleBox["p",
            FontWeight->"Bold"], "2"], "+", 
          SuperscriptBox["\[Kappa]", "2"]}], ")"}], "3"]]}]}]}], 
   TraditionalForm]]],
 ".\n\n(Taken from B. Podolsky & L. Pauling. ",
 StyleBox[ButtonBox["Phys. Rev.",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRev.34.109"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRev.34.109"],
  FontSlant->"Italic"],
 ButtonBox[" ",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRev.34.109"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRev.34.109"],
 StyleBox[ButtonBox["34",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRev.34.109"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRev.34.109"],
  FontWeight->"Bold"],
 ButtonBox[" no. 1, 109 (1929)",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRev.34.109"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRev.34.109"],
 ".) The displaced momentum ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     StyleBox["\[Pi]",
      FontWeight->"Bold"], "(", 
     RowBox[{
      StyleBox["p",
       FontWeight->"Bold"], ",", "t"}], ")"}], "=", 
    RowBox[{
     StyleBox["p",
      FontWeight->"Bold"], "+", 
     RowBox[{
      StyleBox["A",
       FontWeight->"Bold"], "(", "t", ")"}]}]}], TraditionalForm]]],
 " is used to aid in the generalization to nondipole cases.\n\nThe action \n\n\
    ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"S", "(", 
     RowBox[{
      StyleBox["p",
       FontWeight->"Bold"], ",", "t", ",", 
      RowBox[{"t", "'"}]}], ")"}], "=", 
    RowBox[{
     SubsuperscriptBox["\[Integral]", 
      RowBox[{"t", "'"}], "t"], 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         FractionBox["1", "2"], 
         SuperscriptBox["\[Kappa]", "2"]}], "+", 
        RowBox[{
         FractionBox["1", "2"], 
         SuperscriptBox[
          RowBox[{
           StyleBox["\[Pi]",
            FontWeight->"Bold"], "(", 
           RowBox[{
            StyleBox["p",
             FontWeight->"Bold"], ",", "\[Tau]"}], ")"}], "2"]}]}], ")"}], 
      RowBox[{"\[DifferentialD]", "\[Tau]"}]}]}]}], TraditionalForm]]],
 " \n\nis the governing factor of the integral. It is highly oscillatory and \
must be dealt with carefully. The momentum integral is approximated using the \
saddle point method; this is valid and straightforward since there is always \
one unique saddle point,\n\n    ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     SubscriptBox[
      StyleBox["p",
       FontWeight->"Bold"], "s"], "(", 
     RowBox[{"t", ",", 
      RowBox[{"t", "'"}]}], ")"}], "=", 
    RowBox[{"-", 
     FractionBox[
      RowBox[{
       SubsuperscriptBox["\[Integral]", 
        RowBox[{"t", "'"}], "t"], 
       RowBox[{
        RowBox[{
         StyleBox["A",
          FontWeight->"Bold"], "(", 
         RowBox[{"t", "''"}], ")"}], 
        RowBox[{"\[DifferentialD]", 
         RowBox[{"t", "''"}]}]}]}], 
      RowBox[{"t", "-", 
       RowBox[{"t", "'"}]}]]}]}], TraditionalForm]]],
 ",\n    \nas long as the action\[CloseCurlyQuote]s dependence on the \
momentum is quadratic. After the momentum has been integrated via the saddle \
point method, the time-dependent dipole is given by\n\n          ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     StyleBox["D",
      FontWeight->"Bold"], "(", "t", ")"}], "=", 
    RowBox[{
     RowBox[{"\[ImaginaryI]", 
      RowBox[{
       SubsuperscriptBox["\[Integral]", "0", "t"], 
       RowBox[{
        RowBox[{"\[DifferentialD]", 
         RowBox[{"t", "'"}]}], 
        SuperscriptBox[
         RowBox[{"(", 
          FractionBox[
           RowBox[{"2", "\[Pi]"}], 
           RowBox[{"\[Epsilon]", "+", 
            RowBox[{"\[ImaginaryI]", "(", 
             RowBox[{"t", "-", 
              RowBox[{"t", "'"}]}], ")"}]}]], ")"}], 
         RowBox[{"3", "/", "2"}]], " ", 
        RowBox[{
         StyleBox["d",
          FontWeight->"Bold"], "(", 
         RowBox[{
          StyleBox["\[Pi]",
           FontWeight->"Bold"], "(", 
          RowBox[{
           RowBox[{
            SubscriptBox[
             StyleBox["p",
              FontWeight->"Bold"], "s"], "(", 
            RowBox[{"t", ",", 
             RowBox[{"t", "'"}]}], ")"}], ",", "t"}], ")"}], ")"}], " ", 
        "\[Times]", " ", 
        RowBox[{
         RowBox[{
          StyleBox["F",
           FontWeight->"Bold"], "(", 
          RowBox[{"t", "'"}], ")"}], "\[CenterDot]", 
         RowBox[{
          StyleBox["d",
           FontWeight->"Bold"], "(", 
          RowBox[{
           StyleBox["\[Pi]",
            FontWeight->"Bold"], "(", 
           RowBox[{
            RowBox[{
             SubscriptBox[
              StyleBox["p",
               FontWeight->"Bold"], "s"], "(", 
             RowBox[{"t", ",", 
              RowBox[{"t", "'"}]}], ")"}], ",", 
            RowBox[{"t", "'"}]}], ")"}], ")"}]}], "\[Times]", 
        RowBox[{"exp", "[", 
         RowBox[{
          RowBox[{"-", "\[ImaginaryI]"}], " ", 
          RowBox[{"S", "(", 
           RowBox[{
            RowBox[{
             StyleBox[
              SubscriptBox[
               StyleBox["p",
                FontWeight->"Bold"], 
               StyleBox["s",
                FontWeight->"Plain"]],
              FontWeight->"Bold"], "(", 
             RowBox[{"t", ",", 
              RowBox[{"t", "'"}]}], ")"}], ",", "t", ",", 
            RowBox[{"t", "'"}]}], ")"}]}], "]"}]}]}]}], "+", 
     RowBox[{"c", ".", "c", "."}]}]}], TraditionalForm]]],
 "\n          \nA regularization factor ",
 Cell[BoxData[
  FormBox["\[Epsilon]", TraditionalForm]]],
 " has been introduced to prevent divergence of the prefactor as ",
 Cell[BoxData[
  FormBox[
   RowBox[{"t", "'"}], TraditionalForm]]],
 " approaches ",
 Cell[BoxData[
  FormBox["t", TraditionalForm]]],
 ", representing the fact that at ",
 Cell[BoxData[
  FormBox[
   RowBox[{"t", "=", 
    RowBox[{"t", "'"}]}], TraditionalForm]]],
 " the ",
 Cell[BoxData[
  FormBox[
   StyleBox["p",
    FontWeight->"Bold"], TraditionalForm]]],
 " integral no longer has a quadratic exponent.\n\nThe integral is performed \
with respect to the excursion time ",
 Cell[BoxData[
  FormBox[
   RowBox[{"\[Tau]", "=", 
    RowBox[{"t", "-", 
     RowBox[{"t", "'"}]}]}], TraditionalForm]]],
 " for simplicity. To reduce integration time, a gating function ",
 Cell[BoxData[
  FormBox[
   RowBox[{"gate", "[", 
    RowBox[{"\[Omega]", " ", "\[Tau]"}], "]"}], TraditionalForm]]],
 " has been introduced, and the integration time has been cut short to a \
controllable length. This is physically reasonable as the wavepacket \
spreading (which scales as ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["\[Tau]", 
    RowBox[{
     RowBox[{"-", "3"}], "/", "2"}]], TraditionalForm]]],
 ") makes the contributions after the gate negligible.\n\nMore physically, \
supressing the contributions from large excursion times represents the fact \
that the extra-long trajectories they represent produce harmonics which are \
much harder to phase match (as their harmonic phase is very sensitively \
dependent on many factors) which means that they are rarely present in \
experimental spectra unless a concerted effort is performed to observe them."
}], "Text"]
}, Closed]],

Cell[CellGroupData[{

Cell["Quantum-orbit functions suite", "Subsection"],

Cell[TextData[{
 "The package also includes an experimental suite of functions for \
calculating spectra via quantum-orbit methods. That is, the goal is to \
calculate the Fourier transform directly,\n\n          ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     StyleBox["D",
      FontWeight->"Bold"], "(", "\[CapitalOmega]", ")"}], "=", 
    RowBox[{"\[ImaginaryI]", 
     RowBox[{
      SubsuperscriptBox["\[Integral]", 
       RowBox[{"-", "\[Infinity]"}], "\[Infinity]"], 
      RowBox[{
       RowBox[{"\[DifferentialD]", "t"}], 
       RowBox[{
        SubsuperscriptBox["\[Integral]", 
         RowBox[{"-", "\[Infinity]"}], "t"], 
        RowBox[{
         RowBox[{"\[DifferentialD]", 
          RowBox[{"t", "'"}]}], 
         SuperscriptBox[
          RowBox[{"(", 
           FractionBox[
            RowBox[{"2", "\[Pi]"}], 
            RowBox[{"\[Epsilon]", "+", 
             RowBox[{"\[ImaginaryI]", " ", "\[Tau]"}]}]], ")"}], 
          RowBox[{"3", "/", "2"}]], " ", 
         RowBox[{
          StyleBox["d",
           FontWeight->"Bold"], "(", 
          RowBox[{
           StyleBox["\[Pi]",
            FontWeight->"Bold"], "(", 
           RowBox[{
            RowBox[{
             SubscriptBox[
              StyleBox["p",
               FontWeight->"Bold"], "s"], "(", 
             RowBox[{"t", ",", 
              RowBox[{"t", "-", 
               RowBox[{"t", "'"}]}]}], ")"}], ",", "t"}], ")"}], ")"}], " ", 
         "\[Times]", " ", 
         RowBox[{
          RowBox[{
           StyleBox["F",
            FontWeight->"Bold"], "(", 
           RowBox[{"t", "'"}], ")"}], "\[CenterDot]", 
          RowBox[{
           StyleBox["d",
            FontWeight->"Bold"], "(", 
           RowBox[{
            StyleBox["\[Pi]",
             FontWeight->"Bold"], "(", 
            RowBox[{
             RowBox[{
              SubscriptBox[
               StyleBox["p",
                FontWeight->"Bold"], "s"], "(", 
              RowBox[{"t", ",", 
               RowBox[{"t", "'"}]}], ")"}], ",", 
             RowBox[{"t", "'"}]}], ")"}], ")"}]}], "\[Times]", 
         RowBox[{"exp", "[", 
          RowBox[{
           RowBox[{"-", "\[ImaginaryI]"}], " ", 
           RowBox[{"S", "(", 
            RowBox[{
             RowBox[{
              StyleBox[
               SubscriptBox[
                StyleBox["p",
                 FontWeight->"Bold"], 
                StyleBox["s",
                 FontWeight->"Plain"]],
               FontWeight->"Bold"], "(", 
              RowBox[{"t", ",", 
               RowBox[{"t", "'"}]}], ")"}], ",", "t", ",", 
             RowBox[{"t", "'"}]}], ")"}]}], "]"}], "\[Times]", 
         SuperscriptBox["\[ExponentialE]", 
          RowBox[{
           RowBox[{"+", "\[ImaginaryI]"}], " ", "\[CapitalOmega]", " ", 
           "t"}]]}]}]}]}]}]}], TraditionalForm]]],
 ",\n\nvia a saddle-point approximation on the ionization and recombination \
times ",
 Cell[BoxData[
  FormBox[
   RowBox[{"t", "'"}], TraditionalForm]]],
 " and ",
 Cell[BoxData[
  FormBox["t", TraditionalForm]]],
 ", which gives a harmonic dipole of the form\n\n          ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     StyleBox["D",
      FontWeight->"Bold"], "(", "\[CapitalOmega]", ")"}], "=", 
    RowBox[{"\[ImaginaryI]", 
     RowBox[{
      UnderscriptBox["\[Sum]", "s"], 
      RowBox[{
       SqrtBox[
        FractionBox[
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{"2", "\[Pi]"}], ")"}], "2"], 
         RowBox[{
          SuperscriptBox["\[ImaginaryI]", "2"], 
          RowBox[{"det", "(", 
           RowBox[{
            SubsuperscriptBox["\[PartialD]", 
             RowBox[{"(", 
              RowBox[{"t", ",", 
               RowBox[{"t", "'"}]}], ")"}], "2"], 
            SubscriptBox[
             RowBox[{"S", "(", 
              RowBox[{"t", ",", 
               RowBox[{"t", "'"}]}], ")"}], "s"]}], ")"}]}]]], 
       SuperscriptBox[
        RowBox[{"(", 
         FractionBox[
          RowBox[{"2", "\[Pi]"}], 
          RowBox[{"\[Epsilon]", "+", 
           RowBox[{"\[ImaginaryI]", " ", 
            RowBox[{"(", 
             RowBox[{
              SubscriptBox["t", "s"], "-", 
              SubscriptBox[
               RowBox[{"t", "'"}], "s"]}], ")"}]}]}]], ")"}], 
        RowBox[{"3", "/", "2"}]], " ", 
       RowBox[{
        StyleBox["d",
         FontWeight->"Bold"], "(", 
        RowBox[{
         StyleBox["\[Pi]",
          FontWeight->"Bold"], "(", 
         RowBox[{
          RowBox[{
           SubscriptBox[
            StyleBox["p",
             FontWeight->"Bold"], "s"], "(", 
           RowBox[{
            SubscriptBox["t", "s"], ",", 
            RowBox[{
             SubscriptBox["t", "s"], "-", 
             SubscriptBox[
              RowBox[{"t", "'"}], "s"]}]}], ")"}], ",", 
          SubscriptBox["t", "s"]}], ")"}], ")"}], " ", "\[Times]", " ", 
       RowBox[{
        RowBox[{
         StyleBox["F",
          FontWeight->"Bold"], "(", 
         SubscriptBox[
          RowBox[{"t", "'"}], "s"], ")"}], "\[CenterDot]", 
        RowBox[{
         StyleBox["d",
          FontWeight->"Bold"], "(", 
         RowBox[{
          StyleBox["\[Pi]",
           FontWeight->"Bold"], "(", 
          RowBox[{
           RowBox[{
            SubscriptBox[
             StyleBox["p",
              FontWeight->"Bold"], "s"], "(", 
            RowBox[{
             SubscriptBox["t", "s"], ",", 
             SubscriptBox[
              RowBox[{"t", "'"}], "s"]}], ")"}], ",", 
           SubscriptBox[
            RowBox[{"t", "'"}], "s"]}], ")"}], ")"}]}], "\[Times]", 
       RowBox[{"exp", "[", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], " ", 
         RowBox[{"S", "(", 
          RowBox[{
           RowBox[{
            StyleBox[
             SubscriptBox[
              StyleBox["p",
               FontWeight->"Bold"], 
              StyleBox["s",
               FontWeight->"Plain"]],
             FontWeight->"Bold"], "(", 
            RowBox[{
             SubscriptBox["t", "s"], ",", 
             SubscriptBox[
              RowBox[{"t", "'"}], "s"]}], ")"}], ",", 
           SubscriptBox["t", "s"], ",", 
           SubscriptBox[
            RowBox[{"t", "'"}], "s"]}], ")"}]}], "]"}], "\[Times]", 
       SuperscriptBox["\[ExponentialE]", 
        RowBox[{
         RowBox[{"+", "\[ImaginaryI]"}], " ", "\[CapitalOmega]", " ", 
         SubscriptBox["t", "s"]}]]}]}]}]}], TraditionalForm]]],
 ",\n\nwhere the times ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["t", "s"], TraditionalForm]]],
 " and ",
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    RowBox[{"t", "'"}], "s"], TraditionalForm]]],
 " (and equivalently ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Tau]", "s"], "=", 
    RowBox[{
     SubscriptBox["t", "s"], "-", 
     SubscriptBox[
      RowBox[{"t", "'"}], "s"]}]}], TraditionalForm]]],
 ") are obtained via the saddle-point equations\n\n          ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     RowBox[{
      FractionBox[
       RowBox[{"\[PartialD]", "S"}], 
       RowBox[{"\[PartialD]", 
        RowBox[{"t", "'"}]}]], 
      RowBox[{"(", 
       RowBox[{
        SubscriptBox["t", "s"], ",", 
        SubscriptBox[
         RowBox[{"t", "'"}], "s"]}], ")"}]}], "=", "0"}], ",", " ", 
    RowBox[{
     RowBox[{
      FractionBox[
       RowBox[{"\[PartialD]", "S"}], 
       RowBox[{"\[PartialD]", "t"}]], 
      RowBox[{"(", 
       RowBox[{
        SubscriptBox["t", "s"], ",", 
        SubscriptBox[
         RowBox[{"t", "'"}], "s"]}], ")"}]}], "=", "\[CapitalOmega]"}]}], 
   TraditionalForm]]],
 ",\n\nas described in detail in the original paper by Lewenstein et al. (",
 StyleBox[ButtonBox["Phys. Rev. A",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.49.2117"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.49.2117"],
  FontSlant->"Italic"],
 ButtonBox[" ",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.49.2117"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.49.2117"],
 StyleBox[ButtonBox["49",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.49.2117"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.49.2117"],
  FontWeight->"Bold"],
 ButtonBox[" no. 3, 2117 (1994)",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.49.2117"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.49.2117"],
 "), or in e.g. M. Ivanov and O. Smirnova. ",
 StyleBox["Multielectron high harmonic generation: simple man on a complex \
plane",
  FontSlant->"Italic"],
 ". In T. Schultz and M. Vrakking (eds.), Attosecond and\nXUV Physics: \
Ultrafast Dynamics and Spectroscopy, pp. 201\[Dash]256 (Wiley-VCH, Weinheim, \
2014), ",
 ButtonBox["arXiv:1304.2413",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://arxiv.org/abs/1304.2413"], None},
  ButtonNote->"http://arxiv.org/abs/1304.2413"],
 "."
}], "Text"]
}, Closed]],

Cell[CellGroupData[{

Cell["First-order nondipole calculations", "Subsection"],

Cell[TextData[{
 "This code can also be used to calculate the first-order effect of nondipole \
terms, which become relevant at high intensities or long wavelengths, when \
the electron\[CloseCurlyQuote]s speed from the laser-driven oscillations \
(which scales as ",
 Cell[BoxData[
  FormBox[
   RowBox[{"F", "/", "\[Omega]"}], TraditionalForm]]],
 ") becomes comparable to the speed of light (equal to ",
 Cell[BoxData[
  FormBox[
   RowBox[{"c", "=", 
    RowBox[{
     RowBox[{"1", "/", "\[Alpha]"}], "\[TildeTilde]", "137"}]}], 
   TraditionalForm]]],
 " in atomic units). (More specifically, the nondipole effects on the \
harmonic generation become relevant when the magnetic pushing per cycle, \
which offsets the returning wavepacket by ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SuperscriptBox["F", "2"], "/", 
    SuperscriptBox["c\[Omega]", "3"]}], TraditionalForm]]],
 ", becomes comparable with the wavepacket spread upon recollision.)\n\nThis \
code implements a generalization of the theory presented in various forms in \
the papers N.J. Kylstra et al. ",
 StyleBox[ButtonBox["J. Phys B: At. Mol. Opt. Phys.",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1088/0953-4075/34/3/101"], None},
  ButtonNote->"http://dx.doi.org/10.1088/0953-4075/34/3/101"],
  FontSlant->"Italic"],
 ButtonBox[" ",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1088/0953-4075/34/3/101"], None},
  ButtonNote->"http://dx.doi.org/10.1088/0953-4075/34/3/101"],
 StyleBox[ButtonBox["34",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1088/0953-4075/34/3/101"], None},
  ButtonNote->"http://dx.doi.org/10.1088/0953-4075/34/3/101"],
  FontWeight->"Bold"],
 ButtonBox[" no. 3, L55 (2001)",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1088/0953-4075/34/3/101"], None},
  ButtonNote->"http://dx.doi.org/10.1088/0953-4075/34/3/101"],
 "; N..J. Kylstra et al. ",
 StyleBox[ButtonBox["Laser Phys.",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1088/0953-4075/34/3/101"], None},
  ButtonNote->"http://dx.doi.org/10.1088/0953-4075/34/3/101"],
  FontSlant->"Italic"],
 ButtonBox[" ",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1088/0953-4075/34/3/101"], None},
  ButtonNote->"http://dx.doi.org/10.1088/0953-4075/34/3/101"],
 StyleBox[ButtonBox["12",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1088/0953-4075/34/3/101"], None},
  ButtonNote->"http://dx.doi.org/10.1088/0953-4075/34/3/101"],
  FontWeight->"Bold"],
 ButtonBox[" no. 2, 409 (2002)",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1088/0953-4075/34/3/101"], None},
  ButtonNote->"http://dx.doi.org/10.1088/0953-4075/34/3/101"],
 "; M.W. Walser et al. ",
 StyleBox[ButtonBox["Phys. Rev. Lett.",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevLett.85.5082"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevLett.85.5082"],
  FontSlant->"Italic"],
 ButtonBox[" ",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevLett.85.5082"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevLett.85.5082"],
 StyleBox[ButtonBox["85",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevLett.85.5082"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevLett.85.5082"],
  FontWeight->"Bold"],
 ButtonBox[" no. 24, 5082 (2000)",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevLett.85.5082"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevLett.85.5082"],
 "; V. Averbukh et al. ",
 StyleBox[ButtonBox["Phys Rev. A",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.65.063402"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.65.063402"],
  FontSlant->"Italic"],
 ButtonBox[" ",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.65.063402"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.65.063402"],
 StyleBox[ButtonBox["65,",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.65.063402"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.65.063402"],
  FontWeight->"Bold"],
 ButtonBox[" 063402 (2002)",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.65.063402"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.65.063402"],
 "; and C.C. Chiril\[ACup] et al. ",
 StyleBox[ButtonBox["Phys. Rev. A",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.66.063411"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.66.063411"],
  FontSlant->"Italic"],
 ButtonBox[" ",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.66.063411"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.66.063411"],
 StyleBox[ButtonBox["66,",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.66.063411"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.66.063411"],
  FontWeight->"Bold"],
 ButtonBox[" 063411 (2002)",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.66.063411"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.66.063411"],
 ".\n\nThe nondipole-HHG code calculates the harmonic dipole of exactly the \
same form as the standard SFA,\n\n          ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     StyleBox["D",
      FontWeight->"Bold"], "(", "t", ")"}], "=", 
    RowBox[{
     RowBox[{"\[ImaginaryI]", 
      RowBox[{
       SubsuperscriptBox["\[Integral]", "0", "t"], 
       RowBox[{
        RowBox[{"\[DifferentialD]", 
         RowBox[{"t", "'"}]}], 
        RowBox[{"\[Integral]", 
         RowBox[{
          RowBox[{
           SuperscriptBox["\[DifferentialD]", "3"], 
           StyleBox["p",
            FontWeight->"Bold"]}], " ", 
          RowBox[{
           StyleBox["d",
            FontWeight->"Bold"], "(", 
           RowBox[{
            StyleBox["\[Pi]",
             FontWeight->"Bold"], "(", 
            RowBox[{
             StyleBox["p",
              FontWeight->"Bold"], ",", "t", ",", 
             RowBox[{"t", "'"}]}], ")"}], ")"}], " ", "\[Times]", " ", 
          RowBox[{
           RowBox[{
            StyleBox["F",
             FontWeight->"Bold"], "(", 
            RowBox[{"t", "'"}], ")"}], "\[CenterDot]", 
           RowBox[{
            StyleBox["d",
             FontWeight->"Bold"], "(", 
            RowBox[{
             StyleBox["\[Pi]",
              FontWeight->"Bold"], "(", 
             RowBox[{
              StyleBox["p",
               FontWeight->"Bold"], ",", 
              RowBox[{"t", "'"}], ",", 
              RowBox[{"t", "'"}]}], ")"}], ")"}]}], "\[Times]", 
          RowBox[{"exp", "[", 
           RowBox[{
            RowBox[{"-", "\[ImaginaryI]"}], " ", 
            RowBox[{"S", "(", 
             RowBox[{
              StyleBox["p",
               FontWeight->"Bold"], ",", "t", ",", 
              RowBox[{"t", "'"}]}], ")"}]}], "]"}]}]}]}]}]}], "+", 
     RowBox[{"c", ".", "c", "."}]}]}], TraditionalForm]]],
 "\n\nwith ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"S", "(", 
     RowBox[{
      StyleBox["p",
       FontWeight->"Bold"], ",", "t", ",", 
      RowBox[{"t", "'"}]}], ")"}], "=", 
    RowBox[{
     SubsuperscriptBox["\[Integral]", 
      RowBox[{"t", "'"}], "t"], 
     RowBox[{
      RowBox[{"\[DifferentialD]", 
       RowBox[{"t", "''"}]}], 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         FractionBox["1", "2"], 
         SuperscriptBox["\[Kappa]", "2"]}], "+", 
        RowBox[{
         FractionBox["1", "2"], 
         SuperscriptBox[
          RowBox[{
           StyleBox["\[Pi]",
            FontWeight->"Bold"], "(", 
           RowBox[{
            StyleBox["p",
             FontWeight->"Bold"], ",", 
            RowBox[{"t", "''"}], ",", 
            RowBox[{"t", "'"}]}], ")"}], "2"]}]}], ")"}]}]}]}], 
   TraditionalForm]]],
 "  as before, but with a nondipole term in the displaced momentum, which now \
reads\n\n          ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     StyleBox["\[Pi]",
      FontWeight->"Bold"], "(", 
     RowBox[{
      StyleBox["p",
       FontWeight->"Bold"], ",", "t", ",", 
      RowBox[{"t", "'"}]}], ")"}], "=", 
    RowBox[{
     StyleBox["p",
      FontWeight->"Bold"], "+", 
     RowBox[{
      StyleBox["A",
       FontWeight->"Bold"], "(", "t", ")"}], "-", 
     RowBox[{
      SubsuperscriptBox["\[Integral]", 
       RowBox[{"t", "'"}], "t"], 
      RowBox[{
       RowBox[{
        RowBox[{
         StyleBox["\[Del]",
          FontWeight->"Bold"], 
         RowBox[{
          StyleBox["A",
           FontWeight->"Bold"], "(", "\[Tau]", ")"}]}], "\[CenterDot]", 
        RowBox[{"(", 
         RowBox[{
          StyleBox["p",
           FontWeight->"Bold"], "+", 
          RowBox[{
           StyleBox["A",
            FontWeight->"Bold"], "(", "\[Tau]", ")"}]}], ")"}]}], 
       RowBox[{"\[DifferentialD]", "\[Tau]"}]}]}]}]}], TraditionalForm]]],
 ",\n          \nor in component notation\n\n          ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     SubscriptBox["\[Pi]", "j"], "(", 
     RowBox[{
      StyleBox["p",
       FontWeight->"Bold"], ",", "t", ",", 
      RowBox[{"t", "'"}]}], ")"}], "=", 
    RowBox[{
     SubscriptBox["p", "j"], "+", 
     RowBox[{
      SubscriptBox["A", "j"], "(", "t", ")"}], "-", 
     RowBox[{
      SubsuperscriptBox["\[Integral]", 
       RowBox[{"t", "'"}], "t"], 
      RowBox[{
       RowBox[{
        SubscriptBox["\[PartialD]", "j"], 
        RowBox[{
         SubscriptBox["A", "k"], "(", "\[Tau]", ")"}]}], 
       RowBox[{"(", 
        RowBox[{
         SubscriptBox["p", "k"], "+", 
         RowBox[{
          SubscriptBox["A", "k"], "(", "\[Tau]", ")"}]}], ")"}], 
       RowBox[{"\[DifferentialD]", "\[Tau]"}]}]}]}]}], TraditionalForm]]],
 "."
}], "Text"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Implementation", "Subchapter"],

Cell[CellGroupData[{

Cell["Supporting functions", "Section"],

Cell[CellGroupData[{

Cell["Initialization", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BeginPackage", "[", 
   RowBox[{"\"\<RBSFA`\>\"", ",", 
    RowBox[{"{", "\"\<EPToolbox`\>\"", "}"}]}], "]"}], ";"}]], "Input",
 InitializationCell->True],

Cell[CellGroupData[{

Cell["Version number", "Subsubsection",
 CellTags->"version-section"],

Cell["\<\
The command RBSFAversion prints the version of the RB-SFA package currently \
loaded and its timestamp\
\>", "Text"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"$RBSFAversion", "::", "usage"}], "=", 
   "\"\<$RBSFAversion prints the current version of the RB-SFA package in use \
and its timestamp.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"$RBSFAtimestamp", "::", "usage"}], "=", 
   "\"\<$RBSFAtimestamp prints the timestamp of the current version of the \
RB-SFA package.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"$RBSFAversion", ":=", 
   RowBox[{"\"\<RB-SFA v2.1.0, \>\"", "<>", "$RBSFAtimestamp"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True],

Cell[TextData[{
 "Old syntax (in functional form ",
 StyleBox["RBSFAversion[]", "Code"],
 "), deprecated"
}], "Text"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"RBSFAversion", "::", "usage"}], "=", 
   "\"\<RBSFAversion[] has been deprecated in favour of $RBSFAversion.\>\""}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBSFAversion", "::", "dprc"}], "=", 
   "\"\<RBSFAversion[] has been deprecated in favour of $RBSFAversion.\>\""}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBSFAversion", "[", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{"RBSFAversion", "::", "dprc"}], "]"}], ";", "$RBSFAversion"}], 
    ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]"}]], "Input"],

Cell["\<\
The timestamp is updated every time the notebook is saved via an appropriate \
notebook option, which is set by the code below.\
\>", "Text"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetOptions", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"EvaluationNotebook", "[", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"NotebookEventActions", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\"\<MenuCommand\>\"", ",", "\"\<Save\>\""}], "}"}], 
        "\[RuleDelayed]", 
        RowBox[{"(", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"NotebookWrite", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"Cells", "[", 
              RowBox[{"CellTags", "\[Rule]", "\"\<version-timestamp\>\""}], 
              "]"}], "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"Cell", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"BoxData", "[", 
               RowBox[{"RowBox", "[", 
                RowBox[{"{", 
                 RowBox[{
                 "\"\<Begin[\\\"`Private`\\\"];\\n$RBSFAtimestamp=\\\"\>\"", "<>", 
                  RowBox[{"DateString", "[", "]"}], "<>", 
                  "\"\<\\\";\\nEnd[];\>\""}], "}"}], "]"}], "]"}], 
              "\[IndentingNewLine]", ",", "\"\<Input\>\"", ",", 
              RowBox[{"InitializationCell", "\[Rule]", "True"}], ",", 
              RowBox[{"CellTags", "\[Rule]", "\"\<version-timestamp\>\""}]}], 
             "\[IndentingNewLine]", "]"}], ",", "None", ",", 
            RowBox[{"AutoScroll", "\[Rule]", "False"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"NotebookSave", "[", "]"}]}], "\[IndentingNewLine]", 
         ")"}]}], ",", 
       RowBox[{"PassEventsDown", "\[Rule]", "True"}]}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}], ";"}]], "Input"],

Cell["To reset this behaviour to normal, evaluatethe cell below", "Text"],

Cell[BoxData[
 RowBox[{"SetOptions", "[", 
  RowBox[{
   RowBox[{"EvaluationNotebook", "[", "]"}], ",", 
   RowBox[{"NotebookEventActions", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\"\<MenuCommand\>\"", ",", "\"\<Save\>\""}], "}"}], 
       "\[RuleDelayed]", 
       RowBox[{"(", 
        RowBox[{"NotebookSave", "[", "]"}], ")"}]}], ",", 
      RowBox[{"PassEventsDown", "\[Rule]", "True"}]}], "}"}]}]}], 
  "]"}]], "Input"]
}, Closed]],

Cell[CellGroupData[{

Cell["Timestamp", "Subsubsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"$RBSFAtimestamp", "=", "\"\<Fri 13 May 2016 16:49:42\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellTags->"version-timestamp"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Git commit hash and message", "Subsubsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"$RBSFAdirectory", "::", "usage"}], "=", 
   "\"\<$RBSFAdirectory is the directory where the current RB-SFA package \
instance is located.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"$RBSFAcommit", "::", "usage"}], "=", 
   "\"\<$RBSFAcommit returns the git commit log at the location of the RB-SFA \
package if there is one.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"$RBSFAcommit", "::", "OS"}], "=", 
   "\"\<$RBSFAcommit has only been tested on Linux.\>\""}], ";"}]}], "Input",
 InitializationCell->True],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"softLinkTestString", "=", 
     RowBox[{"StringSplit", "[", 
      RowBox[{
       RowBox[{"StringJoin", "[", 
        RowBox[{"ReadList", "[", 
         RowBox[{
          RowBox[{"\"\<! ls -la \>\"", "<>", 
           RowBox[{"StringReplace", "[", 
            RowBox[{"$InputFileName", ",", 
             RowBox[{"{", 
              RowBox[{"\"\< \>\"", "\[Rule]", "\"\<\\\\ \>\""}], "}"}]}], 
            "]"}]}], ",", "String"}], "]"}], "]"}], ",", "\"\< -> \>\""}], 
      "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "[", "softLinkTestString", "]"}], ">", "1"}], ",", 
     RowBox[{"(*", 
      RowBox[{
      "Testing", " ", "in", " ", "case", " ", "$InputFileName", " ", "is", 
       " ", "a", " ", "soft", " ", "link", " ", "to", " ", "the", " ", 
       "actual", " ", 
       RowBox[{"directory", "."}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"$RBSFAdirectory", "=", 
      RowBox[{"StringReplace", "[", 
       RowBox[{
        RowBox[{"DirectoryName", "[", 
         RowBox[{
         "softLinkTestString", "\[LeftDoubleBracket]", "2", 
          "\[RightDoubleBracket]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"\"\< \>\"", "\[Rule]", "\"\<\\\\ \>\""}], "}"}]}], "]"}]}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"$RBSFAdirectory", "=", 
       RowBox[{"StringReplace", "[", 
        RowBox[{
         RowBox[{"DirectoryName", "[", "$InputFileName", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"\"\< \>\"", "\[Rule]", "\"\<\\\\ \>\""}], "}"}]}], "]"}]}],
       ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"$RBSFAcommit", ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"$OperatingSystem", "\[NotEqual]", "\"\<Unix\>\""}], ",", 
       RowBox[{"Message", "[", 
        RowBox[{"$RBSFAcommit", "::", "OS"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"StringJoin", "[", 
      RowBox[{"Riffle", "[", 
       RowBox[{
        RowBox[{"ReadList", "[", 
         RowBox[{
          RowBox[{
          "\"\<!cd \>\"", "<>", "$RBSFAdirectory", "<>", 
           "\"\< && git log -1\>\""}], ",", "String"}], "]"}], ",", 
        RowBox[{"{", "\"\<\\n\>\"", "}"}]}], "]"}], "]"}]}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Dipole transition matrix elements", "Subsection"],

Cell["Default DTME is for a hydrogenic 1s state.", "Text"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"hydrogenicDTME", "::", "usage"}], "=", 
   "\"\<hydrogenicDTME[p,\[Kappa]] returns the dipole transition matrix \
element for a 1s hydrogenic state of ionization potential \!\(\*SubscriptBox[\
\(I\), \(p\)]\)=\!\(\*FractionBox[\(1\), \(2\)]\)\!\(\*SuperscriptBox[\(\
\[Kappa]\), \(2\)]\).\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hydrogenicDTMERegularized", "::", "usage"}], "=", 
  "\"\<hydrogenicDTMERegularized[p,\[Kappa]] returns the dipole transition \
matrix element for a 1s hydrogenic state of ionization potential \
\!\(\*SubscriptBox[\(I\), \(p\)]\)=\!\(\*FractionBox[\(1\), \
\(2\)]\)\!\(\*SuperscriptBox[\(\[Kappa]\), \(2\)]\), regularized to remove \
the denominator of 1/(\!\(\*SuperscriptBox[\(p\), \
\(2\)]\)+\!\(\*SuperscriptBox[\(\[Kappa]\), \
\(2\)]\)\!\(\*SuperscriptBox[\()\), \(3\)]\), where the saddle-point \
solutions are singular.\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hydrogenicDTME", "[", 
   RowBox[{"p_List", ",", "\[Kappa]_"}], "]"}], ":=", 
  RowBox[{
   FractionBox[
    RowBox[{"8", "\[ImaginaryI]"}], "\[Pi]"], 
   FractionBox[
    RowBox[{
     SqrtBox[
      RowBox[{"2", 
       SuperscriptBox["\[Kappa]", "5"]}]], "p"}], 
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{
       RowBox[{"Total", "[", 
        SuperscriptBox["p", "2"], "]"}], "+", 
       SuperscriptBox["\[Kappa]", "2"]}], ")"}], 
     "3"]]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hydrogenicDTME", "[", 
   RowBox[{
    RowBox[{"p_", "?", "NumberQ"}], ",", "\[Kappa]_"}], "]"}], ":=", 
  RowBox[{
   FractionBox[
    RowBox[{"8", "\[ImaginaryI]"}], "\[Pi]"], 
   FractionBox[
    RowBox[{
     SqrtBox[
      RowBox[{"2", 
       SuperscriptBox["\[Kappa]", "5"]}]], "p"}], 
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{
       SuperscriptBox["p", "2"], "+", 
       SuperscriptBox["\[Kappa]", "2"]}], ")"}], 
     "3"]]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hydrogenicDTMERegularized", "[", 
   RowBox[{"p_List", ",", "\[Kappa]_"}], "]"}], ":=", 
  RowBox[{
   FractionBox[
    RowBox[{"8", "\[ImaginaryI]"}], "\[Pi]"], 
   FractionBox[
    RowBox[{
     SqrtBox[
      RowBox[{"2", 
       SuperscriptBox["\[Kappa]", "5"]}]], "p"}], 
    "1"]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hydrogenicDTMERegularized", "[", 
   RowBox[{
    RowBox[{"p_", "?", "NumberQ"}], ",", "\[Kappa]_"}], "]"}], ":=", 
  RowBox[{
   FractionBox[
    RowBox[{"8", "\[ImaginaryI]"}], "\[Pi]"], 
   FractionBox[
    RowBox[{
     SqrtBox[
      RowBox[{"2", 
       SuperscriptBox["\[Kappa]", "5"]}]], "p"}], 
    "1"]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True],

Cell[BoxData["\<\"hydrogenicDTMERegularized[p,\[Kappa]] returns the dipole \
transition matrix element for a 1s hydrogenic state of ionization potential \
\\!\\(\\*SubscriptBox[\\(I\\), \\(p\\)]\\)=\\!\\(\\*FractionBox[\\(1\\), \\(2\
\\)]\\)\\!\\(\\*SuperscriptBox[\\(\[Kappa]\\), \\(2\\)]\\), regularized to \
remove the denominator of 1/(\\!\\(\\*SuperscriptBox[\\(p\\), \\(2\\)]\\)+\\!\
\\(\\*SuperscriptBox[\\(\[Kappa]\\), \
\\(2\\)]\\)\\!\\(\\*SuperscriptBox[\\()\\), \\(3\\)]\\), where the \
saddle-point solutions are singular.\"\>"], "Output"]
}, Open  ]],

Cell["Another possibility is for a gaussian orbital", "Text"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"gaussianDTME", "::", "usage"}], "=", 
   "\"\<gaussianDTME[p,\[Kappa]] returns the dipole transition matrix element \
for a gaussian state of characteristic size 1/\[Kappa].\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gaussianDTME", "[", 
   RowBox[{"p_List", ",", "\[Kappa]_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"-", "\[ImaginaryI]"}], " ", 
   SuperscriptBox[
    RowBox[{"(", 
     RowBox[{"4", "\[Pi]"}], ")"}], 
    RowBox[{"3", "/", "4"}]], 
   SuperscriptBox["\[Kappa]", 
    RowBox[{
     RowBox[{"-", "7"}], "/", "2"}]], "p", " ", 
   RowBox[{"Exp", "[", 
    RowBox[{"-", 
     FractionBox[
      RowBox[{"Total", "[", 
       SuperscriptBox["p", "2"], "]"}], 
      RowBox[{"2", 
       SuperscriptBox["\[Kappa]", "2"]}]]}], "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gaussianDTME", "[", 
   RowBox[{
    RowBox[{"p_", "?", "NumberQ"}], ",", "\[Kappa]_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"-", "\[ImaginaryI]"}], " ", 
   SuperscriptBox[
    RowBox[{"(", 
     RowBox[{"4", "\[Pi]"}], ")"}], 
    RowBox[{"3", "/", "4"}]], 
   SuperscriptBox["\[Kappa]", 
    RowBox[{
     RowBox[{"-", "7"}], "/", "2"}]], "p", " ", 
   RowBox[{"Exp", "[", 
    RowBox[{"-", 
     FractionBox[
      SuperscriptBox["p", "2"], 
      RowBox[{"2", 
       SuperscriptBox["\[Kappa]", "2"]}]]}], "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Various field envelopes", "Subsection"],

Cell[CellGroupData[{

Cell["flatTopEnvelope", "Subsubsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"flatTopEnvelope", "::", "usage"}], "=", 
   "\"\<flatTopEnvelope[\[Omega],num,nRamp] returns a Function object \
representing a flat-top envelope at carrier frequency \[Omega] lasting a \
total of num cycles and with linear ramps nRamp cycles long.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"flatTopEnvelope", "[", 
   RowBox[{"\[Omega]_", ",", "num_", ",", "nRamp_"}], "]"}], ":=", 
  RowBox[{"Function", "[", 
   RowBox[{"t", ",", 
    RowBox[{"Piecewise", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"t", "<", "0"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         SuperscriptBox[
          RowBox[{"Sin", "[", 
           FractionBox[
            RowBox[{"\[Omega]", " ", "t"}], 
            RowBox[{"4", "nRamp"}]], "]"}], "2"], ",", 
         RowBox[{"0", "\[LessEqual]", "t", "<", 
          RowBox[{
           FractionBox[
            RowBox[{"2", " ", "\[Pi]"}], "\[Omega]"], " ", "nRamp"}]}]}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", 
         RowBox[{
          RowBox[{
           FractionBox[
            RowBox[{"2", " ", "\[Pi]"}], "\[Omega]"], "nRamp"}], 
          "\[LessEqual]", "t", "<", 
          RowBox[{
           FractionBox[
            RowBox[{"2", " ", "\[Pi]"}], "\[Omega]"], 
           RowBox[{"(", 
            RowBox[{"num", "-", "nRamp"}], ")"}]}]}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         SuperscriptBox[
          RowBox[{"Sin", "[", 
           FractionBox[
            RowBox[{"\[Omega]", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                FractionBox[
                 RowBox[{"2", " ", "\[Pi]"}], "\[Omega]"], "num"}], "-", 
               "t"}], ")"}]}], 
            RowBox[{"4", "nRamp"}]], "]"}], "2"], ",", 
         RowBox[{
          RowBox[{
           FractionBox[
            RowBox[{"2", " ", "\[Pi]"}], "\[Omega]"], 
           RowBox[{"(", 
            RowBox[{"num", "-", "nRamp"}], ")"}]}], "\[LessEqual]", "t", "<", 
          
          RowBox[{
           FractionBox[
            RowBox[{"2", " ", "\[Pi]"}], "\[Omega]"], "num"}]}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{
          RowBox[{
           FractionBox[
            RowBox[{"2", " ", "\[Pi]"}], "\[Omega]"], " ", "num"}], 
          "\[LessEqual]", "t"}]}], "}"}]}], "}"}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["cosPowerFlatTop", "Subsubsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"cosPowerFlatTop", "::", "usage"}], "=", 
   "\"\<cosPowerFlatTop[\[Omega],num,power] returns a Function object \
representing a smooth flat-top envelope of the form 1-Cos(\[Omega] t/2 \
num\!\(\*SuperscriptBox[\()\), \(power\)]\)\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cosPowerFlatTop", "[", 
   RowBox[{"\[Omega]_", ",", "num_", ",", "power_"}], "]"}], ":=", 
  RowBox[{"Function", "[", 
   RowBox[{"t", ",", 
    RowBox[{"1", "-", 
     SuperscriptBox[
      RowBox[{"Cos", "[", 
       FractionBox[
        RowBox[{"\[Omega]", " ", "t"}], 
        RowBox[{"2", "num"}]], "]"}], "power"]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Field duration standard options", "Subsection"],

Cell["\<\
The standard options for the duration of the pulse and the resolution are\
\>", "Text",
 CellChangeTimes->{}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PointsPerCycle", "::", "usage"}], "=", 
   "\"\<PointsPerCycle is a sampling option which specifies the number of \
sampling points per cycle to be used in integrations.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TotalCycles", "::", "usage"}], "=", 
   "\"\<TotalCycles is a sampling option which specifies the total number of \
periods to be integrated over.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CarrierFrequency", "::", "usage"}], "=", 
   "\"\<CarrierFrequency is a sampling option which specifies the carrier \
frequency to be used.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", 
   RowBox[{"PointsPerCycle", ",", "TotalCycles", ",", "CarrierFrequency"}], 
   "]"}], ";"}]}], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"standardOptions", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"PointsPerCycle", "\[Rule]", "90"}], ",", 
     RowBox[{"TotalCycles", "\[Rule]", "1"}], ",", 
     RowBox[{"CarrierFrequency", "\[Rule]", "0.057"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[TextData[{
 "PointsPerCycle dictates how many sampling points are used per laser cycle \
(at frequency CarrierFrequency, of the infrared laser), and it should be at \
least twice the highest harmonic of interest. The total duration is ",
 Cell[BoxData[
  FormBox["TotalCycles", TraditionalForm]]],
 " cycles. ",
 "CarrierFrequency",
 " is the frequency of the fundamental laser, in atomic units."
}], "Text"]
}, Closed]],

Cell[CellGroupData[{

Cell["harmonicOrderAxis", "Subsection"],

Cell[TextData[{
 "harmonicOrderAxis produces a list that can be used as a harmonic order axis \
for the given pulse parameters. \n\nThe length can be fine-tuned (to match \
exactly a spectrum, for instance, and get a matrix of the correct shape) \
using the ",
 Cell[BoxData[
  FormBox["correction", TraditionalForm]]],
 " option, or a TargetLength can be directly specified."
}], "Text",
 CellChangeTimes->{}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"harmonicOrderAxis", "::", "usage"}], "=", 
   "\"\<harmonicOrderAxis[opt\[Rule]value] returns a list of frequencies \
which can be used as a frequency axis for Fourier transforms, scaled in units \
of harmonic order, for the provided field duration and sampling \
options.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TargetLength", "::", "usage"}], "=", 
   "\"\<TargetLength is an option for harmonicOrderAxis which specifies the \
total length required of the resulting list.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LengthCorrection", "::", "usage"}], "=", 
   "\"\<LengthCorrection is an option for harmonicOrderAxis which allows for \
manual correction of the length of the resulting list.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", 
   RowBox[{"LengthCorrection", ",", "TargetLength"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "harmonicOrderAxis", "]"}], "=", 
   RowBox[{"standardOptions", "~", "Join", "~", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"TargetLength", "\[Rule]", "Automatic"}], ",", 
      RowBox[{"LengthCorrection", "\[Rule]", "1"}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"harmonicOrderAxis", "::", "target"}], "=", 
   "\"\<Invalid TargetLength option `1`. This must be a positive integer or \
Automatic.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"harmonicOrderAxis", "[", 
   RowBox[{"OptionsPattern", "[", "]"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"num", "=", 
       RowBox[{"OptionValue", "[", "TotalCycles", "]"}]}], ",", 
      RowBox[{"npp", "=", 
       RowBox[{"OptionValue", "[", "PointsPerCycle", "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Piecewise", "[", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           FractionBox["1", "num"], 
           RowBox[{"Range", "[", 
            RowBox[{"0.", ",", 
             RowBox[{
              RowBox[{"Round", "[", 
               FractionBox[
                RowBox[{
                 RowBox[{"npp", " ", "num"}], "+", "1"}], "2."], "]"}], "-", 
              "1", "+", 
              RowBox[{"OptionValue", "[", "LengthCorrection", "]"}]}]}], 
            "]"}]}], ",", 
          RowBox[{
           RowBox[{"OptionValue", "[", "TargetLength", "]"}], "===", 
           "Automatic"}]}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           FractionBox[
            RowBox[{"Round", "[", 
             FractionBox[
              RowBox[{
               RowBox[{"npp", " ", "num"}], "+", "1"}], "2."], "]"}], "num"], 
           
           FractionBox[
            RowBox[{"Range", "[", 
             RowBox[{"0", ",", 
              RowBox[{
               RowBox[{"OptionValue", "[", "TargetLength", "]"}], "-", 
               "1"}]}], "]"}], 
            RowBox[{"OptionValue", "[", "TargetLength", "]"}]]}], ",", 
          RowBox[{
           RowBox[{"IntegerQ", "[", 
            RowBox[{"OptionValue", "[", "TargetLength", "]"}], "]"}], "&&", 
           RowBox[{
            RowBox[{"OptionValue", "[", "TargetLength", "]"}], 
            "\[GreaterEqual]", "0"}]}]}], "}"}]}], "\[IndentingNewLine]", 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"harmonicOrderAxis", "::", "target"}], ",", 
         RowBox[{"OptionValue", "[", "\"\<TargetLength\>\"", "]"}]}], "]"}], 
       ";", 
       RowBox[{"Abort", "[", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["frequencyAxis", "Subsection"],

Cell["\<\
frequencyAxis produces a list that can be used as a harmonic order axis for \
the given pulse parameters. Identical to harmonicOrderAxis but produces a \
frequency axis (in atomic units) instead.\
\>", "Text"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"frequencyAxis", "::", "usage"}], "=", 
   "\"\<frequencyAxis[opt\[Rule]value] returns a list of frequencies which \
can be used as a frequency axis for Fourier transforms, in atomic units of \
frequency, for the provided field duration and sampling options.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "frequencyAxis", "]"}], "=", 
   RowBox[{"Options", "[", "harmonicOrderAxis", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"frequencyAxis", "[", 
   RowBox[{"options", ":", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"OptionValue", "[", "CarrierFrequency", "]"}], 
   RowBox[{
   "harmonicOrderAxis", "[", "options", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["timeAxis", "Subsection"],

Cell["\<\
timeAxis produces a list that can be used as a time axis for the given pulse \
parameters.\
\>", "Text",
 CellChangeTimes->{}],

Cell[BoxData["Quit"], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"timeAxis", "::", "usage"}], "=", 
   "\"\<timeAxis[opt\[Rule]value] returns a list of times which can be used \
as a time axis \>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TimeScale", "::", "usage"}], "=", 
   "\"\<TimeScale is an option for timeAxis which specifies the units the \
list should use: AtomicUnits by default, or LaserPeriods if required.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AtomicUnits", "::", "usage"}], "=", 
   "\"\<AtomicUnits is a value for the option TimeScale of timeAxis which \
specifies that the times should be in atomic units of time.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LaserPeriods", "::", "usage"}], "=", 
   "\"\<LaserPeriods is a value for the option TimeScale of timeAxis which \
specifies that the times should be in multiples of the carrier laser \
period.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", 
   RowBox[{"TimeScale", ",", "AtomicUnits", ",", "LaserPeriods"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "timeAxis", "]"}], "=", 
   RowBox[{"standardOptions", "~", "Join", "~", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"TimeScale", "\[Rule]", "AtomicUnits"}], ",", 
      RowBox[{"PointNumberCorrection", "\[Rule]", "0"}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"timeAxis", "::", "scale"}], "=", 
   "\"\<Invalid TimeScale option `1`. Available values are AtomicUnits and \
LaserPeriods\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"timeAxis", "[", 
   RowBox[{"OptionsPattern", "[", "]"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"T", "=", 
       RowBox[{"2", 
        RowBox[{"\[Pi]", "/", "\[Omega]"}]}]}], ",", 
      RowBox[{"\[Omega]", "=", 
       RowBox[{"OptionValue", "[", "CarrierFrequency", "]"}]}], ",", 
      RowBox[{"num", "=", 
       RowBox[{"OptionValue", "[", "TotalCycles", "]"}]}], ",", 
      RowBox[{"npp", "=", 
       RowBox[{"OptionValue", "[", "PointsPerCycle", "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Piecewise", "[", 
      RowBox[{
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", 
           RowBox[{
            RowBox[{"OptionValue", "[", "TimeScale", "]"}], "===", 
            "AtomicUnits"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           FractionBox["1", "T"], ",", 
           RowBox[{
            RowBox[{"OptionValue", "[", "TimeScale", "]"}], "===", 
            "LaserPeriods"}]}], "}"}]}], "\[IndentingNewLine]", "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"timeAxis", "::", "scale"}], ",", 
          RowBox[{"OptionValue", "[", "TimeScale", "]"}]}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "\[IndentingNewLine]", "]"}], 
     "\[Times]", 
     RowBox[{"Table", "[", 
      RowBox[{"t", "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"t", ",", "0", ",", 
         RowBox[{"num", 
          FractionBox[
           RowBox[{"2", "\[Pi]"}], "\[Omega]"]}], ",", 
         RowBox[{
          FractionBox["num", 
           RowBox[{
            RowBox[{"num", "\[Times]", "npp"}], "+", 
            RowBox[{"OptionValue", "[", "PointNumberCorrection", "]"}]}]], 
          FractionBox[
           RowBox[{"2", "\[Pi]"}], "\[Omega]"]}]}], "}"}]}], 
      "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"tInit", "=", "0"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tFinal", "=", 
     RowBox[{
      FractionBox[
       RowBox[{"2", "\[Pi]"}], "\[Omega]"], " ", "num"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Delta]t", "=", 
     FractionBox[
      RowBox[{"tFinal", "-", "tInit"}], 
      RowBox[{
       RowBox[{"num", "\[Times]", "npp"}], "+", 
       RowBox[{"OptionValue", "[", "PointNumberCorrection", "]"}]}]]}], ";"}], 
   RowBox[{"(*", 
    RowBox[{"integration", " ", "and", " ", "looping", " ", "timestep"}], 
    "*)"}]}]}]], "Input"]
}, Closed]],

Cell[CellGroupData[{

Cell["getSpectrum", "Subsection"],

Cell[TextData[{
 "getSpectrum takes a time-dependent dipole list and returns its Fourier \
transform in absolute-value-squared. It takes as options\n  ",
 StyleBox["\[CenterDot]",
  FontWeight->"Bold"],
 " pulse parameters \[Omega], TotalCycles and PointsPerCycle,\n  ",
 StyleBox["\[CenterDot]",
  FontWeight->"Bold"],
 " a polarization parameter \[Epsilon], which gives an unpolarized spectrum \
when given False, or polarizes along an ellipticity vector \[Epsilon] (this \
is meant primarily to select right- and left-circularly polarized spectra \
using ",
 Cell[BoxData[
  FormBox[
   RowBox[{"\[Epsilon]", "=", 
    RowBox[{"{", 
     RowBox[{"1", ",", "\[ImaginaryI]"}], "}"}]}], TraditionalForm]]],
 " and ",
 Cell[BoxData[
  FormBox[
   RowBox[{"\[Epsilon]", "=", 
    RowBox[{"{", 
     RowBox[{"1", ",", 
      RowBox[{"-", "\[ImaginaryI]"}]}], "}"}]}], TraditionalForm]]],
 " respectively),\n  ",
 StyleBox["\[CenterDot]",
  FontWeight->"Bold"],
 " a DifferentiationOrder, which can return the dipole value (default,",
 Cell[BoxData[
  FormBox[
   RowBox[{"=", "0"}], TraditionalForm]]],
 "), velocity (",
 Cell[BoxData[
  FormBox[
   RowBox[{"=", "1"}], TraditionalForm]]],
 "), or acceleration (",
 Cell[BoxData[
  FormBox[
   RowBox[{"=", "2"}], TraditionalForm]]],
 "), \n  \[CenterDot] a power of \[Omega], \[Omega]Power, with which to \
multiply the spectrum before returning it (which should be equivalent to \
DifferentiationOrder except for pathological cases), and\n  \[CenterDot] a \
ComplexPart function to apply immediately after differentiation (default is \
the identity function, but Re, Im, or ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SuperscriptBox[
     RowBox[{"Abs", "[", "#", "]"}], "2"], "&"}], TraditionalForm]]],
 " are reasonable choices).\nIf no option is passed to ",
 Cell[BoxData[
  FormBox["\[Omega]Power", TraditionalForm]]],
 " and DifferentiationOrder, the pulse parameters do not really affect the \
output, except by a global factor of ",
 "TotalCycles",
 "."
}], "Text"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"getSpectrum", "::", "usage"}], "=", 
   "\"\<getSpectrum[DipoleList] returns the power spectrum of \
DipoleList.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Polarization", "::", "usage"}], "=", 
   "\"\<Polarization is an option for getSpectrum which specifies a \
polarization vector along which to polarize the dipole list. The default, \
Polarization\[Rule]False, specifies an unpolarized spectrum.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ComplexPart", "::", "usage"}], "=", 
   "\"\<ComplexPart is an option for getSpectrum which specifies a function \
(like Re, Im, or by default #&) which should be applied to the dipole list \
before the spectrum is taken.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Omega]Power", "::", "usage"}], "=", 
   "\"\<\[Omega]Power is an option for getSpectrum which specifies a power of \
frequency which should multiply the spectrum.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DifferentiationOrder", "::", "usage"}], "=", 
   "\"\<DifferentiationOrder is an option for getSpectrum which specifies the \
order to which the dipole list should be differentiated before the spectrum \
is taken.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Protect", "[", 
    RowBox[{
    "Polarization", ",", "ComplexPart", ",", "\[Omega]Power", ",", 
     "DifferentiationOrder"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "getSpectrum", "]"}], "=", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Polarization", "\[Rule]", "False"}], ",", 
       RowBox[{"ComplexPart", "\[Rule]", 
        RowBox[{"(", 
         RowBox[{"#", "&"}], ")"}]}], ",", 
       RowBox[{"\[Omega]Power", "\[Rule]", "0"}], ",", 
       RowBox[{"DifferentiationOrder", "\[Rule]", "0"}]}], "}"}], "~", "Join",
      "~", "standardOptions"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"getSpectrum", "::", "diffOrd"}], "=", 
   "\"\<Invalid differentiation order `1`.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"getSpectrum", "::", "\[Omega]Pow"}], "=", 
    "\"\<Invalid \[Omega] power `1`.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"getSpectrum", "[", 
   RowBox[{"dipoleList_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "polarizationVector", ",", "differentiatedList", ",", "depth", ",", 
      "dimensions", ",", "\[IndentingNewLine]", 
      RowBox[{"num", "=", 
       RowBox[{"OptionValue", "[", "TotalCycles", "]"}]}], ",", 
      RowBox[{"npp", "=", 
       RowBox[{"OptionValue", "[", "PointsPerCycle", "]"}]}], ",", 
      RowBox[{"\[Omega]", "=", 
       RowBox[{"OptionValue", "[", "CarrierFrequency", "]"}]}], ",", 
      RowBox[{"\[Delta]t", "=", 
       FractionBox[
        RowBox[{"2", 
         RowBox[{"\[Pi]", "/", "\[Omega]"}]}], "npp"]}]}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"polarizationVector", "=", 
      FractionBox[
       RowBox[{"OptionValue", "[", "Polarization", "]"}], 
       RowBox[{"Norm", "[", 
        RowBox[{"OptionValue", "[", "Polarization", "]"}], "]"}]]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"differentiatedList", "=", 
      RowBox[{
       RowBox[{"OptionValue", "[", "ComplexPart", "]"}], "[", 
       RowBox[{"Piecewise", "[", 
        RowBox[{
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"dipoleList", ",", 
             RowBox[{
              RowBox[{"OptionValue", "[", "DifferentiationOrder", "]"}], 
              "\[Equal]", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              FractionBox["1", 
               RowBox[{"2", "\[Delta]t"}]], 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Most", "[", 
                 RowBox[{"Most", "[", "dipoleList", "]"}], "]"}], "-", 
                RowBox[{"Rest", "[", 
                 RowBox[{"Rest", "[", "dipoleList", "]"}], "]"}]}], ")"}]}], 
             ",", 
             RowBox[{
              RowBox[{"OptionValue", "[", "DifferentiationOrder", "]"}], 
              "\[Equal]", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              FractionBox["1", 
               SuperscriptBox["\[Delta]t", "2"]], 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Most", "[", 
                 RowBox[{"Most", "[", "dipoleList", "]"}], "]"}], "-", 
                RowBox[{"2", 
                 RowBox[{"Most", "[", 
                  RowBox[{"Rest", "[", "dipoleList", "]"}], "]"}]}], "+", 
                RowBox[{"Rest", "[", 
                 RowBox[{"Rest", "[", "dipoleList", "]"}], "]"}]}], ")"}]}], 
             ",", 
             RowBox[{
              RowBox[{"OptionValue", "[", "DifferentiationOrder", "]"}], 
              "\[Equal]", "2"}]}], "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"getSpectrum", "::", "diffOrd"}], ",", 
            RowBox[{"OptionValue", "[", "DifferentiationOrder", "]"}]}], 
           "]"}], ";", 
          RowBox[{"Abort", "[", "]"}]}]}], "\[IndentingNewLine]", "]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"NumberQ", "[", 
        RowBox[{"OptionValue", "[", "\[Omega]Power", "]"}], "]"}], ",", 
       RowBox[{"Null", ";"}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"getSpectrum", "::", "\[Omega]Pow"}], ",", 
          RowBox[{"OptionValue", "[", "\[Omega]Power", "]"}]}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "  ", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"num", " ", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           FractionBox["\[Omega]", "num"], " ", "k"}], ")"}], 
         RowBox[{"2", 
          RowBox[{"OptionValue", "[", "\[Omega]Power", "]"}]}]], ",", 
        RowBox[{"{", 
         RowBox[{"k", ",", "1", ",", 
          RowBox[{"Round", "[", 
           FractionBox[
            RowBox[{"Length", "[", "differentiatedList", "]"}], "2"], "]"}]}],
          "}"}]}], "\[IndentingNewLine]", "]"}], "\[Times]", 
      RowBox[{"If", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"OptionValue", "[", "Polarization", "]"}], "===", "False"}], 
        ",", 
        RowBox[{"(*", 
         RowBox[{"unpolarized", " ", "spectrum"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "funky", " ", "depth", " ", "thing", " ", "so", " ", "this", " ", 
           "can", " ", "take", " ", "lists", " ", "of", " ", "numbers", " ", 
           "and", " ", "lists", " ", "of", " ", "vectors"}], ",", " ", 
          RowBox[{"of", " ", "arbitrary", " ", 
           RowBox[{"length", ".", " ", "Makes"}], " ", "for", " ", "easier", 
           " ", 
           RowBox[{"benchmarking", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"depth", "=", 
          RowBox[{"Length", "[", 
           RowBox[{"Dimensions", "[", "dipoleList", "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"dimensions", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "#", "]"}], ">", "1"}], ",", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              ",", "1"}], 
             RowBox[{"(*", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "*)"}], "]"}], "&"}], "[", 
           RowBox[{"Dimensions", "[", "dipoleList", "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Sum", "[", 
          RowBox[{
           SuperscriptBox[
            RowBox[{"Abs", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Fourier", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"depth", ">", "1"}], ",", 
                  RowBox[{"Re", "[", 
                   RowBox[{"differentiatedList", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "i"}], "\[RightDoubleBracket]"}], 
                   "]"}], ",", 
                  RowBox[{"Re", "[", 
                   RowBox[{
                   "differentiatedList", "\[LeftDoubleBracket]", "All", 
                    "\[RightDoubleBracket]"}], "]"}]}], "]"}], 
                "\[IndentingNewLine]", ",", 
                RowBox[{"FourierParameters", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", " ", "1"}], "}"}]}]}], 
               "\[IndentingNewLine]", "]"}], "\[LeftDoubleBracket]", 
              RowBox[{"1", ";;", 
               RowBox[{"Round", "[", 
                FractionBox[
                 RowBox[{"Length", "[", "differentiatedList", "]"}], "2"], 
                "]"}]}], "\[RightDoubleBracket]"}], "\[IndentingNewLine]", 
             "]"}], "2"], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "dimensions"}], "}"}]}], "]"}]}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"(*", 
         RowBox[{"polarized", " ", "spectrum"}], "*)"}], 
        "\[IndentingNewLine]", 
        SuperscriptBox[
         RowBox[{"Abs", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Transpose", "[", 
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Fourier", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Re", "[", 
                  RowBox[{"differentiatedList", "\[LeftDoubleBracket]", 
                   RowBox[{"All", ",", "i"}], "\[RightDoubleBracket]"}], 
                  "]"}], "\[IndentingNewLine]", ",", 
                 RowBox[{"FourierParameters", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "1"}], ",", " ", "1"}], "}"}]}]}], 
                "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", "2"}], "}"}]}], "]"}], "]"}], 
            "\[LeftDoubleBracket]", 
            RowBox[{"1", ";;", 
             RowBox[{"Round", "[", 
              RowBox[{
               RowBox[{"Length", "[", "differentiatedList", "]"}], "/", "2"}],
               "]"}]}], "\[RightDoubleBracket]"}], ".", 
           "polarizationVector"}], "\[IndentingNewLine]", "]"}], "2"]}], 
       "\[IndentingNewLine]", "]"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["spectrumPlotter", "Subsection"],

Cell["\<\
spectrumPlotter takes a spectrum and a list of options and returns a plot of \
the spectrum. The available options are
  \[CenterDot] a FrequencyAxis option, which will give the harmonic order as \
a horizontal axis by default, and an arbitrary scale with any other option,
  \[CenterDot] all the options of harmonicOrderAxis, which will be passed to \
the call that makes the horizontal axis, and
  \[CenterDot] all the options of ListLinePlot, which will be used to format \
the plot.\
\>", "Text"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"spectrumPlotter", "::", "usage"}], "=", 
   "\"\<spectrumPlotter[spectrum] plots the given spectrum with an \
appropriate axis in a \!\(\*SubscriptBox[\(log\), \(10\)]\) scale.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FrequencyAxis", "::", "usage"}], "=", 
   "\"\<FrequencyAxis is an option for spectrumPlotter which specifies the \
axis to use.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "FrequencyAxis", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "spectrumPlotter", "]"}], "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"FrequencyAxis", "\[Rule]", "\"\<HarmonicOrder\>\""}], "}"}], 
     ",", 
     RowBox[{"Options", "[", "harmonicOrderAxis", "]"}], ",", 
     RowBox[{"Options", "[", "ListLinePlot", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"spectrumPlotter", "[", 
   RowBox[{"spectrum_", ",", 
    RowBox[{"options", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Which", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "FrequencyAxis", "]"}], "===", 
          "\"\<HarmonicOrder\>\""}], ",", "\[IndentingNewLine]", 
         RowBox[{"harmonicOrderAxis", "[", 
          RowBox[{
           RowBox[{"\"\<TargetLength\>\"", "\[Rule]", 
            RowBox[{"Length", "[", "spectrum", "]"}]}], ",", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"FilterRules", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", "options", "}"}], "~", "Join", "~", 
               RowBox[{"Options", "[", "spectrumPlotter", "]"}]}], ",", 
              RowBox[{"Options", "[", "harmonicOrderAxis", "]"}]}], "]"}]}]}],
           "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"OptionValue", "[", "FrequencyAxis", "]"}], "===", 
          "\"\<Frequency\>\""}], ",", "\[IndentingNewLine]", 
         RowBox[{"frequencyAxis", "[", 
          RowBox[{
           RowBox[{"\"\<TargetLength\>\"", "\[Rule]", 
            RowBox[{"Length", "[", "spectrum", "]"}]}], ",", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"FilterRules", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", "options", "}"}], "~", "Join", "~", 
               RowBox[{"Options", "[", "spectrumPlotter", "]"}]}], ",", 
              RowBox[{"Options", "[", "harmonicOrderAxis", "]"}]}], "]"}]}]}],
           "]"}], ",", "\[IndentingNewLine]", "True", ",", 
         RowBox[{"Range", "[", 
          RowBox[{"Length", "[", "spectrum", "]"}], "]"}]}], 
        "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Log", "[", 
        RowBox[{"10", ",", "spectrum"}], "]"}]}], "\[IndentingNewLine]", 
      "}"}], "\[Transpose]"}], "\[IndentingNewLine]", ",", 
    RowBox[{"Sequence", "@@", 
     RowBox[{"FilterRules", "[", 
      RowBox[{
       RowBox[{"{", "options", "}"}], ",", 
       RowBox[{"Options", "[", "ListLinePlot", "]"}]}], "]"}]}], 
    "\[IndentingNewLine]", ",", 
    RowBox[{"Joined", "\[Rule]", "True"}], "\[IndentingNewLine]", ",", 
    RowBox[{"PlotRange", "\[Rule]", "Full"}], "\[IndentingNewLine]", ",", 
    RowBox[{"PlotStyle", "\[Rule]", "Thick"}], "\[IndentingNewLine]", ",", 
    RowBox[{"Frame", "\[Rule]", "True"}], "\[IndentingNewLine]", ",", 
    RowBox[{"Axes", "\[Rule]", "False"}], "\[IndentingNewLine]", ",", 
    RowBox[{"ImageSize", "\[Rule]", "800"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["biColorSpectrum", "Subsection"],

Cell["\<\
biColorSpectrum takes a time-dependent dipole list and produces overlaid \
plots of the right- and left-circular components of the spectrum, in red and \
blue respectively. It takes all the options of getSpectrum and \
spectrumPlotter, which are passed directly to the corresponding calls, as \
well as the options of Show, which can be used to modify the plot appearance.\
\
\>", "Text",
 CellChangeTimes->{}],

Cell[BoxData["Quit"], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"biColorSpectrum", "::", "usage"}], "=", 
   "\"\<biColorSpectrum[DipoleList] produces a two-colour spectrum of \
DipoleList, separating the two circular polarizations.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "biColorSpectrum", "]"}], "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"PlotRange", "\[Rule]", "All"}], "}"}], ",", 
     RowBox[{"Options", "[", "Show", "]"}], ",", 
     RowBox[{"Options", "[", "spectrumPlotter", "]"}], ",", 
     RowBox[{"DeleteCases", "[", 
      RowBox[{
       RowBox[{"Options", "[", "getSpectrum", "]"}], ",", 
       RowBox[{"Polarization", "\[Rule]", "False"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"biColorSpectrum", "[", 
   RowBox[{"dipoleList_", ",", 
    RowBox[{"options", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"Show", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"spectrumPlotter", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"getSpectrum", "[", 
         RowBox[{"dipoleList", ",", 
          RowBox[{"Polarization", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"1", ",", 
             RowBox[{"+", "\[ImaginaryI]"}]}], "}"}]}], ",", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"FilterRules", "[", 
            RowBox[{
             RowBox[{"{", "options", "}"}], ",", 
             RowBox[{"Options", "[", "getSpectrum", "]"}]}], "]"}]}]}], "]"}],
         ",", "\[IndentingNewLine]", 
        RowBox[{"PlotStyle", "\[Rule]", "Red"}], ",", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"{", "options", "}"}], ",", 
           RowBox[{"Options", "[", "spectrumPlotter", "]"}]}], "]"}]}]}], 
       "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"spectrumPlotter", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"getSpectrum", "[", 
         RowBox[{"dipoleList", ",", 
          RowBox[{"Polarization", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"1", ",", 
             RowBox[{"-", "\[ImaginaryI]"}]}], "}"}]}], ",", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"FilterRules", "[", 
            RowBox[{
             RowBox[{"{", "options", "}"}], ",", 
             RowBox[{"Options", "[", "getSpectrum", "]"}]}], "]"}]}]}], "]"}],
         ",", "\[IndentingNewLine]", 
        RowBox[{"PlotStyle", "\[Rule]", "Blue"}], ",", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"{", "options", "}"}], ",", 
           RowBox[{"Options", "[", "spectrumPlotter", "]"}]}], "]"}]}]}], 
       "]"}]}], "\[IndentingNewLine]", "}"}], "\[IndentingNewLine]", ",", 
    RowBox[{"PlotRange", "\[Rule]", 
     RowBox[{"OptionValue", "[", "PlotRange", "]"}]}], "\[IndentingNewLine]", 
    ",", 
    RowBox[{"Sequence", "@@", 
     RowBox[{"FilterRules", "[", 
      RowBox[{
       RowBox[{"{", "options", "}"}], ",", 
       RowBox[{"Options", "[", "Show", "]"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Various gate functions", "Subsection"],

Cell[TextData[{
 "Gate functions are used to suppress the contributions of extra-long \
trajectories with long excursion times, partly to reflect the effect of phase \
matching but mostly to keep integration times reasonable. They are provided \
to the main numerical integrator ",
 StyleBox["makeDipoleList", "Code"],
 " via its ",
 StyleBox["Gate", "Code"],
 " option."
}], "Text"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SineSquaredGate", "::", "usage"}], "=", 
   "\"\<SineSquaredGate[nGateRamp] specifies an integration gate with a \
sine-squared ramp, such that SineSquaredGate[nGateRamp][\[Omega]t,nGate] has \
nGate flat periods and nGateRamp ramp periods.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LinearRampGate", "::", "usage"}], "=", 
   "\"\<LinearRampGate[nGateRamp] specifies an integration gate with a linear \
ramp, such that SineSquaredGate[nGateRamp][\[Omega]t,nGate] has nGate flat \
periods and nGateRamp ramp periods.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SineSquaredGate", "[", "nGateRamp_", "]"}], "[", 
   RowBox[{"\[Omega]\[Tau]_", ",", "nGate_"}], "]"}], ":=", 
  RowBox[{"Piecewise", "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", 
       RowBox[{"\[Omega]\[Tau]", "\[LessEqual]", 
        RowBox[{"2", "\[Pi]", " ", 
         RowBox[{"(", 
          RowBox[{"nGate", "-", "nGateRamp"}], ")"}]}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"Sin", "[", 
         FractionBox[
          RowBox[{
           RowBox[{"2", "\[Pi]", " ", "nGate"}], "-", "\[Omega]\[Tau]"}], 
          RowBox[{"4", "nGateRamp"}]], "]"}], "2"], ",", 
       RowBox[{
        RowBox[{"2", "\[Pi]", " ", 
         RowBox[{"(", 
          RowBox[{"nGate", "-", "nGateRamp"}], ")"}]}], "<", "\[Omega]\[Tau]",
         "\[LessEqual]", 
        RowBox[{"2", "\[Pi]", " ", "nGate"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", 
       RowBox[{"nGate", "<", "\[Omega]\[Tau]"}]}], "}"}]}], "}"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LinearRampGate", "[", "nGateRamp_", "]"}], "[", 
   RowBox[{"\[Omega]\[Tau]_", ",", "nGate_"}], "]"}], ":=", 
  RowBox[{"Piecewise", "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", 
       RowBox[{"\[Omega]\[Tau]", "\[LessEqual]", 
        RowBox[{"2", "\[Pi]", " ", 
         RowBox[{"(", 
          RowBox[{"nGate", "-", "nGateRamp"}], ")"}]}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", 
        FractionBox[
         RowBox[{"\[Omega]\[Tau]", "-", 
          RowBox[{"2", "\[Pi]", " ", 
           RowBox[{"(", 
            RowBox[{"nGate", "+", "nGateRamp"}], ")"}]}]}], 
         RowBox[{"2", "\[Pi]", " ", "nGateRamp"}]]}], ",", 
       RowBox[{
        RowBox[{"2", "\[Pi]", " ", 
         RowBox[{"(", 
          RowBox[{"nGate", "-", "nGateRamp"}], ")"}]}], "<", "\[Omega]\[Tau]",
         "\[LessEqual]", 
        RowBox[{"2", "\[Pi]", " ", "nGate"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", 
       RowBox[{"nGate", "<", "\[Omega]\[Tau]"}]}], "}"}]}], "}"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["getIonizationPotential", "Subsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"getIonizationPotential", "::", "usage"}], "=", 
   "\"\<getIonizationPotential[Target] returns the ionization potential of an \
atomic target, e.g. \\\"Hydrogen\\\", in atomic units.\[IndentingNewLine]\n\
getIonizationPotential[Target,q] returns the ionization potential of the q-th \
ion of the specified Target, in atomic units.\[IndentingNewLine]\n\
getIonizationPotential[{Target,q}] returns the ionization potential of the \
q-th ion of the specified Target, in atomic units.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"getIonizationPotential", "[", 
   RowBox[{"Target_", ",", 
    RowBox[{"Charge_:", "0"}]}], "]"}], ":=", 
  RowBox[{"UnitConvert", "[", 
   FractionBox[
    RowBox[{
     RowBox[{"ElementData", "[", 
      RowBox[{"Target", ",", "\"\<IonizationEnergies\>\""}], "]"}], 
     "\[LeftDoubleBracket]", 
     RowBox[{"Charge", "+", "1"}], "\[RightDoubleBracket]"}], 
    RowBox[{
     RowBox[{"Quantity", "[", 
      RowBox[{"1", ",", "\"\<AvogadroConstant\>\""}], "]"}], 
     RowBox[{"Quantity", "[", 
      RowBox[{"1", ",", "\"\<Hartrees\>\""}], "]"}]}]], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"getIonizationPotential", "[", 
   RowBox[{"{", 
    RowBox[{"Target_", ",", 
     RowBox[{"Charge_:", "0"}]}], "}"}], "]"}], ":=", 
  RowBox[{"getIonizationPotential", "[", 
   RowBox[{"Target", ",", "Charge"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["makeDipoleList: main numerical integrator", "Section"],

Cell[TextData[{
 "The main integration function is ",
 StyleBox["makeDipoleList", "Code"],
 ",  and its basic syntax is of the form ",
 StyleBox["makeDipoleList[VectorPotential\[Rule]A]", "Code"],
 ". Here the vector potential A must be a function object, such that for \
numeric ",
 StyleBox[" t ", "Code"],
 " the construct ",
 StyleBox["A[t]", "Code"],
 " returns a list of numbers after the appropriate field parameters have been \
introduced: thus the criterion is that, for a call of the form ",
 StyleBox["makeDipoleList[VectorPotential\[Rule]A, \
FieldParameters\[Rule]pars]", "Code"],
 ", a call of the form ",
 StyleBox["A[t]//.pars", "Code"],
 " returns a list of numbers for numeric ",
 StyleBox[" t ", "Code"],
 ". To see the available options use ",
 StyleBox["Options[makeDipoleList]", "Code"],
 ", and to get information on each option use the ",
 StyleBox["?VectorPotential", "Code"],
 " construct."
}], "Text"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"makeDipoleList", "::", "usage"}], "=", 
    "\"\<makeDipoleList[VectorPotential\[Rule]A] calculates the dipole \
response to the vector potential A.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"VectorPotential", "::", "usage"}], "=", 
   "\"\<VectorPotential is an option for makeDipole list which specifies the \
field's vector potential. Usage should be VectorPotential\[Rule]A, where \
A[t]//.pars must yield a list of numbers for numeric t and parameters \
indicated by FieldParameters\[Rule]pars.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"VectorPotentialGradient", "::", "usage"}], "=", 
   "\"\<VectorPotentialGradient is an option for makeDipole list which \
specifies the gradient of the field's vector potential. Usage should be \
VectorPotentialGradient\[Rule]GA, where GA[t]//.pars must yield a square \
matrix of the same dimension as the vector potential for numeric t and \
parameters indicated by FieldParameters\[Rule]pars. The indices must be such \
that GA[t]\[LeftDoubleBracket]i,j\[RightDoubleBracket] returns \
\!\(\*SubscriptBox[\(\[PartialD]\), \(i\)]\)\!\(\*SubscriptBox[\(A\), \
\(j\)]\)[t].\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FieldParameters", "::", "usage"}], "=", 
   "\"\<FieldParameters is an option for makeDipole list which \>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Preintegrals", "::", "usage"}], "=", 
   "\"\<Preintegrals is an option for makeDipole list which specifies whether \
the preintegrals of the vector potential should be \\\"Analytic\\\" or \
\\\"Numeric\\\".\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReportingFunction", "::", "usage"}], "=", 
   "\"\<ReportingFunction is an option for makeDipole list which specifies a \
function used to report the results, either internally (by the default, \
Identity) or to an external file.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Gate", "::", "usage"}], "=", 
   "\"\<Gate is an option for makeDipole list which specifies the integration \
gate to use. Usage as Gate\[Rule]g, nGate\[Rule]n will gate the integral at \
time \[Omega]t/\[Omega] by g[\[Omega]t,n]. The default is \
Gate\[Rule]SineSquaredGate[1/2].\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"nGate", "::", "usage"}], "=", 
   "\"\<nGate is an option for makeDipole list which specifies the total \
number of cycles in the integration gate.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IonizationPotential", "::", "usage"}], "=", 
   "\"\<IonizationPotential is an option for makeDipoleList which specifies \
the ionization potential \!\(\*SubscriptBox[\(I\), \(p\)]\) of the \
target.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Target", "::", "usage"}], "=", 
   "\"\<Target is an option for makeDipoleList which specifies chemical \
species producing the HHG emission, pulling the ionization potential from the \
Wolfram ElementData curated data set.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DipoleTransitionMatrixElement", "::", "usage"}], "=", 
   "\"\<DipoleTransitionMatrixElement is an option for makeDipoleList which \
secifies a function f to use as the dipole transition matrix element, or a \
pair of functions {\!\(\*SubscriptBox[\(f\), \
\(ion\)]\),\!\(\*SubscriptBox[\(f\), \(rec\)]\)} to be used separately for \
the ionization and recombination dipoels, to be used in the form \
f[p,\[Kappa]]=f[p,\!\(\*SqrtBox[\(2 \*SubscriptBox[\(I\), \
\(p\)]\)]\)].\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Epsilon]Correction", "::", "usage"}], "=", 
   "\"\<\[Epsilon]Correction is an option for makeDipoleList which specifies \
the regularization correction \[Epsilon], i.e. as used in the factor \
\!\(\*FractionBox[\(1\), SuperscriptBox[\((t - tt + \[ImaginaryI]\\\ \
\[Epsilon])\), \(3/2\)]]\).\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PointNumberCorrection", "::", "usage"}], "=", 
   "\"\<PointNumberCorrection is an option for makeDipoleList and timeAxis \
which specifies an extra number of points to be integrated over, which is \
useful to prevent Indeterminate errors when a Piecewise envelope is being \
differentiated at the boundaries.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IntegrationPointsPerCycle", "::", "usage"}], "=", 
   "\"\<IntegrationPointsPerCycle is an option for makeDipoleList which \
controls the number of points per cycle to use for the integration. Set to \
Automatic, to follow PointsPerCycle, or to an integer.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RunInParallel", "::", "usage"}], "=", 
   "\"\<RunInParallel is an option for makeDipoleList which controls whether \
each RB-SFA instance is parallelized. It accepts False as the (Automatic) \
option, True, to parallelize each instance, or a pair of functions \
{TableCommand, SumCommand} to use for the iteration and summing, which could \
be e.g. {Inactive[ParallelTable], Inactive[Sum]}.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Simplifier", "::", "usage"}], "=", 
    "\"\<Simplifier is an option for makeDipoleList which specifies a \
function to use to simplify the intermediate and final analytical \
results.\>\""}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Protect", "[", 
    RowBox[{
    "VectorPotential", ",", "VectorPotentialGradient", ",", "FieldParameters",
      ",", "Preintegrals", ",", "ReportingFunction", ",", "Gate", ",", 
     "nGate", ",", "IonizationPotential", ",", "Target", ",", 
     "\[Epsilon]Correction", ",", "PointNumberCorrection", ",", 
     "DipoleTransitionMatrixElement", ",", "IntegrationPointsPerCycle", ",", 
     "RunInParallel", ",", "Simplifier"}], "]"}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "makeDipoleList", "]"}], "=", 
   RowBox[{"standardOptions", "~", "Join", "~", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"VectorPotential", "\[Rule]", "Automatic"}], ",", 
      RowBox[{"FieldParameters", "\[Rule]", 
       RowBox[{"{", "}"}]}], ",", 
      RowBox[{"VectorPotentialGradient", "\[Rule]", "None"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Preintegrals", "\[Rule]", "\"\<Analytic\>\""}], ",", 
      RowBox[{"ReportingFunction", "\[Rule]", "Identity"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Gate", "\[Rule]", 
       RowBox[{"SineSquaredGate", "[", 
        RowBox[{"1", "/", "2"}], "]"}]}], ",", 
      RowBox[{"nGate", "\[Rule]", 
       RowBox[{"3", "/", "2"}]}], ",", 
      RowBox[{"\[Epsilon]Correction", "\[Rule]", "0.1"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"IonizationPotential", "\[Rule]", "0.5"}], ",", 
      RowBox[{"Target", "\[Rule]", "Automatic"}], ",", 
      RowBox[{"DipoleTransitionMatrixElement", "\[Rule]", "hydrogenicDTME"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{"PointNumberCorrection", "\[Rule]", "0"}], ",", 
      RowBox[{"Verbose", "\[Rule]", "0"}], ",", "\[IndentingNewLine]", 
      RowBox[{"RunInParallel", "\[Rule]", "Automatic"}], ",", 
      RowBox[{"IntegrationPointsPerCycle", "\[Rule]", "Automatic"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Simplifier", "\[Rule]", "Identity"}]}], "\[IndentingNewLine]", 
     "}"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makeDipoleList", "::", "gate"}], "=", 
   "\"\<The integration gate g provided as Gate\[Rule]`1` is incorrect. Its \
usage as g[`2`,`3`] returns `4` and should return a number.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makeDipoleList", "::", "pot"}], "=", 
   "\"\<The vector potential A provided as VectorPotential\[Rule]`1` is \
incorrect or is missing FieldParameters. Its usage as A[`2`] returns `3` and \
should return a list of numbers.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makeDipoleList", "::", "gradpot"}], "=", 
   "\"\<The vector potential GA provided as VectorPotentialGradient\[Rule]`1` \
is incorrect or is missing FieldParameters. Its usage as GA[`2`] returns `3` \
and should return a square matrix of numbers. Alternatively, use \
VectorPotentialGradient\[Rule]None.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makeDipoleList", "::", "preint"}], "=", 
   "\"\<Wrong Preintegrals option `1`. Valid options are \\\"Analytic\\\" and \
\\\"Numeric\\\".\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"makeDipoleList", "::", "runpar"}], "=", 
    "\"\<Wrong RunInParallel option `1`.\>\""}], ";"}], "\[IndentingNewLine]",
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"makeDipoleList", "[", 
   RowBox[{"OptionsPattern", "[", "]"}], "]"}], ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"num", "=", 
       RowBox[{"OptionValue", "[", "TotalCycles", "]"}]}], ",", 
      RowBox[{"npp", "=", 
       RowBox[{"OptionValue", "[", "PointsPerCycle", "]"}]}], ",", 
      RowBox[{"\[Omega]", "=", 
       RowBox[{"OptionValue", "[", "CarrierFrequency", "]"}]}], ",", 
      "\[IndentingNewLine]", "dipoleRec", ",", "dipoleIon", ",", "\[Kappa]", 
      ",", "\[IndentingNewLine]", "A", ",", "F", ",", "GA", ",", "pi", ",", 
      "ps", ",", "S", ",", "\[IndentingNewLine]", "gate", ",", "tGate", ",", 
      "setPreintegral", ",", "\[IndentingNewLine]", "tInit", ",", "tFinal", 
      ",", "\[Delta]t", ",", "\[Delta]tint", ",", 
      RowBox[{"\[Epsilon]", "=", 
       RowBox[{"OptionValue", "[", "\[Epsilon]Correction", "]"}]}], ",", 
      "\[IndentingNewLine]", "AInt", ",", "A2Int", ",", "GAInt", ",", 
      "GAdotAInt", ",", "AdotGAInt", ",", "GAIntInt", ",", 
      "\[IndentingNewLine]", "PScorrectionInt", ",", "constCorrectionInt", 
      ",", "GAIntdotGAIntInt", ",", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{",", "bigPScorrectionInt", ",", "AdotGAdotAInt", ","}], "*)"}],
       "\[IndentingNewLine]", "simplifier", ",", "prefactor", ",", 
      "integrand", ",", "dipoleList", ",", "\[IndentingNewLine]", 
      "TableCommand", ",", "SumCommand"}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"A", "[", "t_", "]"}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{"OptionValue", "[", "VectorPotential", "]"}], "[", "t", "]"}],
        "//.", 
       RowBox[{"OptionValue", "[", "FieldParameters", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"F", "[", "t_", "]"}], "=", 
      RowBox[{"-", 
       RowBox[{"D", "[", 
        RowBox[{
         RowBox[{"A", "[", "t", "]"}], ",", "t"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"GA", "[", "t_", "]"}], "=", 
      RowBox[{"If", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"TrueQ", "[", 
         RowBox[{
          RowBox[{"OptionValue", "[", "VectorPotentialGradient", "]"}], 
          "\[Equal]", "None"}], "]"}], ",", "        ", 
        RowBox[{"Table", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{"Length", "[", 
            RowBox[{"A", "[", "tInit", "]"}], "]"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"Length", "[", 
            RowBox[{"A", "[", "tInit", "]"}], "]"}], "}"}]}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "VectorPotentialGradient", "]"}], "[", 
          "t", "]"}], "//.", 
         RowBox[{"OptionValue", "[", "FieldParameters", "]"}]}]}], 
       "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"tInit", "=", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{"tFinal", "=", 
      RowBox[{
       FractionBox[
        RowBox[{"2", "\[Pi]"}], "\[Omega]"], " ", "num"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"looping", " ", "timestep"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"\[Delta]t", "=", 
      FractionBox[
       RowBox[{"tFinal", "-", "tInit"}], 
       RowBox[{
        RowBox[{"num", "\[Times]", "npp"}], "+", 
        RowBox[{"OptionValue", "[", "PointNumberCorrection", "]"}]}]]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"integration", " ", "timestep"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"\[Delta]tint", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"OptionValue", "[", "IntegrationPointsPerCycle", "]"}], "===",
          "Automatic"}], ",", "\[Delta]t", ",", 
        FractionBox[
         RowBox[{"tFinal", "-", "tInit"}], 
         RowBox[{
          RowBox[{"num", "\[Times]", 
           RowBox[{"OptionValue", "[", "IntegrationPointsPerCycle", "]"}]}], 
          "+", 
          RowBox[{"OptionValue", "[", "PointNumberCorrection", "]"}]}]]}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"tGate", "=", 
      RowBox[{
       RowBox[{"OptionValue", "[", "nGate", "]"}], 
       FractionBox[
        RowBox[{"2", "\[Pi]"}], "\[Omega]"]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"(*", 
       RowBox[{
       "Check", " ", "potential", " ", "and", " ", "potential", " ", 
        "gradient", " ", "for", " ", 
        RowBox[{"correctness", "."}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\[Omega]tRandom", "=", 
           RowBox[{"RandomReal", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\[Omega]", " ", "tInit"}], ",", 
              RowBox[{"\[Omega]", " ", "tFinal"}]}], "}"}], "]"}]}], "}"}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"OptionValue", "[", "Verbose", "]"}], "\[NotEqual]", 
            "3"}], 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
             "Turn", " ", "off", " ", "numerics", " ", "check", " ", "if", 
              " ", "quantum"}], "-", 
             RowBox[{
             "orbits", " ", "verbose", " ", "option", " ", "is", " ", "in", 
              " ", 
              RowBox[{"use", "."}]}]}], "*)"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"!", 
               RowBox[{"And", "@@", 
                RowBox[{"(", 
                 RowBox[{"NumberQ", "/@", 
                  RowBox[{"A", "[", 
                   RowBox[{"\[Omega]tRandom", "/", "\[Omega]"}], "]"}]}], 
                 ")"}]}]}], ",", 
              RowBox[{
               RowBox[{"Message", "[", 
                RowBox[{
                 RowBox[{"makeDipoleList", "::", "pot"}], ",", 
                 RowBox[{"OptionValue", "[", "VectorPotential", "]"}], ",", 
                 "\[Omega]tRandom", ",", 
                 RowBox[{"A", "[", "\[Omega]tRandom", "]"}]}], "]"}], ";", 
               RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"!", 
               RowBox[{"And", "@@", 
                RowBox[{"(", 
                 RowBox[{"NumberQ", "/@", 
                  RowBox[{"Flatten", "[", 
                   RowBox[{"GA", "[", 
                    RowBox[{"\[Omega]tRandom", "/", "\[Omega]"}], "]"}], 
                   "]"}]}], ")"}]}]}], ",", 
              RowBox[{
               RowBox[{"Message", "[", 
                RowBox[{
                 RowBox[{"makeDipoleList", "::", "gradpot"}], ",", 
                 RowBox[{"OptionValue", "[", "VectorPotentialGradient", "]"}],
                  ",", "\[Omega]tRandom", ",", 
                 RowBox[{"GA", "[", "\[Omega]tRandom", "]"}]}], "]"}], ";", 
               RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}]}], "]"}], ";"}], "*)"}], 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"gate", "[", "\[Omega]\[Tau]_", "]"}], ":=", 
      RowBox[{
       RowBox[{"OptionValue", "[", "Gate", "]"}], "[", 
       RowBox[{"\[Omega]\[Tau]", ",", 
        RowBox[{"OptionValue", "[", "nGate", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]tRandom", "=", 
         RowBox[{"RandomReal", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"\[Omega]", " ", "tInit"}], ",", 
            RowBox[{"\[Omega]", " ", "tFinal"}]}], "}"}], "]"}]}], "}"}], ",",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"!", 
          RowBox[{"TrueQ", "[", 
           RowBox[{"NumberQ", "[", 
            RowBox[{"gate", "[", "\[Omega]tRandom", "]"}], "]"}], "]"}]}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"makeDipoleList", "::", "gate"}], ",", 
            RowBox[{"OptionValue", "[", "Gate", "]"}], ",", "\[Omega]tRandom",
             ",", 
            RowBox[{"OptionValue", "[", "nGate", "]"}], ",", 
            RowBox[{"gate", "[", "\[Omega]tRandom", "]"}]}], "]"}], ";", 
          RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], "\[IndentingNewLine]", 
      "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Target", " ", "setup"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Which", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"OptionValue", "[", "Target", "]"}], "===", "Automatic"}], 
       ",", 
       RowBox[{"\[Kappa]", "=", 
        SqrtBox[
         RowBox[{"2", 
          RowBox[{"OptionValue", "[", "IonizationPotential", "]"}]}]]}], ",", 
       "\[IndentingNewLine]", "True", ",", 
       RowBox[{"\[Kappa]", "=", 
        SqrtBox[
         RowBox[{"2", 
          RowBox[{"getIonizationPotential", "[", 
           RowBox[{"OptionValue", "[", "Target", "]"}], "]"}]}]]}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"dim", "=", 
         RowBox[{"Length", "[", 
          RowBox[{"A", "[", 
           RowBox[{"RandomReal", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\[Omega]", " ", "tInit"}], ",", 
              RowBox[{"\[Omega]", " ", "tFinal"}]}], "}"}], "]"}], "]"}], 
          "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Explicit", " ", "conjugation", " ", "of", " ", "the", " ", 
         "recombination", " ", "matrix", " ", "element", " ", "to", " ", 
         "keep", " ", "the", " ", "integrand", " ", 
         RowBox[{"analytic", "."}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Which", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", 
            RowBox[{
            "OptionValue", "[", "DipoleTransitionMatrixElement", "]"}], "]"}],
            "===", "List"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"dipoleIon", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"p1_", ",", "p2_", ",", "p3_"}], "}"}], 
               "\[LeftDoubleBracket]", 
               RowBox[{"1", ";;", "dim"}], "\[RightDoubleBracket]"}], ",", 
              "\[Kappa]\[Kappa]_"}], "]"}], "=", 
            RowBox[{
             RowBox[{"First", "[", 
              RowBox[{
              "OptionValue", "[", "DipoleTransitionMatrixElement", "]"}], 
              "]"}], "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"p1", ",", "p2", ",", "p3"}], "}"}], 
               "\[LeftDoubleBracket]", 
               RowBox[{"1", ";;", "dim"}], "\[RightDoubleBracket]"}], ",", 
              "\[Kappa]\[Kappa]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"dipoleRec", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"p1_", ",", "p2_", ",", "p3_"}], "}"}], 
               "\[LeftDoubleBracket]", 
               RowBox[{"1", ";;", "dim"}], "\[RightDoubleBracket]"}], ",", 
              "\[Kappa]\[Kappa]_"}], "]"}], "=", 
            RowBox[{"Assuming", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                 "p1", ",", "p2", ",", "p3", ",", "\[Kappa]\[Kappa]"}], "}"}],
                 "\[Element]", "Reals"}], "}"}], ",", 
              RowBox[{"Simplify", "[", "\[IndentingNewLine]", 
               RowBox[{"Conjugate", "[", 
                RowBox[{
                 RowBox[{"Last", "[", 
                  RowBox[{
                  "OptionValue", "[", "DipoleTransitionMatrixElement", "]"}], 
                  "]"}], "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"p1", ",", "p2", ",", "p3"}], "}"}], 
                   "\[LeftDoubleBracket]", 
                   RowBox[{"1", ";;", "dim"}], "\[RightDoubleBracket]"}], ",",
                   "\[Kappa]\[Kappa]"}], "]"}], "]"}], "\[IndentingNewLine]", 
               "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", ",", "True", 
          ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"dipoleIon", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"p1_", ",", "p2_", ",", "p3_"}], "}"}], 
               "\[LeftDoubleBracket]", 
               RowBox[{"1", ";;", "dim"}], "\[RightDoubleBracket]"}], ",", 
              "\[Kappa]\[Kappa]_"}], "]"}], "=", 
            RowBox[{
             RowBox[{
             "OptionValue", "[", "DipoleTransitionMatrixElement", "]"}], "[", 
             
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"p1", ",", "p2", ",", "p3"}], "}"}], 
               "\[LeftDoubleBracket]", 
               RowBox[{"1", ";;", "dim"}], "\[RightDoubleBracket]"}], ",", 
              "\[Kappa]\[Kappa]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"dipoleRec", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"p1_", ",", "p2_", ",", "p3_"}], "}"}], 
               "\[LeftDoubleBracket]", 
               RowBox[{"1", ";;", "dim"}], "\[RightDoubleBracket]"}], ",", 
              "\[Kappa]\[Kappa]_"}], "]"}], "=", 
            RowBox[{"Assuming", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                 "p1", ",", "p2", ",", "p3", ",", "\[Kappa]\[Kappa]"}], "}"}],
                 "\[Element]", "Reals"}], "}"}], ",", 
              RowBox[{"Simplify", "[", "\[IndentingNewLine]", 
               RowBox[{"Conjugate", "[", 
                RowBox[{
                 RowBox[{
                 "OptionValue", "[", "DipoleTransitionMatrixElement", "]"}], 
                 "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"p1", ",", "p2", ",", "p3"}], "}"}], 
                   "\[LeftDoubleBracket]", 
                   RowBox[{"1", ";;", "dim"}], "\[RightDoubleBracket]"}], ",",
                   "\[Kappa]\[Kappa]"}], "]"}], "]"}], "\[IndentingNewLine]", 
               "]"}]}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
        ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"simplifier", "=", 
      RowBox[{"OptionValue", "[", "Simplifier", "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"setPreintegral", "[", 
       RowBox[{
       "integralVariable_", ",", "preintegrand_", ",", "dimensions_", ",", 
        "integrateWithoutGradient_", ",", "parametric_"}], "]"}], ":=", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "VectorPotentialGradient", "]"}], "=!=",
           "None"}], "||", 
         RowBox[{"TrueQ", "[", "integrateWithoutGradient", "]"}]}], ",", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Vector", " ", "potential", " ", "gradient", " ", "specified"}], 
          ",", " ", 
          RowBox[{
          "or", " ", "integral", " ", "variable", " ", "does", " ", "not", 
           " ", "depend", " ", "on", " ", "it"}], ",", " ", 
          RowBox[{"so", " ", "integrate"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Which", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"OptionValue", "[", "Preintegrals", "]"}], "\[Equal]", 
            "\"\<Analytic\>\""}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"integralVariable", "[", 
              RowBox[{"t_", ",", "tt_"}], "]"}], "=", 
             RowBox[{"simplifier", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"#", "/.", 
                    RowBox[{"{", 
                    RowBox[{"\[Tau]", "\[Rule]", "t"}], "}"}]}], ")"}], "-", 
                  RowBox[{"(", 
                   RowBox[{"#", "/.", 
                    RowBox[{"{", 
                    RowBox[{"\[Tau]", "\[Rule]", "tt"}], "}"}]}], ")"}]}], 
                 ")"}], "&"}], "[", 
               RowBox[{"Integrate", "[", 
                RowBox[{
                 RowBox[{"preintegrand", "[", 
                  RowBox[{"\[Tau]", ",", "tt"}], "]"}], ",", "\[Tau]"}], 
                "]"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
           "\[IndentingNewLine]", ",", 
           RowBox[{
            RowBox[{"OptionValue", "[", "Preintegrals", "]"}], "\[Equal]", 
            "\"\<Numeric\>\""}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Which", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"TrueQ", "[", 
               RowBox[{"Not", "[", "parametric", "]"}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Block", "[", 
                RowBox[{
                 RowBox[{"{", "innerVariable", "}"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"integralVariable", "[", 
                   RowBox[{"t_", ",", "tt_"}], "]"}], "=", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"innerVariable", "[", "t", "]"}], "-", 
                    RowBox[{"innerVariable", "[", "tt", "]"}]}], "/.", 
                    RowBox[{"First", "[", "\[IndentingNewLine]", 
                    RowBox[{"NDSolve", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"innerVariable", "'"}], "[", "\[Tau]", "]"}], 
                    "\[Equal]", 
                    RowBox[{"preintegrand", "[", "\[Tau]", "]"}]}], ",", 
                    RowBox[{
                    RowBox[{"innerVariable", "[", "tInit", "]"}], "\[Equal]", 
                    
                    RowBox[{"ConstantArray", "[", 
                    RowBox[{"0", ",", "dimensions"}], "]"}]}]}], "}"}], ",", 
                    "innerVariable", ",", 
                    RowBox[{"{", 
                    RowBox[{"\[Tau]", ",", "tInit", ",", "tFinal"}], "}"}], 
                    ",", 
                    RowBox[{"MaxStepSize", "\[Rule]", 
                    RowBox[{"0.25", "/", "\[Omega]"}]}]}], "]"}], 
                    "\[IndentingNewLine]", "]"}]}], ")"}]}]}], 
                "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
              ",", "True", ",", "\[IndentingNewLine]", 
              RowBox[{"Block", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                 "matrixpreintegrand", ",", "innerVariable", ",", 
                  "\[Tau]pre"}], "}"}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"matrixpreintegrand", "[", 
                   RowBox[{"indices_", ",", 
                    RowBox[{"t_", "?", "NumericQ"}], ",", 
                    RowBox[{"tt_", "?", "NumericQ"}]}], "]"}], ":=", 
                  RowBox[{
                   RowBox[{"preintegrand", "[", 
                    RowBox[{"t", ",", "tt"}], "]"}], "\[LeftDoubleBracket]", 
                   RowBox[{
                    RowBox[{"##", "&"}], "@@", "indices"}], 
                   "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"integralVariable", "[", 
                   RowBox[{"t_", ",", "tt_"}], "]"}], "=", 
                  RowBox[{"Array", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"innerVariable", "[", "##", "]"}], "[", 
                    RowBox[{
                    RowBox[{"t", "-", "tt"}], ",", "tt"}], "]"}], "/.", 
                    RowBox[{"First", "@", 
                    RowBox[{"NDSolve", "[", 
                    RowBox[{
                    RowBox[{"{", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"D", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"innerVariable", "[", "##", "]"}], "[", 
                    RowBox[{"\[Tau]pre", ",", "tt"}], "]"}], ",", 
                    "\[Tau]pre"}], "]"}], "\[Equal]", 
                    RowBox[{"Piecewise", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"matrixpreintegrand", "[", 
                    RowBox[{
                    RowBox[{"{", "##", "}"}], ",", 
                    RowBox[{"tt", "+", "\[Tau]pre"}], ",", "tt"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"tt", "+", "\[Tau]pre"}], "\[LessEqual]", 
                    "tFinal"}]}], "}"}], "}"}], ",", "0"}], "]"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"innerVariable", "[", "##", "]"}], "[", 
                    RowBox[{"0", ",", "tt"}], "]"}], "\[Equal]", "0"}]}], 
                    "\[IndentingNewLine]", "}"}], ",", 
                    RowBox[{"innerVariable", "[", "##", "]"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"\[Tau]pre", ",", "0", ",", 
                    RowBox[{"tFinal", "-", "tInit"}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"tt", ",", "tInit", ",", "tFinal"}], "}"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"MaxStepSize", "\[Rule]", 
                    RowBox[{"0.25", "/", "\[Omega]"}]}]}], 
                    "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
                    ")"}], "&"}], ",", "dimensions"}], "]"}]}], ";"}]}], 
               "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], 
            ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{
         RowBox[{"OptionValue", "[", "VectorPotentialGradient", "]"}], "===", 
         "None"}], ",", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Vector", " ", "potential", " ", "gradient", " ", "has", " ", "not",
            " ", "been", " ", "specified"}], ",", " ", 
          RowBox[{
          "and", " ", "integral", " ", "variable", " ", "depends", " ", "on", 
           " ", "it"}], ",", " ", 
          RowBox[{
          "so", " ", "return", " ", "appropriate", " ", "zero", " ", 
           "matrix"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"integralVariable", "[", "t_", "]"}], "=", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0", ",", "dimensions"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"integralVariable", "[", 
           RowBox[{"t_", ",", "tt_"}], "]"}], "=", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0", ",", "dimensions"}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Apply", "[", 
      RowBox[{"setPreintegral", ",", 
       RowBox[{"(", GridBox[{
          {"AInt", 
           RowBox[{
            RowBox[{"A", "[", "#1", "]"}], "&"}], 
           RowBox[{"{", 
            RowBox[{"Length", "[", 
             RowBox[{"A", "[", "tInit", "]"}], "]"}], "}"}], "True", 
           "False"},
          {"A2Int", 
           RowBox[{
            RowBox[{
             RowBox[{"A", "[", "#1", "]"}], ".", 
             RowBox[{"A", "[", "#1", "]"}]}], "&"}], 
           RowBox[{"{", "}"}], "True", "False"},
          {"GAInt", 
           RowBox[{
            RowBox[{"GA", "[", "#1", "]"}], "&"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"A", "[", "tInit", "]"}], "]"}], ",", 
             RowBox[{"Length", "[", 
              RowBox[{"A", "[", "tInit", "]"}], "]"}]}], "}"}], "False", 
           "False"},
          {"GAdotAInt", 
           RowBox[{
            RowBox[{
             RowBox[{"GA", "[", "#1", "]"}], ".", 
             RowBox[{"A", "[", "#1", "]"}]}], "&"}], 
           RowBox[{"{", 
            RowBox[{"Length", "[", 
             RowBox[{"A", "[", "tInit", "]"}], "]"}], "}"}], "False", "False"},
          {"AdotGAInt", 
           RowBox[{
            RowBox[{
             RowBox[{"A", "[", "#1", "]"}], ".", 
             RowBox[{"GA", "[", "#1", "]"}]}], "&"}], 
           RowBox[{"{", 
            RowBox[{"Length", "[", 
             RowBox[{"A", "[", "tInit", "]"}], "]"}], "}"}], "False", "False"},
          {"GAIntInt", 
           RowBox[{
            RowBox[{"GAInt", "[", 
             RowBox[{"#1", ",", "#2"}], "]"}], "&"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"A", "[", "tInit", "]"}], "]"}], ",", 
             RowBox[{"Length", "[", 
              RowBox[{"A", "[", "tInit", "]"}], "]"}]}], "}"}], "False", 
           "True"},
          {"PScorrectionInt", 
           RowBox[{
            RowBox[{
             RowBox[{"GAdotAInt", "[", 
              RowBox[{"#1", ",", "#2"}], "]"}], "+", 
             RowBox[{
              RowBox[{"A", "[", "#1", "]"}], ".", 
              RowBox[{"GAInt", "[", 
               RowBox[{"#1", ",", "#2"}], "]"}]}], "-", 
             RowBox[{
              RowBox[{
               RowBox[{"GAInt", "[", 
                RowBox[{"#1", ",", "#2"}], "]"}], "\[Transpose]"}], ".", 
              RowBox[{"GAdotAInt", "[", 
               RowBox[{"#1", ",", "#2"}], "]"}]}]}], "&"}], 
           RowBox[{"{", 
            RowBox[{"Length", "[", 
             RowBox[{"A", "[", "tInit", "]"}], "]"}], "}"}], "False", 
           "True"},
          {"GAIntdotGAIntInt", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"GAInt", "[", 
               RowBox[{"#1", ",", "#2"}], "]"}], "\[Transpose]"}], ".", 
             RowBox[{"GAInt", "[", 
              RowBox[{"#1", ",", "#2"}], "]"}]}], "&"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"A", "[", "tInit", "]"}], "]"}], ",", 
             RowBox[{"Length", "[", 
              RowBox[{"A", "[", "tInit", "]"}], "]"}]}], "}"}], "False", 
           "True"},
          {"constCorrectionInt", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"A", "[", "#1", "]"}], "-", 
               RowBox[{
                FractionBox["1", "2"], 
                RowBox[{"GAdotAInt", "[", 
                 RowBox[{"#1", ",", "#2"}], "]"}]}]}], ")"}], ".", 
             RowBox[{"GAdotAInt", "[", 
              RowBox[{"#1", ",", "#2"}], "]"}]}], "&"}], 
           RowBox[{"{", "}"}], "False", "True"}
         },
         GridBoxAlignment->{"Columns" -> {{Left}}}], ")"}], ",", 
       RowBox[{"{", "1", "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          SubsuperscriptBox["\[Integral]", 
           SubscriptBox["t", "0"], "t"], 
          RowBox[{"A", 
           RowBox[{"(", "\[Tau]", ")"}], 
           RowBox[{"\[DifferentialD]", "\[Tau]"}]}]}], ",", 
         RowBox[{
          SubsuperscriptBox["\[Integral]", 
           SubscriptBox["t", "0"], "t"], 
          RowBox[{"A", 
           SuperscriptBox[
            RowBox[{"(", "\[Tau]", ")"}], "2"], 
           RowBox[{"\[DifferentialD]", "\[Tau]"}]}]}], ",", 
         RowBox[{
          SubsuperscriptBox["\[Integral]", 
           SubscriptBox["t", "0"], "t"], 
          RowBox[{
           RowBox[{"\[Del]", "A"}], 
           RowBox[{"(", "\[Tau]", ")"}], 
           RowBox[{"\[DifferentialD]", "\[Tau]"}]}]}], ",", 
         RowBox[{
          SubsuperscriptBox["\[Integral]", 
           SubscriptBox["t", "0"], "t"], 
          RowBox[{
           RowBox[{"\[Del]", "A"}], 
           RowBox[{
            RowBox[{"(", "\[Tau]", ")"}], "\[CenterDot]", "A"}], 
           RowBox[{"(", "\[Tau]", ")"}], 
           RowBox[{"\[DifferentialD]", "\[Tau]"}]}]}], ",", 
         RowBox[{
          SubsuperscriptBox["\[Integral]", 
           SubscriptBox["t", "0"], "t"], 
          RowBox[{"A", 
           RowBox[{
            RowBox[{"(", "\[Tau]", ")"}], "\[CenterDot]", 
            RowBox[{"\[Del]", "A"}]}], 
           RowBox[{"(", "\[Tau]", ")"}], 
           RowBox[{"\[DifferentialD]", "\[Tau]"}]}]}], ",", 
         RowBox[{
          SubsuperscriptBox["\[Integral]", 
           RowBox[{"t", "'"}], "t"], 
          RowBox[{
           SubsuperscriptBox["\[Integral]", 
            RowBox[{"t", "'"}], "\[Tau]"], 
           RowBox[{
            RowBox[{"\[Del]", "A"}], 
            RowBox[{"(", 
             RowBox[{"\[Tau]", "'"}], ")"}], 
            RowBox[{"\[DifferentialD]", 
             RowBox[{"\[Tau]", "'"}]}], 
            RowBox[{"\[DifferentialD]", "\[Tau]"}]}]}]}], ",", 
         RowBox[{
          RowBox[{
           SubsuperscriptBox["\[Integral]", 
            RowBox[{"t", "'"}], "t"], 
           RowBox[{
            SubsuperscriptBox["\[Integral]", 
             RowBox[{"t", "'"}], "\[Tau]"], 
            RowBox[{
             RowBox[{
              SubscriptBox["\[PartialD]", "j"], 
              SubscriptBox["A", "k"]}], 
             RowBox[{"(", 
              RowBox[{"\[Tau]", "'"}], ")"}], 
             SubscriptBox["A", "k"], 
             RowBox[{"(", 
              RowBox[{"\[Tau]", "'"}], ")"}], 
             RowBox[{"\[DifferentialD]", 
              RowBox[{"\[Tau]", "'"}]}]}]}]}], "+", 
          RowBox[{
           SubscriptBox["A", "k"], 
           RowBox[{"(", "\[Tau]", ")"}], 
           RowBox[{
            SubsuperscriptBox["\[Integral]", 
             RowBox[{"t", "'"}], "\[Tau]"], 
            RowBox[{
             RowBox[{
              SubscriptBox["\[PartialD]", "k"], 
              SubscriptBox["A", "j"]}], 
             RowBox[{"(", 
              RowBox[{"\[Tau]", "'"}], ")"}], 
             RowBox[{"\[DifferentialD]", 
              RowBox[{"\[Tau]", "'"}]}]}]}]}], "-", 
          RowBox[{
           SubsuperscriptBox["\[Integral]", 
            RowBox[{"t", "'"}], "\[Tau]"], 
           RowBox[{
            RowBox[{
             SubscriptBox["\[PartialD]", "i"], 
             SubscriptBox["A", "j"]}], 
            RowBox[{"(", 
             RowBox[{"\[Tau]", "'"}], ")"}], 
            RowBox[{"\[DifferentialD]", 
             RowBox[{"\[Tau]", "'"}]}], 
            RowBox[{
             SubsuperscriptBox["\[Integral]", 
              RowBox[{"t", "'"}], "\[Tau]"], 
             RowBox[{
              RowBox[{
               SubscriptBox["\[PartialD]", "i"], 
               SubscriptBox["A", "k"]}], 
              RowBox[{"(", 
               RowBox[{"\[Tau]", "'"}], ")"}], 
              SubscriptBox["A", "k"], 
              RowBox[{"(", 
               RowBox[{"\[Tau]", "'"}], ")"}], 
              RowBox[{"\[DifferentialD]", 
               RowBox[{"\[Tau]", "'"}]}], 
              RowBox[{"\[DifferentialD]", "\[Tau]"}]}]}]}]}]}], ",", 
         RowBox[{
          SubsuperscriptBox["\[Integral]", 
           RowBox[{"t", "'"}], "t"], 
          RowBox[{
           SubsuperscriptBox["\[Integral]", 
            SubscriptBox["t", "0"], "t"], 
           RowBox[{
            RowBox[{
             SubscriptBox["\[PartialD]", "i"], 
             SubscriptBox["A", "j"]}], 
            RowBox[{"(", 
             RowBox[{"\[Tau]", "'"}], ")"}], 
            SubscriptBox["A", "j"], 
            RowBox[{"(", 
             RowBox[{"\[Tau]", "'"}], ")"}], 
            RowBox[{"\[DifferentialD]", 
             RowBox[{"\[Tau]", "'"}]}], 
            RowBox[{
             SubsuperscriptBox["\[Integral]", 
              SubscriptBox["t", "0"], "t"], 
             RowBox[{
              RowBox[{
               SubscriptBox["\[PartialD]", "i"], 
               SubscriptBox["A", "k"]}], 
              RowBox[{"(", 
               RowBox[{"\[Tau]", "'"}], ")"}], 
              SubscriptBox["A", "k"], 
              RowBox[{"(", 
               RowBox[{"\[Tau]", "'"}], ")"}], 
              RowBox[{"\[DifferentialD]", 
               RowBox[{"\[Tau]", "'"}]}], 
              RowBox[{"\[DifferentialD]", "\[Tau]"}]}]}]}]}]}], ",", 
         RowBox[{
          SubsuperscriptBox["\[Integral]", 
           RowBox[{"t", "'"}], "t"], 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              SubscriptBox["A", "k"], 
              RowBox[{"(", "\[Tau]", ")"}]}], "-", 
             RowBox[{
              FractionBox["1", "2"], 
              RowBox[{
               SubsuperscriptBox["\[Integral]", 
                RowBox[{"t", "'"}], "\[Tau]"], 
               RowBox[{
                RowBox[{
                 SubscriptBox["\[PartialD]", "k"], 
                 SubscriptBox["A", "i"]}], 
                RowBox[{"(", 
                 RowBox[{"\[Tau]", "'"}], ")"}], 
                SubscriptBox["A", "i"], 
                RowBox[{"(", 
                 RowBox[{"\[Tau]", "'"}], ")"}], 
                RowBox[{"\[DifferentialD]", 
                 RowBox[{"\[Tau]", "'"}]}]}]}]}]}], ")"}], "\[CenterDot]", 
           RowBox[{
            SubsuperscriptBox["\[Integral]", 
             RowBox[{"t", "'"}], "\[Tau]"], 
            RowBox[{
             RowBox[{
              SubscriptBox["\[PartialD]", "k"], 
              SubscriptBox["A", "j"]}], 
             RowBox[{"(", 
              RowBox[{"\[Tau]", "'"}], ")"}], 
             SubscriptBox["A", "j"], 
             RowBox[{"(", 
              RowBox[{"\[Tau]", "'"}], ")"}], 
             RowBox[{"\[DifferentialD]", 
              RowBox[{"\[Tau]", "'"}]}], 
             RowBox[{"\[DifferentialD]", "\[Tau]"}]}]}]}]}]}], "}"}], ";"}], 
      "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Return", "[", 
        RowBox[{"constCorrectionInt", "[", 
         RowBox[{"t", ",", "tt"}], "]"}], "]"}], ";"}], "*)"}], 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Displaced", " ", "momentum"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pi", "[", 
       RowBox[{"p_", ",", "t_", ",", "tt_"}], "]"}], ":=", 
      RowBox[{"p", "+", 
       RowBox[{"A", "[", "t", "]"}], "-", 
       RowBox[{
        RowBox[{"GAInt", "[", 
         RowBox[{"t", ",", "tt"}], "]"}], ".", "p"}], "-", 
       RowBox[{"GAdotAInt", "[", 
        RowBox[{"t", ",", "tt"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Stationary", " ", "momentum", " ", "and", " ", "action"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ps", "[", 
       RowBox[{"t_", ",", "tt_"}], "]"}], ":=", 
      RowBox[{
       RowBox[{"ps", "[", 
        RowBox[{"t", ",", "tt"}], "]"}], "=", 
       RowBox[{
        RowBox[{"-", 
         FractionBox["1", 
          RowBox[{"t", "-", "tt", "-", 
           RowBox[{"\[ImaginaryI]", " ", "\[Epsilon]"}]}]]}], 
        RowBox[{
         RowBox[{"Inverse", "[", 
          RowBox[{
           RowBox[{"IdentityMatrix", "[", 
            RowBox[{"Length", "[", 
             RowBox[{"A", "[", "tInit", "]"}], "]"}], "]"}], "-", 
           RowBox[{
            FractionBox["1", 
             RowBox[{"t", "-", "tt", "-", 
              RowBox[{"\[ImaginaryI]", " ", "\[Epsilon]"}]}]], 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"GAIntInt", "[", 
               RowBox[{"t", ",", "tt"}], "]"}], "+", 
              RowBox[{
               RowBox[{"GAIntInt", "[", 
                RowBox[{"t", ",", "tt"}], "]"}], "\[Transpose]"}]}], 
             ")"}]}]}], "]"}], ".", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"AInt", "[", 
            RowBox[{"t", ",", "tt"}], "]"}], "-", 
           RowBox[{"bigPScorrectionInt", "[", 
            RowBox[{"t", ",", "tt"}], "]"}]}], ")"}]}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"S", "[", 
       RowBox[{"t_", ",", "tt_"}], "]"}], ":=", 
      RowBox[{"simplifier", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         FractionBox["1", "2"], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Total", "[", 
            SuperscriptBox[
             RowBox[{"ps", "[", 
              RowBox[{"t", ",", "tt"}], "]"}], "2"], "]"}], "+", 
           SuperscriptBox["\[Kappa]", "2"]}], ")"}], 
         RowBox[{"(", 
          RowBox[{"t", "-", "tt"}], ")"}]}], "+", 
        RowBox[{
         RowBox[{"ps", "[", 
          RowBox[{"t", ",", "tt"}], "]"}], ".", 
         RowBox[{"AInt", "[", 
          RowBox[{"t", ",", "tt"}], "]"}]}], "+", 
        RowBox[{
         FractionBox["1", "2"], 
         RowBox[{"A2Int", "[", 
          RowBox[{"t", ",", "tt"}], "]"}]}], "-", 
        RowBox[{"(", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ps", "[", 
            RowBox[{"t", ",", "tt"}], "]"}], ".", 
           RowBox[{"GAIntInt", "[", 
            RowBox[{"t", ",", "tt"}], "]"}], ".", 
           RowBox[{"ps", "[", 
            RowBox[{"t", ",", "tt"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"ps", "[", 
            RowBox[{"t", ",", "tt"}], "]"}], ".", 
           RowBox[{"bigPScorrectionInt", "[", 
            RowBox[{"t", ",", "tt"}], "]"}]}], "+", 
          RowBox[{"AdotGAdotAInt", "[", 
           RowBox[{"t", ",", "tt"}], "]"}]}], "\[IndentingNewLine]", ")"}]}], 
       "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"prefactor", "[", 
       RowBox[{"t_", ",", "\[Tau]_"}], "]"}], ":=", 
      RowBox[{"\[ImaginaryI]", 
       SuperscriptBox[
        RowBox[{"(", 
         FractionBox[
          RowBox[{"2", "\[Pi]"}], 
          RowBox[{"\[Epsilon]", "+", 
           RowBox[{"\[ImaginaryI]", " ", "\[Tau]"}]}]], ")"}], 
        RowBox[{"3", "/", "2"}]], 
       RowBox[{"dipoleRec", "[", 
        RowBox[{
         RowBox[{"pi", "[", 
          RowBox[{
           RowBox[{"ps", "[", 
            RowBox[{"t", ",", 
             RowBox[{"t", "-", "\[Tau]"}]}], "]"}], ",", "t", ",", 
           RowBox[{"t", "-", "\[Tau]"}]}], "]"}], ",", "\[Kappa]"}], "]"}], 
       "\[Times]", 
       RowBox[{
        RowBox[{"dipoleIon", "[", 
         RowBox[{
          RowBox[{"pi", "[", 
           RowBox[{
            RowBox[{"ps", "[", 
             RowBox[{"t", ",", 
              RowBox[{"t", "-", "\[Tau]"}]}], "]"}], ",", 
            RowBox[{"t", "-", "\[Tau]"}], ",", 
            RowBox[{"t", "-", "\[Tau]"}]}], "]"}], ",", "\[Kappa]"}], "]"}], 
        ".", 
        RowBox[{"F", "[", 
         RowBox[{"t", "-", "\[Tau]"}], "]"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"integrand", "[", 
       RowBox[{"t_", ",", "\[Tau]_"}], "]"}], ":=", 
      RowBox[{
       RowBox[{"prefactor", "[", 
        RowBox[{"t", ",", "\[Tau]"}], "]"}], 
       RowBox[{"Exp", "[", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], " ", 
         RowBox[{"S", "[", 
          RowBox[{"t", ",", 
           RowBox[{"t", "-", "\[Tau]"}]}], "]"}]}], "]"}], 
       RowBox[{"gate", "[", 
        RowBox[{"\[Omega]", " ", "\[Tau]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Debugging", " ", 
        RowBox[{"constructs", ".", " ", "Verbose"}]}], "\[Rule]", 
       RowBox[{
        RowBox[{
        "1", " ", "prints", " ", "information", " ", "about", " ", "the", " ",
          "internal", " ", 
         RowBox[{"functions", ".", " ", "Verbose"}]}], "\[Rule]", 
        RowBox[{
         RowBox[{
         "2", " ", "returns", " ", "all", " ", "the", " ", "relevant", " ", 
          "internal", " ", "functions", " ", "and", " ", 
          RowBox[{"stops", ".", " ", "Verbose"}]}], "\[Rule]", 
         RowBox[{
          RowBox[{"3", " ", "for", " ", "quantum"}], "-", 
          RowBox[{"orbit", " ", 
           RowBox[{"constructs", "."}]}]}]}]}]}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Which", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"OptionValue", "[", "Verbose", "]"}], "\[Equal]", "1"}], ",", 
       
       RowBox[{"Information", "/@", 
        RowBox[{"{", 
         RowBox[{
         "A", ",", "GA", ",", "ps", ",", "pi", ",", "S", ",", "AInt", ",", 
          "A2Int", ",", "GAInt", ",", "GAdotAInt", ",", "AdotGAInt", ",", 
          "GAIntInt", ",", "bigPScorrectionInt", ",", "AdotGAdotAInt"}], 
         "}"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"OptionValue", "[", "Verbose", "]"}], "\[Equal]", "2"}], ",", 
       
       RowBox[{"Return", "[", 
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"t", "=", "Global`t"}], ",", 
            RowBox[{"tt", "=", "Global`tt"}], ",", 
            RowBox[{"p", "=", "Global`t"}], ",", 
            RowBox[{"\[Tau]", "=", "Global`\[Tau]"}]}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"A", "[", "t", "]"}], ",", 
            RowBox[{"GA", "[", "t", "]"}], ",", 
            RowBox[{"ps", "[", 
             RowBox[{"t", ",", "tt"}], "]"}], ",", 
            RowBox[{"pi", "[", 
             RowBox[{"p", ",", "t", ",", "tt"}], "]"}], ",", 
            RowBox[{"S", "[", 
             RowBox[{"t", ",", "tt"}], "]"}], ",", 
            RowBox[{"AInt", "[", "t", "]"}], ",", 
            RowBox[{"AInt", "[", 
             RowBox[{"t", ",", "tt"}], "]"}], ",", 
            RowBox[{"A2Int", "[", "t", "]"}], ",", 
            RowBox[{"A2Int", "[", 
             RowBox[{"t", ",", "tt"}], "]"}], ",", 
            RowBox[{"GAInt", "[", "t", "]"}], ",", 
            RowBox[{"GAInt", "[", 
             RowBox[{"t", ",", "tt"}], "]"}], ",", 
            RowBox[{"GAdotAInt", "[", "t", "]"}], ",", 
            RowBox[{"GAdotAInt", "[", 
             RowBox[{"t", ",", "tt"}], "]"}], ",", 
            RowBox[{"AdotGAInt", "[", "t", "]"}], ",", 
            RowBox[{"AdotGAInt", "[", 
             RowBox[{"t", ",", "tt"}], "]"}], ",", 
            RowBox[{"GAIntInt", "[", "t", "]"}], ",", 
            RowBox[{"GAIntInt", "[", 
             RowBox[{"t", ",", "tt"}], "]"}], ",", 
            RowBox[{"bigPScorrectionInt", "[", "t", "]"}], ",", 
            RowBox[{"bigPScorrectionInt", "[", 
             RowBox[{"t", ",", "tt"}], "]"}], ",", 
            RowBox[{"AdotGAdotAInt", "[", "t", "]"}], ",", 
            RowBox[{"AdotGAdotAInt", "[", 
             RowBox[{"t", ",", "tt"}], "]"}], ",", 
            RowBox[{"integrand", "[", 
             RowBox[{"t", ",", "\[Tau]"}], "]"}]}], "}"}]}], "]"}], "]"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"OptionValue", "[", "Verbose", "]"}], "\[Equal]", "3"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Function", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Global`t", ",", "Global`tt"}], "}"}], ",", 
            RowBox[{"Evaluate", "[", 
             RowBox[{"prefactor", "[", 
              RowBox[{"Global`t", ",", 
               RowBox[{"Global`t", "-", "Global`tt"}]}], "]"}], "]"}]}], 
           "]"}], ",", 
          RowBox[{"Function", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Global`t", ",", "Global`tt"}], "}"}], ",", 
            RowBox[{"Evaluate", "[", 
             RowBox[{"S", "[", 
              RowBox[{"Global`t", ",", "Global`tt"}], "]"}], "]"}]}], "]"}]}],
          "\[IndentingNewLine]", "}"}], "]"}]}], "\[IndentingNewLine]", "]"}],
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Single", "-", 
       RowBox[{"run", " ", "parallelization"}]}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Which", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"OptionValue", "[", "RunInParallel", "]"}], "===", 
         "Automatic"}], "||", 
        RowBox[{
         RowBox[{"OptionValue", "[", "RunInParallel", "]"}], "===", 
         "False"}]}], ",", " ", 
       RowBox[{
        RowBox[{"TableCommand", "=", "Table"}], ";", 
        RowBox[{"SumCommand", "=", "Sum"}], ";"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"OptionValue", "[", "RunInParallel", "]"}], "===", "True"}], 
       ",", 
       RowBox[{
        RowBox[{"TableCommand", "=", "ParallelTable"}], ";", 
        RowBox[{"SumCommand", "=", "Sum"}], ";"}], ",", "\[IndentingNewLine]",
        "True", ",", 
       RowBox[{
        RowBox[{"TableCommand", "=", 
         RowBox[{
          RowBox[{"OptionValue", "[", "RunInParallel", "]"}], 
          "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ";", 
        RowBox[{"SumCommand", "=", 
         RowBox[{
          RowBox[{"OptionValue", "[", "RunInParallel", "]"}], 
          "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Numerical", " ", "integration", " ", "loop"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"dipoleList", "=", 
      RowBox[{"TableCommand", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"OptionValue", "[", "ReportingFunction", "]"}], "[", 
         "\[IndentingNewLine]", 
         RowBox[{"\[Delta]tint", " ", 
          RowBox[{"SumCommand", "[", 
           RowBox[{
            RowBox[{"(", "\[IndentingNewLine]", 
             RowBox[{"integrand", "[", 
              RowBox[{"t", ",", "\[Tau]"}], "]"}], "\[IndentingNewLine]", 
             ")"}], ",", 
            RowBox[{"{", 
             RowBox[{"\[Tau]", ",", "0", ",", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"OptionValue", "[", "Preintegrals", "]"}], 
                 "\[Equal]", "\"\<Analytic\>\""}], ",", "tGate", ",", 
                RowBox[{"Min", "[", 
                 RowBox[{
                  RowBox[{"t", "-", "tInit"}], ",", "tGate"}], "]"}]}], "]"}],
               ",", "\[Delta]tint"}], "}"}]}], "]"}]}], "\[IndentingNewLine]",
          "]"}], "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"t", ",", "tInit", ",", "tFinal", ",", "\[Delta]t"}], 
         "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     "dipoleList"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Open  ]],

Cell[CellGroupData[{

Cell["Quantum orbit functions suite", "Section"],

Cell[CellGroupData[{

Cell["GetSaddlePoints", "Subsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"GetSaddlePoints", "::", "usage"}], "=", 
   "\"\<GetSaddlePoints[\[CapitalOmega],S,{tmin,tmax},{\[Tau]min,\[Tau]max}] \
finds a list of solutions {t,\[Tau]} of the HHG temporal saddle-point \
equations at harmonic energy \[CapitalOmega] for action S, in the range \
{tmin, tmax} of recombination time and {\[Tau]min, \[Tau]max} of excursion \
time, where both ranges should be the lower-left and upper-right corners of \
rectangles in the complex plane.\n\n\
GetSaddlePoints[\[CapitalOmega]Range,S,{tmin,tmax},{\[Tau]min,\[Tau]max}] \
finds solutions of the HHG temporal saddle-point equations for a range of \
harmonic energies \[CapitalOmega]Range, and returns an Association with each \
harmonic energy \[CapitalOmega] indexing a list of saddle-point solution \
pairs {t,\[Tau]}.\n\n\
GetSaddlePoints[\[CapitalOmega]spec,S,{{{\!\(\*SubscriptBox[\(tmin\), \
\(1\)]\),\!\(\*SubscriptBox[\(tmax\), \
\(1\)]\)},{\!\(\*SubscriptBox[\(\[Tau]min\), \(1\)]\),\!\(\*SubscriptBox[\(\
\[Tau]max\), \(1\)]\)}},{{\!\(\*SubscriptBox[\(tmin\), \
\(2\)]\),\!\(\*SubscriptBox[\(tmax\), \
\(2\)]\)},{\!\(\*SubscriptBox[\(\[Tau]min\), \(2\)]\),\!\(\*SubscriptBox[\(\
\[Tau]max\), \(2\)]\)}},\[Ellipsis]}] uses multiple time domains and combines \
the solutions.\n\nGetSaddlePoints[\[CapitalOmega]spec,S,{{urange,vrange},\
\[Ellipsis]},IndependentVariables\[Rule]{u,v}] uses the explicit independent \
variables u and v to solve the equations and over the given ranges, where u \
and v can be any of \\\"RecombinationTime\\\", \\\"IonizationTime\\\" and \
\\\"ExcursionTime\\\", or their shorthands \\\"t\\\", \\\"tt\\\" and \\\"\
\[Tau]\\\" resp.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SortingFunction", "::", "usage"}], "=", 
   "\"\<SortingFunction is an option of GetSaddlePoints which sets a function \
f, to be used as f[t,\[Tau],S,\[CapitalOmega]], to be used to sort the \
solutions, or a list of such functions.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SelectionFunction", "::", "usage"}], "=", 
   "\"\<SelectionFunction is an option of GetSaddlePoints that sets a \
function f, to be used as f[t,\[Tau],S,\[CapitalOmega]], such that roots are \
only kept if f returns True.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IndependentVariables", "::", "usage"}], "=", 
    "\"\<IndependentVariables is an option for GetSaddlePoints that specifies \
the two independent variables, out of \\\"RecombinationTime\\\", \
\\\"IonizationTime\\\" and \\\"ExcursionTime\\\" (or their shorthands \\\"t\\\
\", \\\"tt\\\" and \\\"\[Tau]\\\", respectively), to be used in solving the \
saddle-point equations, and which range over the given regions.\>\""}], ";"}],
   "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FiniteDifference", "::", "usage"}], "=", 
    "\"\<FiniteDifference is a value for the option Jacobian of FindRoot, \
FindComplexRoots, GetSaddlePoints, and related functions, which specifies \
that the Jacobian at each step should be evaluated using numerical finite \
difference procedures.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetSaddlePoints", "::", "error"}], "=", 
    "\"\<Errors encountered for frequency \[CapitalOmega]=`1`.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "GetSaddlePoints", "]"}], "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"SortingFunction", "\[Rule]", 
        RowBox[{"(", 
         RowBox[{"#2", "&"}], ")"}]}], ",", 
       RowBox[{"SelectionFunction", "\[Rule]", 
        RowBox[{"(", 
         RowBox[{"True", "&"}], ")"}]}], ",", 
       RowBox[{"IndependentVariables", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<RecombinationTime\>\"", ",", "\"\<ExcursionTime\>\""}], 
         "}"}]}]}], "}"}], ",", 
     RowBox[{"Options", "[", "FindComplexRoots", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Protect", "[", 
    RowBox[{
    "SortingFunction", ",", "SelectionFunction", ",", "IndependentVariables", 
     ",", "FiniteDifference"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetSaddlePoints", "[", 
    RowBox[{"\[CapitalOmega]spec_", ",", "S_", ",", 
     RowBox[{"{", 
      RowBox[{"tmin_", ",", "tmax_"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\[Tau]min_", ",", "\[Tau]max_"}], "}"}], ",", 
     RowBox[{"options", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"GetSaddlePoints", "[", 
    RowBox[{"\[CapitalOmega]spec", ",", "S", ",", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"tmin", ",", "tmax"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\[Tau]min", ",", "\[Tau]max"}], "}"}]}], "}"}], "}"}], ",", 
     "options"}], "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GetSaddlePoints", "[", 
   RowBox[{"\[CapitalOmega]_", ",", "S_", ",", "timeRanges_", ",", 
    RowBox[{"options", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"equations", ",", "roots", ",", 
      RowBox[{"t", "=", 
       RowBox[{"Symbol", "[", "\"\<t\>\"", "]"}]}], ",", 
      RowBox[{"tt", "=", 
       RowBox[{"Symbol", "[", "\"\<tt\>\"", "]"}]}], ",", 
      RowBox[{"\[Tau]", "=", 
       RowBox[{"Symbol", "[", "\"\<\[Tau]\>\"", "]"}]}], ",", "indVars", ",", 
      "depVar", ",", "depVarRule", ",", "tolerances"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"indVars", "=", 
      RowBox[{
       RowBox[{"OptionValue", "[", "IndependentVariables", "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\"\<RecombinationTime\>\"", "\[Rule]", "\"\<t\>\""}], ",", 
         RowBox[{"\"\<ExcursionTime\>\"", "\[Rule]", "\"\<\[Tau]\>\""}], ",", 
         
         RowBox[{"\"\<IonizationTime\>\"", "\[Rule]", "\"\<tt\>\""}]}], 
        "}"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"depVar", "=", 
      RowBox[{"First", "[", 
       RowBox[{"DeleteCases", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\"\<t\>\"", ",", "\"\<\[Tau]\>\"", ",", "\"\<tt\>\""}], 
          "}"}], ",", 
         RowBox[{"Alternatives", "@@", "indVars"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"depVarRule", "=", 
      RowBox[{"depVar", "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\"\<tt\>\"", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"tt", "\[Rule]", 
            RowBox[{"t", "-", "\[Tau]"}]}], "}"}]}], ",", 
         RowBox[{"\"\<t\>\"", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"t", "\[Rule]", 
            RowBox[{"tt", "+", "\[Tau]"}]}], "}"}]}], ",", 
         RowBox[{"\"\<\[Tau]\>\"", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"\[Tau]", "\[Rule]", 
            RowBox[{"t", "-", "tt"}]}], "}"}]}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"equations", "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{
            RowBox[{"S", "[", 
             RowBox[{"t", ",", "tt"}], "]"}], ",", "t"}], "]"}], "\[Equal]", 
          "\[CapitalOmega]"}], ",", 
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{
            RowBox[{"S", "[", 
             RowBox[{"t", ",", "tt"}], "]"}], ",", "tt"}], "]"}], "\[Equal]", 
          "0"}]}], "}"}], "/.", "depVarRule"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"tolerances", "=", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ListQ", "[", 
         RowBox[{"OptionValue", "[", "Tolerance", "]"}], "]"}], ",", 
        RowBox[{"OptionValue", "[", "Tolerance", "]"}], ",", 
        "\[IndentingNewLine]", "True", ",", 
        RowBox[{"ConstantArray", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Which", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"NumberQ", "[", 
             RowBox[{"OptionValue", "[", "Tolerance", "]"}], "]"}], ",", 
            RowBox[{"OptionValue", "[", "Tolerance", "]"}], ",", 
            "\[IndentingNewLine]", "True", ",", 
            RowBox[{"10", "^", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"NumberQ", "[", 
                RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}], "]"}], 
               ",", " ", 
               RowBox[{"2", "-", 
                RowBox[{"OptionValue", "[", "WorkingPrecision", "]"}]}], ",", 
               
               RowBox[{"2", "-", "$MachinePrecision"}]}], "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", "2"}], 
         "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     
     RowBox[{"SortBy", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"DeleteDuplicates", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Select", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Check", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"roots", "=", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"t", ",", "\[Tau]"}], "}"}], "/.", "depVarRule"}],
                     ")"}], "/.", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"FindComplexRoots", "[", "\[IndentingNewLine]", 
                    RowBox[{"equations", "\[IndentingNewLine]", ",", 
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"Sequence", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Symbol", "[", 
                    RowBox[{
                    "indVars", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "]"}], ",", 
                    RowBox[{"range", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    RowBox[{"range", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}]}], 
                    "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Symbol", "[", 
                    RowBox[{
                    "indVars", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "]"}], ",", 
                    RowBox[{"range", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    RowBox[{"range", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "2"}], "\[RightDoubleBracket]"}]}], 
                    "}"}]}], "]"}], "]"}], "\[IndentingNewLine]", ",", 
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"FilterRules", "[", 
                    RowBox[{
                    RowBox[{"{", "options", "}"}], ",", 
                    RowBox[{"Options", "[", "FindComplexRoots", "]"}]}], 
                    "]"}]}], "]"}], "\[IndentingNewLine]", ",", 
                    RowBox[{
                    "SeedGenerator", "\[Rule]", "RandomSobolComplexes"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"Seeds", "\[Rule]", "50"}]}], 
                    "\[IndentingNewLine]", "]"}], "/.", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", "}"}], "\[Rule]", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"t", ",", "\[Tau]"}], "}"}], "/.", "depVarRule"}],
                     ")"}], "\[Rule]", 
                    RowBox[{"{", "}"}]}], ")"}]}], "}"}]}], ")"}]}]}], 
                 RowBox[{"(*", 
                  RowBox[{
                  "to", " ", "deal", " ", "with", " ", "empty", " ", 
                   "results"}], "*)"}], "\[IndentingNewLine]", ",", 
                 RowBox[{
                  RowBox[{"Message", "[", 
                   RowBox[{
                    RowBox[{"GetSaddlePoints", "::", "error"}], ",", 
                    "\[CapitalOmega]"}], "]"}], ";", "roots"}]}], 
                "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
               RowBox[{"Function", "[", 
                RowBox[{"timesPair", ",", 
                 RowBox[{
                  RowBox[{"OptionValue", "[", "SelectionFunction", "]"}], "[", 
                  RowBox[{
                   RowBox[{
                   "timesPair", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], ",", 
                   RowBox[{
                   "timesPair", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], ",", "S", ",", 
                   "\[CapitalOmega]"}], "]"}]}], "]"}]}], 
              "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"range", ",", "timeRanges"}], "}"}]}], "]"}], ",", 
           "1"}], "]"}], "\[IndentingNewLine]", ",", 
         RowBox[{"Function", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"timesPair1", ",", "timesPair2"}], "}"}], ",", "    ", 
           RowBox[{"And", "@@", 
            RowBox[{"Thread", "[", 
             RowBox[{
              RowBox[{"Abs", "[", 
               RowBox[{"timesPair1", "-", "timesPair2"}], "]"}], "<", 
              "tolerances"}], "]"}]}]}], "     ", "]"}]}], 
        "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
       RowBox[{"If", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ListQ", "[", 
          RowBox[{"OptionValue", "[", "SortingFunction", "]"}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"timesPair", ",", 
             RowBox[{"f", "[", 
              RowBox[{
               RowBox[{
               "timesPair", "\[LeftDoubleBracket]", "1", 
                "\[RightDoubleBracket]"}], ",", 
               RowBox[{
               "timesPair", "\[LeftDoubleBracket]", "2", 
                "\[RightDoubleBracket]"}], ",", "S", ",", "\[CapitalOmega]"}],
               "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"f", ",", 
             RowBox[{"OptionValue", "[", "SortingFunction", "]"}]}], "}"}]}], 
          "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Function", "[", 
          RowBox[{"timesPair", ",", 
           RowBox[{
            RowBox[{"OptionValue", "[", "SortingFunction", "]"}], "[", 
            RowBox[{
             RowBox[{
             "timesPair", "\[LeftDoubleBracket]", "1", 
              "\[RightDoubleBracket]"}], ",", 
             RowBox[{
             "timesPair", "\[LeftDoubleBracket]", "2", 
              "\[RightDoubleBracket]"}], ",", "S", ",", "\[CapitalOmega]"}], 
            "]"}]}], "]"}]}], "\[IndentingNewLine]", "]"}]}], 
      "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetSaddlePoints", "[", 
    RowBox[{"\[CapitalOmega]Range_List", ",", "S_", ",", "timeRanges_", ",", 
     RowBox[{"options", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"Association", "[", 
    RowBox[{"ParallelTable", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[CapitalOmega]", "\[Rule]", 
       RowBox[{"GetSaddlePoints", "[", 
        RowBox[{
        "\[CapitalOmega]", ",", "S", ",", "timeRanges", ",", "options"}], 
        "]"}]}], "\[IndentingNewLine]", ",", 
      RowBox[{"{", 
       RowBox[{"\[CapitalOmega]", ",", 
        RowBox[{"Sort", "[", "\[CapitalOmega]Range", "]"}]}], "}"}]}], "]"}], 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["ClassifyQuantumOrbits", "Subsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ClassifyQuantumOrbits", "::", "usage"}], "=", 
   "\"\<ClassifyQuantumOrbits[saddlePoints,f] sorts an indexed set of saddle \
points of the form \[LeftAssociation]\!\(\*SubscriptBox[\(\[CapitalOmega]\), \
\(1\)]\)\[RightArrow]{{\!\(\*SubscriptBox[\(t\), \
\(11\)]\),\!\(\*SubscriptBox[\(\[Tau]\), \
\(11\)]\)},{\!\(\*SubscriptBox[\(t\), \
\(12\)]\),\!\(\*SubscriptBox[\(\[Tau]\), \(12\)]\)},\[Ellipsis]}\[Ellipsis]\
\[RightAssociation] using a function f, which should turn f[t,\[Tau],\
\[CapitalOmega]] into an appropriate label, and returns an association of the \
form \[LeftAssociation]\!\(\*SubscriptBox[\(label\), \(1\)]\)\[RightArrow]\
\[LeftAssociation]\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(1\)]\)\
\[RightArrow]\[LeftAssociation]1\[RightArrow]{t,\[Tau]},2\[RightArrow]{t,\
\[Tau]},\[Ellipsis]\[RightAssociation],\[Ellipsis]\[RightAssociation],\
\[Ellipsis]\[RightAssociation].\n\n\
ClassifyQuantumOrbits[saddlePoints,f,sortFunction] uses the function \
sortFunction to sort the sets of saddle points {{\!\(\*SubscriptBox[\(t\), \
\(11\)]\),\!\(\*SubscriptBox[\(\[Tau]\), \
\(11\)]\)},{\!\(\*SubscriptBox[\(t\), \
\(12\)]\),\!\(\*SubscriptBox[\(\[Tau]\), \(12\)]\)},\[Ellipsis]} for each \
label and harmonic energy.\n\n\
ClassifyQuantumOrbits[saddlePoints,f,sortFunction,DiscardedLabels\[RightArrow]\
{\!\(\*SubscriptBox[\(label\), \(1\)]\),\!\(\*SubscriptBox[\(label\), \
\(2\)]\),\[Ellipsis]}] specifies a list of labels to discard from the final \
output.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DiscardedLabels", "::", "usage"}], "=", 
    "\"\<DiscardedLabels is an option for ClassifyQuantumOrbits which \
specifies a list of labels to discard from the final output.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "ClassifyQuantumOrbits", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"DiscardedLabels", "\[Rule]", 
     RowBox[{"{", "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Protect", "[", "DiscardedLabels", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ClassifyQuantumOrbits", "[", 
    RowBox[{"saddlePointList_", ",", "classifierFunction_", ",", 
     RowBox[{"sortingFunction_:", "Sort"}], ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"Map", "[", "\[IndentingNewLine]", 
    RowBox[{"Association", ",", "\[IndentingNewLine]", 
     RowBox[{"MapIndexed", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"#2", "\[LeftDoubleBracket]", 
           RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], "\[Rule]", "#1"}], 
         "&"}], ")"}], ",", 
       RowBox[{"(*", 
        RowBox[{
        "index", " ", "after", " ", "sorting", " ", "each", " ", "pair"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Map", "[", "\[IndentingNewLine]", 
        RowBox[{"sortingFunction", ",", "\[IndentingNewLine]", 
         RowBox[{"Delete", "[", 
          RowBox[{
           RowBox[{"DeleteMissing", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"Query", "[", "Transpose", "]"}], "[", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"MapIndexed", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"GroupBy", "[", 
                    RowBox[{
                    RowBox[{"classifierFunction", "@@", "#"}], "&"}], "]"}], 
                   "[", 
                   RowBox[{"Flatten", "/@", 
                    RowBox[{"Transpose", "[", 
                    RowBox[{"{", 
                    RowBox[{"#1", ",", 
                    RowBox[{"ConstantArray", "[", 
                    RowBox[{
                    RowBox[{"#2", "\[LeftDoubleBracket]", 
                    RowBox[{
                    RowBox[{"{", "1", "}"}], ",", "1"}], 
                    "\[RightDoubleBracket]"}], ",", 
                    RowBox[{"Length", "[", "#1", "]"}]}], "]"}]}], "}"}], 
                    "]"}]}], "]"}], "&"}], "\[IndentingNewLine]", ",", 
                 "saddlePointList"}], "]"}], "\[LeftDoubleBracket]", 
               RowBox[{"All", ",", "All", ",", "All", ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}]}], "\[RightDoubleBracket]"}], 
              "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", "2"}],
             "]"}], ",", 
           RowBox[{"List", "/@", 
            RowBox[{"OptionValue", "[", "DiscardedLabels", "]"}]}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", "2", "}"}]}], "]"}], ",", 
       RowBox[{"{", "3", "}"}]}], "]"}], ",", 
     RowBox[{"{", "2", "}"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["ReperiodSaddles", "Subsection"],

Cell[BoxData[{
 RowBox[{"ClearAll", "[", "ReperiodSaddles", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ReperiodSaddles", "::", "usage"}], "=", 
    "\"\<ReperiodSaddles[{{\!\(\*SubscriptBox[\(t\), \
\(1\)]\),\!\(\*SubscriptBox[\(\[Tau]\), \(1\)]\)},{\!\(\*SubscriptBox[\(t\), \
\(2\)]\),\!\(\*SubscriptBox[\(\[Tau]\), \(2\)]\)},\[Ellipsis]},f] readjusts \
the assigned cycle of the saddle points {\!\(\*SubscriptBox[\(t\), \
\(i\)]\),\!\(\*SubscriptBox[\(\[Tau]\), \(i\)]\)}, returning the list \
{{\!\(\*SubscriptBox[\(t\), \(1\)]\)+f[\!\(\*SubscriptBox[\(t\), \
\(1\)]\),\!\(\*SubscriptBox[\(\[Tau]\), \(1\)]\)],\!\(\*SubscriptBox[\(\[Tau]\
\), \(1\)]\)},\[Ellipsis]}.\n\n\
ReperiodSaddles[\[LeftAssociation]\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(1\
\)]\)\[RightArrow]{{\!\(\*SubscriptBox[\(t\), \(11\)]\),\!\(\*SubscriptBox[\(\
\[Tau]\), \(11\)]\)},\[Ellipsis]},\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(2\
\)]\)\[Rule]\[Ellipsis]\[RightAssociation],f] reperiods saddle-point pairs in \
a harmonic-energy-indexed association.\n\n\
ReperiodSaddles[\[LeftAssociation]\!\(\*SubscriptBox[\(label\), \(l\)]\)\
\[Rule]\[LeftAssociation]\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(1\)]\)\
\[RightArrow]{{\!\(\*SubscriptBox[\(t\), \
\(11\)]\),\!\(\*SubscriptBox[\(\[Tau]\), \(11\)]\)},\[Ellipsis]},\[Ellipsis]\
\[RightAssociation],\[Ellipsis]\[RightAssociation],f] reperiods saddle-point \
pairs of a classified set of saddle points.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ReperiodSaddles", "[", 
   RowBox[{
    RowBox[{"pair_", "/;", 
     RowBox[{
      RowBox[{"Depth", "[", "pair", "]"}], "\[Equal]", "2"}]}], ",", "f_"}], 
   "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{
     RowBox[{"pair", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
     "+", 
     RowBox[{"f", "[", 
      RowBox[{
       RowBox[{"pair", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
        ",", 
       RowBox[{
       "pair", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
      "]"}]}], ",", 
    RowBox[{"pair", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
   "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReperiodSaddles", "[", 
    RowBox[{"association_", ",", "f_"}], "]"}], ":=", 
   RowBox[{"Apply", "[", 
    RowBox[{"f", ",", "association", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Depth", "[", "association", "]"}], "-", "2"}], "}"}]}], 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["HessianRoot", "Subsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"HessianRoot", "::", "usage"}], "=", 
   "\"\<HessianRoot[S,t,\[Tau]] calculates the Hessian root \
\!\(\*SqrtBox[FractionBox[SuperscriptBox[\((2  \[Pi])\), \(2\)], \
\(\*SuperscriptBox[\(\[ImaginaryI]\), \(2\)] Det[\*SubsuperscriptBox[\(\
\[PartialD]\), \({t, tt}\), \(2\)]S]\)]]\).\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"HessianRoot", "[", 
   RowBox[{"S_", ",", "t_", ",", "\[Tau]_"}], "]"}], ":=", 
  RowBox[{
   SqrtBox[
    FractionBox[
     RowBox[{"2", "\[Pi]"}], 
     RowBox[{"\[ImaginaryI]", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Derivative", "[", 
         RowBox[{"0", ",", "2"}], "]"}], "[", "S", "]"}], "[", 
       RowBox[{"t", ",", 
        RowBox[{"t", "-", "\[Tau]"}]}], "]"}]}]]], 
   SqrtBox[
    FractionBox[
     RowBox[{"2", "\[Pi]", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Derivative", "[", 
         RowBox[{"0", ",", "2"}], "]"}], "[", "S", "]"}], "[", 
       RowBox[{"t", ",", 
        RowBox[{"t", "-", "\[Tau]"}]}], "]"}]}], 
     RowBox[{"\[ImaginaryI]", 
      RowBox[{"(", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Derivative", "[", 
            RowBox[{"2", ",", "0"}], "]"}], "[", "S", "]"}], "[", 
          RowBox[{"t", ",", 
           RowBox[{"t", "-", "\[Tau]"}]}], "]"}], 
         RowBox[{
          RowBox[{
           RowBox[{"Derivative", "[", 
            RowBox[{"0", ",", "2"}], "]"}], "[", "S", "]"}], "[", 
          RowBox[{"t", ",", 
           RowBox[{"t", "-", "\[Tau]"}]}], "]"}]}], "-", 
        SuperscriptBox[
         RowBox[{
          RowBox[{
           RowBox[{"Derivative", "[", 
            RowBox[{"1", ",", "1"}], "]"}], "[", "S", "]"}], "[", 
          RowBox[{"t", ",", 
           RowBox[{"t", "-", "\[Tau]"}]}], "]"}], "2"]}], 
       ")"}]}]]]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["FindStokesTransitions", "Subsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FindStokesTransitions", "::", "usage"}], "=", 
   "\"\<FindStokesTransitions[S,\[LeftAssociation]\!\(\*SubscriptBox[\(\
\[CapitalOmega]\), \(1\)]\)\[RightArrow]\[LeftAssociation]1\[RightArrow]{\!\(\
\*SubscriptBox[\(t\), \(11\)]\),\!\(\*SubscriptBox[\(\[Tau]\), \(11\)]\)},2\
\[RightArrow]{\!\(\*SubscriptBox[\(t\), \(12\)]\),\!\(\*SubscriptBox[\(\[Tau]\
\), \(12\)]\)}\[RightAssociation],\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(2\
\)]\)\[RightArrow]\[LeftAssociation]1\[RightArrow]{\!\(\*SubscriptBox[\(t\), \
\(21\)]\),\!\(\*SubscriptBox[\(\[Tau]\), \
\(21\)]\)},2\[RightArrow]{\!\(\*SubscriptBox[\(t\), \
\(22\)]\),\!\(\*SubscriptBox[\(\[Tau]\), \(22\)]\)}\[RightAssociation],\
\[Ellipsis]\[RightAssociation]] finds the set {{\!\(\*SubscriptBox[\(\
\[CapitalOmega]\), \(S\)]\)},{\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(AS\)]\
\)},n} of the Stokes and anti-Stokes transition energies for the given set of \
saddle points, where Re(S) changes sign after the \!\(\*SubscriptBox[\(\
\[CapitalOmega]\), \(S\)]\) and Im(S) changes sign after the \
\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(AS\)]\), and n is the index of the \
member of the pair that should be chosen after the transition (taken as the \
member with a positive imaginary part of the action at the largest \
\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(i\)]\) in the given keys).\n\n\
FindStokesTransitions[S,\[LeftAssociation]\!\(\*SubscriptBox[\(label\), \
\(1\)]\)\[RightArrow]\[LeftAssociation]\!\(\*SubscriptBox[\(\[CapitalOmega]\),\
 \(1\)]\)\[RightArrow]\[Ellipsis]\[RightAssociation]\[RightAssociation]] \
finds the Stokes transitions for the given set of saddle-point curve pairs, \
and returns them labeled with the \!\(\*SubscriptBox[\(label\), \
\(i\)]\).\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FindStokesTransitions", "::", "saddleno"}], "=", 
   "\"\<FindStokesTransitions called with `1` of `2` saddle-point sets of \
length different from 2, with set length structure `3`. Excluding those sets \
from the calculation.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FindStokesTransitions", "::", "multipleS"}], "=", 
   "\"\<FindStokesTransitions found multiple Stokes transitions; using `1` to \
return a single transition.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FindStokesTransitions", "::", "multipleAS"}], "=", 
   "\"\<FindStokesTransitions found multiple anti-Stokes transitions; using \
`1` to return a single transition.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ChooserFunction", "::", "usage"}], "=", 
   "\"\<ChooserFunction is an option for FindStokesTransitions that specifies \
which transition to take if there are multiple transitions in the given \
dataset. The default is Last and gives the one with higher energy; to get the \
full set of transitions found use Full or Identity.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ReperiodingFunction", "::", "usage"}], "=", 
    "\"\<ReperiodingFunction is an option for FindStokesTransitions, \
SPAdipole and UAdipole which specifies a function f[t,\[Tau]] of \
recombination time t and excursion time \[Tau] that will be used to re-period \
the pairs {t,\[Tau]} into the form {t+f[t,\[Tau]],\[Tau]}. The default is \
Function[0], but if pairs are split it can be useful to set \
ReperiodingFunction to \
Function[{t,\[Tau]},Floor[-Re[t-\[Tau]],\!\(\*FractionBox[\(2  \[Pi]\), \(\
\[Omega]\)]\)]] for \[Omega] the carrier frequency. In general, however, it \
is preferable to do this in a single go using ReperiodSaddles.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", 
   RowBox[{"ReperiodingFunction", ",", "ChooserFunction"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "FindStokesTransitions", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ReperiodingFunction", "\[Rule]", 
       RowBox[{"Function", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"t", ",", "\[Tau]"}], "}"}], ",", "0"}], "]"}]}], ",", 
      RowBox[{"ChooserFunction", "\[Rule]", "Automatic"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FindStokesTransitions", "[", 
    RowBox[{"S_", ",", 
     RowBox[{"deeperAssociation_", "/;", 
      RowBox[{
       RowBox[{"Depth", "[", "deeperAssociation", "]"}], "\[Equal]", "5"}]}], 
     ",", 
     RowBox[{"options", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"Map", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"FindStokesTransitions", "[", 
       RowBox[{"S", ",", "#", ",", "options"}], "]"}], "&"}], ",", 
     "\[IndentingNewLine]", "deeperAssociation"}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FindStokesTransitions", "[", 
    RowBox[{"S_", ",", "saddlesAssociation_", ",", 
     RowBox[{"options", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "reducedSaddlesAssociation", ",", "actionList", ",", "signsList", ",", 
       "s", ",", "processor"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"reducedSaddlesAssociation", "=", 
       RowBox[{"KeySort", "[", 
        RowBox[{"Select", "[", 
         RowBox[{"saddlesAssociation", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "#", "]"}], "\[Equal]", "2"}], "&"}]}], 
         "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "saddlesAssociation", "]"}], "-", 
          RowBox[{"Length", "[", "reducedSaddlesAssociation", "]"}]}], ">", 
         "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"FindStokesTransitions", "::", "saddleno"}], ",", 
          RowBox[{
           RowBox[{"Length", "[", "saddlesAssociation", "]"}], "-", 
           RowBox[{"Length", "[", "reducedSaddlesAssociation", "]"}]}], ",", 
          RowBox[{"Length", "[", "saddlesAssociation", "]"}], ",", 
          RowBox[{"First", "/@", 
           RowBox[{"Tally", "/@", 
            RowBox[{"Split", "[", 
             RowBox[{"Values", "[", 
              RowBox[{"Length", "/@", "saddlesAssociation"}], "]"}], 
             "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"actionList", "=", 
       RowBox[{"ReIm", "[", "\[IndentingNewLine]", 
        RowBox[{"Map", "[", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"reduces", " ", "each", " ", "\[CapitalOmega]"}], 
           "\[Rule]", 
           RowBox[{
            RowBox[{
             RowBox[{"\[LeftAssociation]", 
              RowBox[{
               RowBox[{"1", "\[Rule]", 
                SubscriptBox["S", "1"]}], ",", 
               RowBox[{"2", "\[Rule]", 
                SubscriptBox["S", "2"]}]}], "\[RightAssociation]"}], " ", 
             "to", " ", "\[CapitalOmega]"}], "\[RightArrow]", 
            RowBox[{"(", 
             RowBox[{
              SubscriptBox["S", "1"], "-", 
              SubscriptBox["S", "2"]}], ")"}]}]}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Apply", "[", "Subtract", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"MapIndexed", "[", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"reduces", " ", "each", " ", "\[CapitalOmega]"}], 
             "\[Rule]", 
             RowBox[{
              RowBox[{
               RowBox[{"\[LeftAssociation]", 
                RowBox[{
                 RowBox[{"1", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{
                    SubscriptBox["t", "1"], ",", 
                    SubscriptBox["\[Tau]", "1"]}], "}"}]}], ",", 
                 RowBox[{"2", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{
                    SubscriptBox["t", "2"], ",", 
                    SubscriptBox["\[Tau]", "2"]}], "}"}]}]}], 
                "\[RightAssociation]"}], " ", "to", " ", "\[CapitalOmega]"}], 
              "\[Rule]", 
              RowBox[{"\[LeftAssociation]", 
               RowBox[{
                RowBox[{"1", "\[Rule]", 
                 SubscriptBox["S", "1"]}], ",", 
                RowBox[{"2", "\[Rule]", 
                 SubscriptBox["S", "2"]}]}], "\[RightAssociation]"}]}]}], 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"With", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"t", "=", 
                  RowBox[{
                   RowBox[{
                   "#1", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "+", 
                   RowBox[{
                    RowBox[{"OptionValue", "[", "ReperiodingFunction", "]"}], 
                    "[", 
                    RowBox[{
                    RowBox[{
                    "#1", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], ",", 
                    RowBox[{
                    "#2", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}]}], "]"}]}]}], ",", 
                 RowBox[{"\[Tau]", "=", 
                  RowBox[{
                  "#1", "\[LeftDoubleBracket]", "2", 
                   "\[RightDoubleBracket]"}]}], ",", 
                 RowBox[{"\[CapitalOmega]", "=", 
                  RowBox[{"#2", "\[LeftDoubleBracket]", 
                   RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}]}], 
                "}"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"S", "[", 
                 RowBox[{"t", ",", 
                  RowBox[{"t", "-", "\[Tau]"}]}], "]"}], "-", 
                RowBox[{"\[CapitalOmega]", " ", "t"}]}]}], 
              "\[IndentingNewLine]", "]"}], "&"}], "\[IndentingNewLine]", ",",
             "reducedSaddlesAssociation", ",", 
            RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], "]"}], 
        "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"signsList", "=", 
       RowBox[{"Sign", "[", 
        RowBox[{"Times", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Rest", "[", "actionList", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"AssociationThread", "[", 
           RowBox[{
            RowBox[{"Rest", "[", 
             RowBox[{"Keys", "[", "actionList", "]"}], "]"}], ",", 
            RowBox[{"Most", "[", 
             RowBox[{"Values", "[", "actionList", "]"}], "]"}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"processor", "=", 
       RowBox[{
        RowBox[{"OptionValue", "[", "ChooserFunction", "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Automatic", "\[Rule]", "Last"}], ",", 
          RowBox[{"Full", "\[Rule]", "Identity"}]}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"Keys", "[", 
           RowBox[{"Select", "[", 
            RowBox[{"signsList", ",", 
             RowBox[{
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               "<", "0"}], "&"}]}], "]"}], "]"}], "]"}], ">", "1"}], ",", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"FindStokesTransitions", "::", "multipleS"}], ",", 
          "processor"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"Keys", "[", 
           RowBox[{"Select", "[", 
            RowBox[{"signsList", ",", 
             RowBox[{
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "<", "0"}], "&"}]}], "]"}], "]"}], "]"}], ">", "1"}], ",", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"FindStokesTransitions", "::", "multipleAS"}], ",", 
          "processor"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"processor", "[", 
         RowBox[{
          RowBox[{"Keys", "[", 
           RowBox[{"Select", "[", 
            RowBox[{"signsList", ",", 
             RowBox[{
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               "<", "0"}], "&"}]}], "]"}], "]"}], "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", "}"}], "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"Missing", "[", "\"\<No transition\>\"", "]"}], "}"}]}], 
           "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"processor", "[", 
         RowBox[{
          RowBox[{"Keys", "[", 
           RowBox[{"Select", "[", 
            RowBox[{"signsList", ",", 
             RowBox[{
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "<", "0"}], "&"}]}], "]"}], "]"}], "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", "}"}], "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"Missing", "[", "\"\<No transition\>\"", "]"}], "}"}]}], 
           "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Sign", "[", 
          RowBox[{
           RowBox[{"Last", "[", "actionList", "]"}], "\[LeftDoubleBracket]", 
           "2", "\[RightDoubleBracket]"}], "]"}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"1", "\[Rule]", "2"}], ",", 
           RowBox[{
            RowBox[{"-", "1"}], "\[Rule]", "1"}]}], "}"}]}]}], 
       "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["SPAdipole", "Subsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SPAdipole", "::", "usage"}], "=", 
   "\"\<SPAdipole[S,prefactor,\[CapitalOmega],{t,\[Tau]}] returns the \
saddle-point approximation amplitude corresponding to action S[t,t-\[Tau]]-\
\[CapitalOmega]t and the given prefactor.\n\nSPAdipole[S,prefactor,\
\[CapitalOmega],\[LeftAssociation]1\[RightArrow]{\!\(\*SubscriptBox[\(t\), \
\(1\)]\),\!\(\*SubscriptBox[\(\[Tau]\), \
\(1\)]\)},2\[RightArrow]{\!\(\*SubscriptBox[\(t\), \
\(2\)]\),\!\(\*SubscriptBox[\(\[Tau]\), \(2\)]\)},\[Ellipsis]\
\[RightAssociation]] returns the total harmonic-dipole contribution in the \
saddle-point approximation from the specified saddle points.\n\n\
SPAdipole[S,prefactor,\[CapitalOmega],\[LeftAssociation]1\[RightArrow]{\!\(\*\
SubscriptBox[\(t\), \(1\)]\),\!\(\*SubscriptBox[\(\[Tau]\), \(1\)]\)},2\
\[RightArrow]{\!\(\*SubscriptBox[\(t\), \
\(2\)]\),\!\(\*SubscriptBox[\(\[Tau]\), \
\(2\)]\)}\[RightAssociation],transition] uses the given Stokes transition set \
to drop the relevant saddle after the anti-Stokes transition.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SPAdipole", "::", "wrongno"}], "=", 
   "\"\<SPAdipole called with a Stokes transition but with an input \
association of length `1` at harmonic energy \[CapitalOmega]=`2`. Reverting \
to unstructured evaluation.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SPAdipole", "::", "invldtrns"}], "=", 
    "\"\<SPAdipole called with invalid Stokes transition set `1`. Reverting \
to unstructured evaluation.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "SPAdipole", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{"ReperiodingFunction", "\[Rule]", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"t", ",", "\[Tau]"}], "}"}], ",", "0"}], "]"}]}], "}"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SPAdipole", "[", 
   RowBox[{"S_", ",", "prefactor_", ",", "\[CapitalOmega]_", ",", 
    RowBox[{"{", 
     RowBox[{"t_", ",", "\[Tau]_"}], "}"}], ",", 
    RowBox[{"options", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"tr", "=", 
      RowBox[{"t", "+", 
       RowBox[{
        RowBox[{"OptionValue", "[", "ReperiodingFunction", "]"}], "[", 
        RowBox[{"t", ",", "\[Tau]"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"HessianRoot", "[", 
      RowBox[{"S", ",", "tr", ",", "\[Tau]"}], "]"}], 
     RowBox[{"prefactor", "[", 
      RowBox[{"tr", ",", 
       RowBox[{"tr", "-", "\[Tau]"}]}], "]"}], 
     RowBox[{"Exp", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "\[ImaginaryI]"}], " ", 
        RowBox[{"S", "[", 
         RowBox[{"tr", ",", 
          RowBox[{"tr", "-", "\[Tau]"}]}], "]"}]}], "+", 
       RowBox[{"\[ImaginaryI]", " ", "\[CapitalOmega]", " ", "tr"}]}], 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SPAdipole", "[", 
    RowBox[{
    "S_", ",", "prefactor_", ",", "\[CapitalOmega]_", ",", 
     "times_Association", ",", 
     RowBox[{"options", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Total", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"SPAdipole", "[", 
         RowBox[{
         "S", ",", "prefactor", ",", "\[CapitalOmega]", ",", "#", ",", 
          "options"}], "]"}], "&"}], "/@", "times"}], "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SPAdipole", "[", 
    RowBox[{
    "S_", ",", "prefactor_", ",", "\[CapitalOmega]_", ",", 
     "times_Association", ",", "transition_", ",", 
     RowBox[{"options", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", 
         RowBox[{"NumberQ", "[", 
          RowBox[{
          "transition", "\[LeftDoubleBracket]", "2", 
           "\[RightDoubleBracket]"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"SPAdipole", "::", "invldtrns"}], ",", "transition"}], 
          "]"}], ";", 
         RowBox[{"Return", "[", 
          RowBox[{"SPAdipole", "[", 
           RowBox[{
           "S", ",", "prefactor", ",", "\[CapitalOmega]", ",", "times"}], 
           "]"}], " ", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "times", "]"}], "\[NotEqual]", "2"}], ",", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"SPAdipole", "::", "wrongno"}], ",", 
           RowBox[{"Length", "[", "times", "]"}], ",", "\[CapitalOmega]"}], 
          "]"}], ";", 
         RowBox[{"Return", "[", 
          RowBox[{"SPAdipole", "[", 
           RowBox[{
           "S", ",", "prefactor", ",", "\[CapitalOmega]", ",", "times", ",", 
            "options"}], "]"}], "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"\[CapitalOmega]", "<", 
         RowBox[{
         "transition", "\[LeftDoubleBracket]", "2", 
          "\[RightDoubleBracket]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"SPAdipole", "[", 
         RowBox[{
         "S", ",", "prefactor", ",", "\[CapitalOmega]", ",", "times", ",", 
          "options"}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"SPAdipole", "[", 
         RowBox[{"S", ",", "prefactor", ",", "\[CapitalOmega]", ",", 
          RowBox[{"KeySelect", "[", 
           RowBox[{"times", ",", 
            RowBox[{
             RowBox[{"#", "\[Equal]", 
              RowBox[{
              "transition", "\[LeftDoubleBracket]", "3", 
               "\[RightDoubleBracket]"}]}], "&"}]}], "]"}], ",", "options"}], 
         "]"}]}], "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["UAdipole", "Subsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"UAdipole", "::", "usage"}], "=", 
   "\"\<UAdipole[S,prefactor,\[CapitalOmega],\[LeftAssociation]1\[RightArrow]{\
\!\(\*SubscriptBox[\(t\), \(1\)]\),\!\(\*SubscriptBox[\(\[Tau]\), \(1\)]\)},2\
\[RightArrow]{\!\(\*SubscriptBox[\(t\), \
\(2\)]\),\!\(\*SubscriptBox[\(\[Tau]\), \(2\)]\)},\[Ellipsis]\
\[RightAssociation],transition] returns the total harmonic-dipole \
contribution in the uniform approximation from the specified saddle points, \
taking the given Stokes transition set as a reference.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"UAdipole", "::", "saddleno"}], "=", 
   "\"\<UAdipole called with `1` time pairs at \[CapitalOmega]=`2`. Reverting \
to the saddle-point approximation for this set.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"UAdipole", "::", "invldtrns"}], "=", 
    "\"\<UAdipole called with invalid Stokes transition set `1`. Reverting to \
the saddle-point approximation for this set.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "UAdipole", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{"ReperiodingFunction", "\[Rule]", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"t", ",", "\[Tau]"}], "}"}], ",", "0"}], "]"}]}], "}"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"UAdipole", "[", 
    RowBox[{
    "S_", ",", "prefactor_", ",", "\[CapitalOmega]_", ",", "times_", ",", 
     "transition_", ",", 
     RowBox[{"options", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "times", "]"}], "\[NotEqual]", " ", "2"}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"UAdipole", "::", "saddleno"}], ",", 
          RowBox[{"Length", "[", "times", "]"}], ",", "\[CapitalOmega]"}], 
         "]"}], ";", 
        RowBox[{"Return", "[", 
         RowBox[{"SPAdipole", "[", 
          RowBox[{
          "S", ",", "prefactor", ",", "\[CapitalOmega]", ",", "times"}], 
          "]"}], " ", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"NumberQ", "[", 
         RowBox[{
         "transition", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
          "]"}]}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"UAdipole", "::", "invldtrns"}], ",", "transition"}], "]"}],
         ";", 
        RowBox[{"Return", "[", 
         RowBox[{"SPAdipole", "[", 
          RowBox[{
          "S", ",", "prefactor", ",", "\[CapitalOmega]", ",", "times"}], 
          "]"}], " ", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Block", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "A1", ",", "A2", ",", "S1", ",", "S2", ",", "Ss", ",", "Sm", ",", "z",
          ",", "\[IndentingNewLine]", 
         RowBox[{"t1", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"times", "[", "1", "]"}], "\[LeftDoubleBracket]", "1", 
            "\[RightDoubleBracket]"}], "+", 
           RowBox[{
            RowBox[{"OptionValue", "[", "ReperiodingFunction", "]"}], "[", 
            RowBox[{
             RowBox[{
              RowBox[{"times", "[", "1", "]"}], "\[LeftDoubleBracket]", "1", 
              "\[RightDoubleBracket]"}], ",", 
             RowBox[{
              RowBox[{"times", "[", "1", "]"}], "\[LeftDoubleBracket]", "2", 
              "\[RightDoubleBracket]"}]}], "]"}]}]}], ",", 
         RowBox[{"\[Tau]1", "=", 
          RowBox[{
           RowBox[{"times", "[", "1", "]"}], "\[LeftDoubleBracket]", "2", 
           "\[RightDoubleBracket]"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"t2", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"times", "[", "2", "]"}], "\[LeftDoubleBracket]", "1", 
            "\[RightDoubleBracket]"}], "+", 
           RowBox[{
            RowBox[{"OptionValue", "[", "ReperiodingFunction", "]"}], "[", 
            RowBox[{
             RowBox[{
              RowBox[{"times", "[", "2", "]"}], "\[LeftDoubleBracket]", "1", 
              "\[RightDoubleBracket]"}], ",", 
             RowBox[{
              RowBox[{"times", "[", "2", "]"}], "\[LeftDoubleBracket]", "2", 
              "\[RightDoubleBracket]"}]}], "]"}]}]}], ",", 
         RowBox[{"\[Tau]2", "=", 
          RowBox[{
           RowBox[{"times", "[", "2", "]"}], "\[LeftDoubleBracket]", "2", 
           "\[RightDoubleBracket]"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"A1", "=", 
         RowBox[{
          RowBox[{"HessianRoot", "[", 
           RowBox[{"S", ",", "t1", ",", "\[Tau]1"}], "]"}], 
          RowBox[{"prefactor", "[", 
           RowBox[{"t1", ",", 
            RowBox[{"t1", "-", "\[Tau]1"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"S1", "=", 
         RowBox[{
          RowBox[{"S", "[", 
           RowBox[{"t1", ",", 
            RowBox[{"t1", "-", "\[Tau]1"}]}], "]"}], "-", " ", 
          RowBox[{"\[CapitalOmega]", " ", "t1"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"A2", "=", 
         RowBox[{
          RowBox[{"HessianRoot", "[", 
           RowBox[{"S", ",", "t2", ",", "\[Tau]2"}], "]"}], 
          RowBox[{"prefactor", "[", 
           RowBox[{"t2", ",", 
            RowBox[{"t2", "-", "\[Tau]2"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"S2", "=", 
         RowBox[{
          RowBox[{"S", "[", 
           RowBox[{"t2", ",", 
            RowBox[{"t2", "-", "\[Tau]2"}]}], "]"}], "-", " ", 
          RowBox[{"\[CapitalOmega]", " ", "t2"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Ss", "=", 
         FractionBox[
          RowBox[{"S1", "+", "S2"}], "2"]}], ";", 
        RowBox[{"Sm", "=", 
         FractionBox[
          RowBox[{"S1", "-", "S2"}], "2"]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"\[CapitalOmega]", "<", 
           RowBox[{
           "transition", "\[LeftDoubleBracket]", "2", 
            "\[RightDoubleBracket]"}]}], ",", 
          RowBox[{"z", "=", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", 
               FractionBox["3", "2"]}], "Sm"}], ")"}], 
            RowBox[{"2", "/", "3"}]]}], ",", 
          RowBox[{"z", "=", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", 
                FractionBox["3", "2"]}], "Sm"}], ")"}], 
             RowBox[{"2", "/", "3"}]], 
            RowBox[{"Exp", "[", 
             RowBox[{"\[ImaginaryI]", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                "transition", "\[LeftDoubleBracket]", "3", 
                 "\[RightDoubleBracket]"}], "/.", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"2", "\[Rule]", 
                   RowBox[{"-", "1"}]}], ",", 
                  RowBox[{"1", "\[Rule]", "1"}]}], "}"}]}], ")"}], 
              FractionBox[
               RowBox[{"2", " ", "\[Pi]"}], "3"]}], "]"}]}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         SqrtBox[
          RowBox[{"6", "\[Pi]", " ", "Sm"}]], 
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "\[ImaginaryI]"}], " ", "Ss"}], "+", 
           RowBox[{"\[ImaginaryI]", " ", 
            FractionBox["\[Pi]", "4"]}]}], "]"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            FractionBox[
             RowBox[{"A1", "-", 
              RowBox[{"\[ImaginaryI]", " ", "A2"}]}], "2"], 
            FractionBox[
             RowBox[{"AiryAi", "[", 
              RowBox[{"-", "z"}], "]"}], 
             SqrtBox["z"]]}], "+", 
           RowBox[{"\[ImaginaryI]", " ", 
            FractionBox[
             RowBox[{"A1", "+", 
              RowBox[{"\[ImaginaryI]", " ", "A2"}]}], "2"], 
            FractionBox[
             RowBox[{
              RowBox[{"AiryAi", "'"}], "[", 
              RowBox[{"-", "z"}], "]"}], "z"]}]}], ")"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ")"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Package closure", "Section"],

Cell[CellGroupData[{

Cell["End of package", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]], "Input",
 InitializationCell->True]
}, Open  ]],

Cell[CellGroupData[{

Cell["Add to distributed contexts.", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DistributeDefinitions", "[", "\"\<RBSFA`\>\"", "]"}], 
  ";"}]], "Input",
 InitializationCell->True]
}, Open  ]]
}, Closed]]
}, Open  ]]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
NotebookEventActions->{{"MenuCommand", "Save"} :> (NotebookWrite[
     Part[
      Cells[CellTags -> "version-timestamp"], 1], 
     Cell[
      BoxData[
       RowBox[{
         StringJoin["Begin[\"`Private`\"];\n$RBSFAtimestamp=\"", 
          DateString[], "\";\nEnd[];"]}]], "Input", InitializationCell -> 
      True, CellTags -> "version-timestamp"], None, AutoScroll -> False]; 
   NotebookSave[]), PassEventsDown -> True},
WindowSize->{1861, 1176},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
PrintingCopies->1,
PrintingStartingPageNumber->1,
PrintingPageRange->{Automatic, Automatic},
PageHeaders->{{None, None, 
   Cell[
    TextData[{
     "RB", "-", "SFA", ":", " ", "Rotating", " ", "Bicircular", " ", "HHG", 
      " ", "in", " ", "the", " ", "Strong", " ", "Field", " ", 
      "Approximation", "|", "   ", 
      StyleBox[
       CounterBox["Page"], "PageNumber"]}], "Header", 
    CellMargins -> {{Inherited, 0}, {Inherited, Inherited}}]}, {None, None, 
   Cell[
    TextData[{
     "RB", "-", "SFA", ":", " ", "Rotating", " ", "Bicircular", " ", "HHG", 
      " ", "in", " ", "the", " ", "Strong", " ", "Field", " ", 
      "Approximation", "|", "   ", 
      StyleBox[
       CounterBox["Page"], "PageNumber"]}], "Header", 
    CellMargins -> {{Inherited, 0}, {Inherited, Inherited}}]}},
PageFooters->{{None, None, None}, {None, None, None}},
PageHeaderLines->{False, False},
PageFooterLines->{False, False},
PrintingOptions->{"FacingPages"->True,
"FirstPageFace"->Right,
"FirstPageFooter"->True,
"FirstPageHeader"->False,
"PaperOrientation"->"Portrait",
"PaperSize"->{594.75, 842.25},
"PostScriptOutputFile"->"~/Desktop/print.pdf",
"PrintingMargins"->{{19.84251968503, 19.84251968503}, {72., 72.}}},
PrivateNotebookOptions->{"FileOutlineCache"->False},
ShowSelection->True,
TrackCellChangeTimes->False,
Background->None,
FrontEndVersion->"10.4 for Linux x86 (64-bit) (February 25, 2016)",
StyleDefinitions->Notebook[{
   Cell[
    StyleData[StyleDefinitions -> "Default.nb"]], 
   Cell[
    StyleData["Code"], FontWeight -> "Plain", FontSlant -> "Plain", 
    FontTracking -> "Plain", 
    FontVariations -> {
     "Outline" -> False, "Shadow" -> False, "StrikeThrough" -> False, 
      "Underline" -> False}]}, Visible -> False, FrontEndVersion -> 
  "10.4 for Linux x86 (64-bit) (February 25, 2016)", StyleDefinitions -> 
  "PrivateStylesheetFormatting.nb"]
]

