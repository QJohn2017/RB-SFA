Notebook[{

Cell[CellGroupData[{
Cell[TextData[{
 StyleBox["RB-SFA: High Harmonic Generation in the Strong Field Approximation \
via ",
  FontSize->24],
 StyleBox["Mathematica",
  FontSize->24,
  FontSlant->"Italic"]
}], "Title"],

Cell["\[Copyright] Emilio Pisanty 2014-2016. Licensed under GPL and \
CC-BY-SA.", "Text"],

Cell[CellGroupData[{

Cell["Introduction", "Section",
 CellTags->"Introduction"],

Cell[CellGroupData[{

Cell["Readme", "Subsection"],

Cell[TextData[{
 "RB-SFA is a compact and flexible ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 " package for calculating High Harmonic Generation emission within the \
Strong Field Approximation. It combines ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 "\[CloseCurlyQuote]s analytical integration capabilities with its numerical \
calculation capacities to offer a fast and user-friendly plug-and-play solver \
for calculating harmonic spectra and other properties. In addition, it can \
calculate first-order nondipole corrections to the SFA results to evaluate \
the effect of the driving laser\[CloseCurlyQuote]s magnetic field on harmonic \
spectra.\n\nThe name RB-SFA comes from its first application (as Rotating \
Bicircular High Harmonic Generation in the Strong field Approximation) but \
the code is general so RB-SFA just stands for itself now. This first \
application was used to calculate the polarization properties of the \
harmonics produced by multi-colour circularly polarized fields, as reported \
in the paper\n\n    Spin conservation in high-order-harmonic generation using \
bicircular fields. E. Pisanty, S. Sukiasyan and M. Ivanov. ",
 StyleBox[ButtonBox["Phys. Rev. A",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.90.043829"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.90.043829"],
  FontSlant->"Italic"],
 ButtonBox[" ",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.90.043829"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.90.043829"],
 StyleBox[ButtonBox["90",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.90.043829"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.90.043829"],
  FontWeight->"Bold"],
 ButtonBox[", 043829 (2014)",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.90.043829"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.90.043829"],
 ", ",
 ButtonBox["arXiv:1404.6242",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://arxiv.org/abs/1404.6242"], None},
  ButtonNote->"http://arxiv.org/abs/1404.6242"],
 ".\n\nThis code is dual-licensed under the ",
 ButtonBox["GPL",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://www.gnu.org/licenses/gpl-3.0.en.html"], None},
  ButtonNote->"http://www.gnu.org/licenses/gpl-3.0.en.html"],
 " and ",
 ButtonBox["CC-BY-SA",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["https://creativecommons.org/licenses/by-sa/4.0/"], None},
  ButtonNote->"https://creativecommons.org/licenses/by-sa/4.0/"],
 " licenses. If you use this code or its results in an academic publication, \
please cite the paper above or the GitHub repository where the latest version \
will always be available. An example citation is \n\n    E. Pisanty. RB-SFA: \
High Harmonic Generation in the Strong Field Approximation via ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 ". ",
 ButtonBox["https://github.com/episanty/RB-SFA",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["https://github.com/episanty/RB-SFA"], None},
  ButtonNote->"https://github.com/episanty/RB-SFA"],
 " (2014).\n\nThis software consists of this notebook, which contains the \
code and its documentation, a corresponding auto-generated package file. This \
notebook also contains a Usage and Examples section which explains how to use \
the code and documents the calculations used in the original publication."
}], "Text"]
}, Closed]],

Cell[CellGroupData[{

Cell["Specifications", "Subsection"],

Cell[TextData[{
 "This code calculates the harmonic dipole as per the original Lewenstein ",
 StyleBox["et al.",
  FontSlant->"Italic"],
 " paper,\n\n    M. Lewenstein, Ph. Balcou, M.Yu. Ivanov, A. L\
\[CloseCurlyQuote]Huillier and P.B. Corkum. Theory of high-harmonic \
generation by low-frequency laser fields.",
 StyleBox[" ",
  FontSlant->"Italic"],
 StyleBox[ButtonBox["Phys. Rev. A",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.49.2117"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.49.2117"],
  FontSlant->"Italic"],
 ButtonBox[" ",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.49.2117"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.49.2117"],
 StyleBox[ButtonBox["49",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.49.2117"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.49.2117"],
  FontWeight->"Bold"],
 ButtonBox[" no. 3, 2117 (1994).",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.49.2117"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.49.2117"],
 "\n    \nThe time-dependent dipole is given by\n\n          ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     StyleBox["D",
      FontWeight->"Bold"], "(", "t", ")"}], "=", 
    RowBox[{
     RowBox[{"\[ImaginaryI]", 
      RowBox[{
       SubsuperscriptBox["\[Integral]", "0", "t"], 
       RowBox[{
        RowBox[{"\[DifferentialD]", 
         RowBox[{"t", "'"}]}], 
        RowBox[{"\[Integral]", 
         RowBox[{
          RowBox[{
           SuperscriptBox["\[DifferentialD]", "3"], 
           StyleBox["p",
            FontWeight->"Bold"]}], " ", 
          RowBox[{
           StyleBox["d",
            FontWeight->"Bold"], "(", 
           RowBox[{
            StyleBox["\[Pi]",
             FontWeight->"Bold"], "(", 
            RowBox[{
             StyleBox["p",
              FontWeight->"Bold"], ",", "t"}], ")"}], ")"}], " ", "\[Times]", 
          " ", 
          RowBox[{
           RowBox[{
            StyleBox["F",
             FontWeight->"Bold"], "(", 
            RowBox[{"t", "'"}], ")"}], "\[CenterDot]", 
           RowBox[{
            StyleBox["d",
             FontWeight->"Bold"], "(", 
            RowBox[{
             StyleBox["\[Pi]",
              FontWeight->"Bold"], "(", 
             RowBox[{
              StyleBox["p",
               FontWeight->"Bold"], ",", 
              RowBox[{"t", "'"}]}], ")"}], ")"}]}], "\[Times]", 
          RowBox[{"exp", "[", 
           RowBox[{
            RowBox[{"-", "\[ImaginaryI]"}], " ", 
            RowBox[{"S", "(", 
             RowBox[{
              StyleBox["p",
               FontWeight->"Bold"], ",", "t", ",", 
              RowBox[{"t", "'"}]}], ")"}]}], "]"}]}]}]}]}]}], "+", 
     RowBox[{"c", ".", "c", "."}]}]}], TraditionalForm]]],
 "\n\nHere ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    StyleBox["F",
     FontWeight->"Bold"], "(", "t", ")"}], TraditionalForm]]],
 "is the time-dependent applied electric field, with vector potential ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    StyleBox["A",
     FontWeight->"Bold"], "(", "t", ")"}], TraditionalForm]]],
 "; the electron charge is taken to be ",
 Cell[BoxData[
  FormBox[
   RowBox[{"-", "1"}], TraditionalForm]]],
 ". The integration time ",
 Cell[BoxData[
  FormBox[
   RowBox[{"t", "'"}], TraditionalForm]]],
 " can be interpreted as the ionization time and the integration limit ",
 Cell[BoxData[
  FormBox["t", TraditionalForm]]],
 " represents the recollision time. (Upon applying the saddle-point \
approximation to the temporal integrals these notions apply exactly to the \
corresponding quantum orbits.) The ionization and recollision events are \
governed by the corresponding dipole matrix elements, which are taken for a \
hydrogenic 1s-type orbital with characteristic momentum \[Kappa] and \
ionization potential ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["I", "p"], "=", 
    RowBox[{
     FractionBox["1", "2"], 
     SuperscriptBox["\[Kappa]", "2"]}]}], TraditionalForm]]],
 ":\n\n    ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     StyleBox["d",
      FontWeight->"Bold"], "(", 
     StyleBox["p",
      FontWeight->"Bold"], ")"}], "=", 
    RowBox[{
     RowBox[{
      TemplateBox[{StyleBox["p", FontWeight -> "Bold"]},
       "Bra"], 
      OverscriptBox[
       StyleBox["d",
        FontWeight->"Bold"], "^"], 
      TemplateBox[{"g"},
       "Ket"]}], "=", 
     RowBox[{
      FractionBox[
       RowBox[{"8", "\[ImaginaryI]"}], "\[Pi]"], 
      FractionBox[
       RowBox[{
        SqrtBox[
         RowBox[{"2", 
          SuperscriptBox["\[Kappa]", "5"]}]], 
        StyleBox["p",
         FontWeight->"Bold"]}], 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           StyleBox["p",
            FontWeight->"Bold"], "2"], "+", 
          SuperscriptBox["\[Kappa]", "2"]}], ")"}], "3"]]}]}]}], 
   TraditionalForm]]],
 ".\n\n(Taken from B. Podolsky & L. Pauling. ",
 StyleBox[ButtonBox["Phys. Rev.",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRev.34.109"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRev.34.109"],
  FontSlant->"Italic"],
 ButtonBox[" ",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRev.34.109"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRev.34.109"],
 StyleBox[ButtonBox["34",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRev.34.109"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRev.34.109"],
  FontWeight->"Bold"],
 ButtonBox[" no. 1, 109 (1929)",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRev.34.109"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRev.34.109"],
 ".) The displaced momentum ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     StyleBox["\[Pi]",
      FontWeight->"Bold"], "(", 
     RowBox[{
      StyleBox["p",
       FontWeight->"Bold"], ",", "t"}], ")"}], "=", 
    RowBox[{
     StyleBox["p",
      FontWeight->"Bold"], "+", 
     RowBox[{
      StyleBox["A",
       FontWeight->"Bold"], "(", "t", ")"}]}]}], TraditionalForm]]],
 " is used to aid in the generalization to nondipole cases.\n\nThe action \n\n\
    ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"S", "(", 
     RowBox[{
      StyleBox["p",
       FontWeight->"Bold"], ",", "t", ",", 
      RowBox[{"t", "'"}]}], ")"}], "=", 
    RowBox[{
     SubsuperscriptBox["\[Integral]", 
      RowBox[{"t", "'"}], "t"], 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         FractionBox["1", "2"], 
         SuperscriptBox["\[Kappa]", "2"]}], "+", 
        RowBox[{
         FractionBox["1", "2"], 
         SuperscriptBox[
          RowBox[{
           StyleBox["\[Pi]",
            FontWeight->"Bold"], "(", 
           RowBox[{
            StyleBox["p",
             FontWeight->"Bold"], ",", "\[Tau]"}], ")"}], "2"]}]}], ")"}], 
      RowBox[{"\[DifferentialD]", "\[Tau]"}]}]}]}], TraditionalForm]]],
 " \n\nis the governing factor of the integral. It is highly oscillatory and \
must be dealt with carefully. The momentum integral is approximated using the \
saddle point method; this is valid and straightforward since there is always \
one unique saddle point,\n\n    ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     SubscriptBox[
      StyleBox["p",
       FontWeight->"Bold"], "s"], "(", 
     RowBox[{"t", ",", 
      RowBox[{"t", "'"}]}], ")"}], "=", 
    RowBox[{"-", 
     FractionBox[
      RowBox[{
       SubsuperscriptBox["\[Integral]", 
        RowBox[{"t", "'"}], "t"], 
       RowBox[{
        RowBox[{
         StyleBox["A",
          FontWeight->"Bold"], "(", 
         RowBox[{"t", "''"}], ")"}], 
        RowBox[{"\[DifferentialD]", 
         RowBox[{"t", "''"}]}]}]}], 
      RowBox[{"t", "-", 
       RowBox[{"t", "'"}]}]]}]}], TraditionalForm]]],
 ",\n    \nas long as the action\[CloseCurlyQuote]s dependence on the \
momentum is quadratic. After the momentum has been integrated via the saddle \
point method, the time-dependent dipole is given by\n\n          ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     StyleBox["D",
      FontWeight->"Bold"], "(", "t", ")"}], "=", 
    RowBox[{
     RowBox[{"\[ImaginaryI]", 
      RowBox[{
       SubsuperscriptBox["\[Integral]", "0", "t"], 
       RowBox[{
        RowBox[{"\[DifferentialD]", 
         RowBox[{"t", "'"}]}], 
        SuperscriptBox[
         RowBox[{"(", 
          FractionBox[
           RowBox[{"2", "\[Pi]"}], 
           RowBox[{"\[Epsilon]", "+", 
            RowBox[{"\[ImaginaryI]", "(", 
             RowBox[{"t", "-", 
              RowBox[{"t", "'"}]}], ")"}]}]], ")"}], 
         RowBox[{"3", "/", "2"}]], " ", 
        RowBox[{
         StyleBox["d",
          FontWeight->"Bold"], "(", 
         RowBox[{
          StyleBox["\[Pi]",
           FontWeight->"Bold"], "(", 
          RowBox[{
           RowBox[{
            SubscriptBox[
             StyleBox["p",
              FontWeight->"Bold"], "s"], "(", 
            RowBox[{"t", ",", 
             RowBox[{"t", "'"}]}], ")"}], ",", "t"}], ")"}], ")"}], " ", 
        "\[Times]", " ", 
        RowBox[{
         RowBox[{
          StyleBox["F",
           FontWeight->"Bold"], "(", 
          RowBox[{"t", "'"}], ")"}], "\[CenterDot]", 
         RowBox[{
          StyleBox["d",
           FontWeight->"Bold"], "(", 
          RowBox[{
           StyleBox["\[Pi]",
            FontWeight->"Bold"], "(", 
           RowBox[{
            RowBox[{
             SubscriptBox[
              StyleBox["p",
               FontWeight->"Bold"], "s"], "(", 
             RowBox[{"t", ",", 
              RowBox[{"t", "'"}]}], ")"}], ",", 
            RowBox[{"t", "'"}]}], ")"}], ")"}]}], "\[Times]", 
        RowBox[{"exp", "[", 
         RowBox[{
          RowBox[{"-", "\[ImaginaryI]"}], " ", 
          RowBox[{"S", "(", 
           RowBox[{
            RowBox[{
             StyleBox[
              SubscriptBox[
               StyleBox["p",
                FontWeight->"Bold"], 
               StyleBox["s",
                FontWeight->"Plain"]],
              FontWeight->"Bold"], "(", 
             RowBox[{"t", ",", 
              RowBox[{"t", "'"}]}], ")"}], ",", "t", ",", 
            RowBox[{"t", "'"}]}], ")"}]}], "]"}]}]}]}], "+", 
     RowBox[{"c", ".", "c", "."}]}]}], TraditionalForm]]],
 "\n          \nA regularization factor ",
 Cell[BoxData[
  FormBox["\[Epsilon]", TraditionalForm]]],
 " has been introduced to prevent divergence of the prefactor as ",
 Cell[BoxData[
  FormBox[
   RowBox[{"t", "'"}], TraditionalForm]]],
 " approaches ",
 Cell[BoxData[
  FormBox["t", TraditionalForm]]],
 ", representing the fact that at ",
 Cell[BoxData[
  FormBox[
   RowBox[{"t", "=", 
    RowBox[{"t", "'"}]}], TraditionalForm]]],
 " the ",
 Cell[BoxData[
  FormBox[
   StyleBox["p",
    FontWeight->"Bold"], TraditionalForm]]],
 " integral no longer has a quadratic exponent.\n\nThe integral is performed \
with respect to the excursion time ",
 Cell[BoxData[
  FormBox[
   RowBox[{"\[Tau]", "=", 
    RowBox[{"t", "-", 
     RowBox[{"t", "'"}]}]}], TraditionalForm]]],
 " for simplicity. To reduce integration time, a gating function ",
 Cell[BoxData[
  FormBox[
   RowBox[{"gate", "[", 
    RowBox[{"\[Omega]", " ", "\[Tau]"}], "]"}], TraditionalForm]]],
 " has been introduced, and the integration time has been cut short to a \
controllable length. This is physically reasonable as the wavepacket \
spreading (which scales as ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["\[Tau]", 
    RowBox[{
     RowBox[{"-", "3"}], "/", "2"}]], TraditionalForm]]],
 ") makes the contributions after the gate negligible.\nMore physically, \
supressing the contributions from large excursion times represents the fact \
that the extra-long trajectories they represent produce harmonics which are \
much harder to phase match (as their harmonic phase is very sensitively \
dependent on many factors) which means that they are rarely present in \
experimental spectra unless a concerted effort is performed to observe them."
}], "Text"]
}, Closed]],

Cell[CellGroupData[{

Cell["First-order nondipole calculations", "Subsection"],

Cell[TextData[{
 "This code can also be used to calculate the first-order effect of nondipole \
terms, which become relevant at high intensities or long wavelengths, when \
the electron\[CloseCurlyQuote]s speed from the laser-driven oscillations \
(which scales as ",
 Cell[BoxData[
  FormBox[
   RowBox[{"F", "/", "\[Omega]"}], TraditionalForm]]],
 ") becomes comparable to the speed of light (equal to ",
 Cell[BoxData[
  FormBox[
   RowBox[{"c", "=", 
    RowBox[{
     RowBox[{"1", "/", "\[Alpha]"}], "\[TildeTilde]", "137"}]}], 
   TraditionalForm]]],
 " in atomic units). (More specifically, the nondipole effects on the \
harmonic generation become relevant when the magnetic pushing per cycle, \
which offsets the returning wavepacket by ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SuperscriptBox["F", "2"], "/", 
    SuperscriptBox["c\[Omega]", "3"]}], TraditionalForm]]],
 ", becomes comparable with the wavepacket spread upon recollision.)\n\nThis \
code implements a generalization of the theory presented in various forms in \
the papers N.J. Kylstra et al. ",
 StyleBox[ButtonBox["J. Phys B: At. Mol. Opt. Phys.",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1088/0953-4075/34/3/101"], None},
  ButtonNote->"http://dx.doi.org/10.1088/0953-4075/34/3/101"],
  FontSlant->"Italic"],
 ButtonBox[" ",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1088/0953-4075/34/3/101"], None},
  ButtonNote->"http://dx.doi.org/10.1088/0953-4075/34/3/101"],
 StyleBox[ButtonBox["34",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1088/0953-4075/34/3/101"], None},
  ButtonNote->"http://dx.doi.org/10.1088/0953-4075/34/3/101"],
  FontWeight->"Bold"],
 ButtonBox[" no. 3, L55 (2001)",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1088/0953-4075/34/3/101"], None},
  ButtonNote->"http://dx.doi.org/10.1088/0953-4075/34/3/101"],
 "; N..J. Kylstra et al. ",
 StyleBox[ButtonBox["Laser Phys.",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1088/0953-4075/34/3/101"], None},
  ButtonNote->"http://dx.doi.org/10.1088/0953-4075/34/3/101"],
  FontSlant->"Italic"],
 ButtonBox[" ",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1088/0953-4075/34/3/101"], None},
  ButtonNote->"http://dx.doi.org/10.1088/0953-4075/34/3/101"],
 StyleBox[ButtonBox["12",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1088/0953-4075/34/3/101"], None},
  ButtonNote->"http://dx.doi.org/10.1088/0953-4075/34/3/101"],
  FontWeight->"Bold"],
 ButtonBox[" no. 2, 409 (2002)",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1088/0953-4075/34/3/101"], None},
  ButtonNote->"http://dx.doi.org/10.1088/0953-4075/34/3/101"],
 "; M.W. Walser et al. ",
 StyleBox[ButtonBox["Phys. Rev. Lett.",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevLett.85.5082"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevLett.85.5082"],
  FontSlant->"Italic"],
 ButtonBox[" ",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevLett.85.5082"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevLett.85.5082"],
 StyleBox[ButtonBox["85",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevLett.85.5082"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevLett.85.5082"],
  FontWeight->"Bold"],
 ButtonBox[" no. 24, 5082 (2000)",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevLett.85.5082"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevLett.85.5082"],
 "; V. Averbukh et al. ",
 StyleBox[ButtonBox["Phys Rev. A",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.65.063402"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.65.063402"],
  FontSlant->"Italic"],
 ButtonBox[" ",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.65.063402"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.65.063402"],
 StyleBox[ButtonBox["65,",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.65.063402"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.65.063402"],
  FontWeight->"Bold"],
 ButtonBox[" 063402 (2002)",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.65.063402"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.65.063402"],
 "; and C.C. Chiril\[ACup] et al. ",
 StyleBox[ButtonBox["Phys. Rev. A",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.66.063411"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.66.063411"],
  FontSlant->"Italic"],
 ButtonBox[" ",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.66.063411"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.66.063411"],
 StyleBox[ButtonBox["66,",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.66.063411"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.66.063411"],
  FontWeight->"Bold"],
 ButtonBox[" 063411 (2002)",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://dx.doi.org/10.1103/PhysRevA.66.063411"], None},
  ButtonNote->"http://dx.doi.org/10.1103/PhysRevA.66.063411"],
 ".\n\nThe nondipole-HHG code calculates the harmonic dipole of exactly the \
same form as the standard SFA,\n\n          ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     StyleBox["D",
      FontWeight->"Bold"], "(", "t", ")"}], "=", 
    RowBox[{
     RowBox[{"\[ImaginaryI]", 
      RowBox[{
       SubsuperscriptBox["\[Integral]", "0", "t"], 
       RowBox[{
        RowBox[{"\[DifferentialD]", 
         RowBox[{"t", "'"}]}], 
        RowBox[{"\[Integral]", 
         RowBox[{
          RowBox[{
           SuperscriptBox["\[DifferentialD]", "3"], 
           StyleBox["p",
            FontWeight->"Bold"]}], " ", 
          RowBox[{
           StyleBox["d",
            FontWeight->"Bold"], "(", 
           RowBox[{
            StyleBox["\[Pi]",
             FontWeight->"Bold"], "(", 
            RowBox[{
             StyleBox["p",
              FontWeight->"Bold"], ",", "t", ",", 
             RowBox[{"t", "'"}]}], ")"}], ")"}], " ", "\[Times]", " ", 
          RowBox[{
           RowBox[{
            StyleBox["F",
             FontWeight->"Bold"], "(", 
            RowBox[{"t", "'"}], ")"}], "\[CenterDot]", 
           RowBox[{
            StyleBox["d",
             FontWeight->"Bold"], "(", 
            RowBox[{
             StyleBox["\[Pi]",
              FontWeight->"Bold"], "(", 
             RowBox[{
              StyleBox["p",
               FontWeight->"Bold"], ",", 
              RowBox[{"t", "'"}], ",", 
              RowBox[{"t", "'"}]}], ")"}], ")"}]}], "\[Times]", 
          RowBox[{"exp", "[", 
           RowBox[{
            RowBox[{"-", "\[ImaginaryI]"}], " ", 
            RowBox[{"S", "(", 
             RowBox[{
              StyleBox["p",
               FontWeight->"Bold"], ",", "t", ",", 
              RowBox[{"t", "'"}]}], ")"}]}], "]"}]}]}]}]}]}], "+", 
     RowBox[{"c", ".", "c", "."}]}]}], TraditionalForm]]],
 "\n\nwith ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"S", "(", 
     RowBox[{
      StyleBox["p",
       FontWeight->"Bold"], ",", "t", ",", 
      RowBox[{"t", "'"}]}], ")"}], "=", 
    RowBox[{
     SubsuperscriptBox["\[Integral]", 
      RowBox[{"t", "'"}], "t"], 
     RowBox[{
      RowBox[{"\[DifferentialD]", 
       RowBox[{"t", "''"}]}], 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         FractionBox["1", "2"], 
         SuperscriptBox["\[Kappa]", "2"]}], "+", 
        RowBox[{
         FractionBox["1", "2"], 
         SuperscriptBox[
          RowBox[{
           StyleBox["\[Pi]",
            FontWeight->"Bold"], "(", 
           RowBox[{
            StyleBox["p",
             FontWeight->"Bold"], ",", 
            RowBox[{"t", "''"}], ",", 
            RowBox[{"t", "'"}]}], ")"}], "2"]}]}], ")"}]}]}]}], 
   TraditionalForm]]],
 "  as before, but with a nondipole term in the displaced momentum, which now \
reads\n\n          ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     StyleBox["\[Pi]",
      FontWeight->"Bold"], "(", 
     RowBox[{
      StyleBox["p",
       FontWeight->"Bold"], ",", "t", ",", 
      RowBox[{"t", "'"}]}], ")"}], "=", 
    RowBox[{
     StyleBox["p",
      FontWeight->"Bold"], "+", 
     RowBox[{
      StyleBox["A",
       FontWeight->"Bold"], "(", "t", ")"}], "-", 
     RowBox[{
      SubsuperscriptBox["\[Integral]", 
       RowBox[{"t", "'"}], "t"], 
      RowBox[{
       RowBox[{
        RowBox[{
         StyleBox["\[Del]",
          FontWeight->"Bold"], 
         RowBox[{
          StyleBox["A",
           FontWeight->"Bold"], "(", "\[Tau]", ")"}]}], "\[CenterDot]", 
        RowBox[{"(", 
         RowBox[{
          StyleBox["p",
           FontWeight->"Bold"], "+", 
          RowBox[{
           StyleBox["A",
            FontWeight->"Bold"], "(", "\[Tau]", ")"}]}], ")"}]}], 
       RowBox[{"\[DifferentialD]", "\[Tau]"}]}]}]}]}], TraditionalForm]]],
 ",\n          \nor in component notation\n\n          ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     SubscriptBox["\[Pi]", "j"], "(", 
     RowBox[{
      StyleBox["p",
       FontWeight->"Bold"], ",", "t", ",", 
      RowBox[{"t", "'"}]}], ")"}], "=", 
    RowBox[{
     SubscriptBox["p", "j"], "+", 
     RowBox[{
      SubscriptBox["A", "j"], "(", "t", ")"}], "-", 
     RowBox[{
      SubsuperscriptBox["\[Integral]", 
       RowBox[{"t", "'"}], "t"], 
      RowBox[{
       RowBox[{
        SubscriptBox["\[PartialD]", "j"], 
        RowBox[{
         SubscriptBox["A", "k"], "(", "\[Tau]", ")"}]}], 
       RowBox[{"(", 
        RowBox[{
         SubscriptBox["p", "k"], "+", 
         RowBox[{
          SubscriptBox["A", "k"], "(", "\[Tau]", ")"}]}], ")"}], 
       RowBox[{"\[DifferentialD]", "\[Tau]"}]}]}]}]}], TraditionalForm]]],
 "."
}], "Text"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Implementation: supporting functions", "Section"],

Cell[CellGroupData[{

Cell["Initialization", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BeginPackage", "[", "\"\<RBSFA`\>\"", "]"}], ";"}]], "Input",
 InitializationCell->True],

Cell[CellGroupData[{

Cell["Version number and timestamp", "Subsubsection"],

Cell["\<\
The command RBSFAversion prints the version of the RB-SFA package currently \
loaded and its timestamp\
\>", "Text"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"RBSFAversion", "::", "usage"}], "=", 
   "\"\<RBSFAversion[] prints the current version of the RB-SFA package in \
use and its timestamp.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBSFAversion", "[", "]"}], "=", 
   "\"\<RB-SFA v2.0.1, Thu 4 Feb 2016 23:33:19\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellTags->"version-definition"],

Cell["\<\
The timestamp is updated every time the notebook is saved via an appropriate \
notebook option, which is set by the code below.\
\>", "Text"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetOptions", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"EvaluationNotebook", "[", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"NotebookEventActions", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\"\<MenuCommand\>\"", ",", "\"\<Save\>\""}], "}"}], 
        "\[RuleDelayed]", 
        RowBox[{"(", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"NotebookWrite", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"Cells", "[", 
              RowBox[{"CellTags", "\[Rule]", "\"\<version-definition\>\""}], 
              "]"}], "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"Cell", "[", 
             RowBox[{
              RowBox[{"BoxData", "[", 
               RowBox[{"RowBox", "[", 
                RowBox[{"{", "\[IndentingNewLine]", 
                 RowBox[{
                 "\"\<RBSFAversion::usage=\\\"RBSFAversion[] prints the \
current version of the RB-SFA package in use and its timestamp.\\\";\
\[IndentingNewLine]Begin[\\\"`Private`\\\"];\[IndentingNewLine]RBSFAversion[]=\
\\\"\>\"", "<>", 
                  RowBox[{"First", "[", 
                   RowBox[{"StringSplit", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Select", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Flatten", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"NotebookRead", "[", 
                    RowBox[{
                    RowBox[{"Cells", "[", 
                    RowBox[{
                    "CellTags", "\[Rule]", "\"\<version-definition\>\""}], 
                    "]"}], "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "]"}], "\[IndentingNewLine]", "/.", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Cell", "\[Rule]", "List"}], ",", 
                    RowBox[{"BoxData", "\[Rule]", "List"}], ",", 
                    RowBox[{"RowBox", "\[Rule]", "List"}]}], "}"}]}], 
                    "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
                    
                    RowBox[{
                    RowBox[{"Quiet", "[", 
                    RowBox[{"StringContainsQ", "[", 
                    RowBox[{"#", ",", "\"\<RB-SFA v\>\""}], "]"}], "]"}], 
                    "&"}]}], "\[IndentingNewLine]", "]"}], 
                    "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                    ",", 
                    RowBox[{"{", 
                    RowBox[{"\"\<\\\"\>\"", ",", "\"\<,\>\""}], "}"}]}], 
                    "]"}], "]"}], "<>", "\"\<, \>\"", "<>", 
                  RowBox[{"DateString", "[", "]"}], "<>", 
                  "\"\<\\\";\[IndentingNewLine]End[];\>\""}], 
                 "\[IndentingNewLine]", "}"}], "]"}], "]"}], ",", 
              "\"\<Input\>\"", ",", 
              RowBox[{"InitializationCell", "\[Rule]", "True"}], ",", 
              RowBox[{"CellTags", "\[Rule]", "\"\<version-definition\>\""}]}],
              "]"}], "\[IndentingNewLine]", ",", "None"}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"NotebookSave", "[", "]"}]}], "\[IndentingNewLine]", 
         ")"}]}], ",", 
       RowBox[{"PassEventsDown", "\[Rule]", "True"}]}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}], ";"}]], "Input"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Dipole transition matrix elements", "Subsection"],

Cell["Default DTME is for a hydrogenic 1s state.", "Text"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"hydrogenicDTME", "::", "usage"}], "=", 
   "\"\<hydrogenicDTME[p,\[Kappa]] returns the dipole transition matrix \
element for a 1s hydrogenic state of ionization potential \!\(\*SubscriptBox[\
\(I\), \(p\)]\)=\!\(\*FractionBox[\(1\), \(2\)]\)\!\(\*SuperscriptBox[\(\
\[Kappa]\), \(2\)]\).\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hydrogenicDTME", "[", 
   RowBox[{"p_", ",", "\[Kappa]_"}], "]"}], ":=", 
  RowBox[{
   FractionBox[
    RowBox[{"8", "\[ImaginaryI]"}], "\[Pi]"], 
   FractionBox[
    RowBox[{
     SqrtBox[
      RowBox[{"2", 
       SuperscriptBox["\[Kappa]", "5"]}]], "p"}], 
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"Norm", "[", "p", "]"}], "2"], "+", 
       SuperscriptBox["\[Kappa]", "2"]}], ")"}], 
     "3"]]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True],

Cell["Another possibility is for a gaussian orbital", "Text"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"gaussianDTME", "::", "usage"}], "=", 
  "\"\<gaussianDTME[p,\[Kappa]] returns the dipole transition matrix element \
for a gaussian state of characteristic size 1/\[Kappa].\>\""}], "\
\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gaussianDTME", "[", 
   RowBox[{"p_", ",", "\[Kappa]_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"-", "\[ImaginaryI]"}], " ", 
   SuperscriptBox[
    RowBox[{"(", 
     RowBox[{"4", "\[Pi]"}], ")"}], 
    RowBox[{"3", "/", "4"}]], 
   SuperscriptBox["\[Kappa]", 
    RowBox[{
     RowBox[{"-", "7"}], "/", "2"}]], "p", " ", 
   RowBox[{"Exp", "[", 
    RowBox[{"-", 
     FractionBox[
      SuperscriptBox[
       RowBox[{"Norm", "[", "p", "]"}], "2"], 
      RowBox[{"2", 
       SuperscriptBox["\[Kappa]", "2"]}]]}], "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{"End", "[", "]"}]}], "Input",
 InitializationCell->True],

Cell[BoxData["\<\"gaussianDTME[p,\[Kappa]] returns the dipole transition \
matrix element for a gaussian state of characteristic size 1/\[Kappa].\"\>"], \
"Output"],

Cell[BoxData["\<\"RBSFA`Private`\"\>"], "Output"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Various field envelopes", "Subsection"],

Cell[CellGroupData[{

Cell["flatTopEnvelope", "Subsubsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"flatTopEnvelope", "::", "usage"}], "=", 
   "\"\<flatTopEnvelope[\[Omega],num,nRamp] returns a Function object \
representing a flat-top envelope at carrier frequency \[Omega] lasting a \
total of num cycles and with linear ramps nRamp cycles long.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"flatTopEnvelope", "[", 
   RowBox[{"\[Omega]_", ",", "num_", ",", "nRamp_"}], "]"}], ":=", 
  RowBox[{"Function", "[", 
   RowBox[{"t", ",", 
    RowBox[{"Piecewise", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"t", "<", "0"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         SuperscriptBox[
          RowBox[{"Sin", "[", 
           FractionBox[
            RowBox[{"\[Omega]", " ", "t"}], 
            RowBox[{"4", "nRamp"}]], "]"}], "2"], ",", 
         RowBox[{"0", "\[LessEqual]", "t", "<", 
          RowBox[{
           FractionBox[
            RowBox[{"2", " ", "\[Pi]"}], "\[Omega]"], " ", "nRamp"}]}]}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", 
         RowBox[{
          RowBox[{
           FractionBox[
            RowBox[{"2", " ", "\[Pi]"}], "\[Omega]"], "nRamp"}], 
          "\[LessEqual]", "t", "<", 
          RowBox[{
           FractionBox[
            RowBox[{"2", " ", "\[Pi]"}], "\[Omega]"], 
           RowBox[{"(", 
            RowBox[{"num", "-", "nRamp"}], ")"}]}]}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         SuperscriptBox[
          RowBox[{"Sin", "[", 
           FractionBox[
            RowBox[{"\[Omega]", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                FractionBox[
                 RowBox[{"2", " ", "\[Pi]"}], "\[Omega]"], "num"}], "-", 
               "t"}], ")"}]}], 
            RowBox[{"4", "nRamp"}]], "]"}], "2"], ",", 
         RowBox[{
          RowBox[{
           FractionBox[
            RowBox[{"2", " ", "\[Pi]"}], "\[Omega]"], 
           RowBox[{"(", 
            RowBox[{"num", "-", "nRamp"}], ")"}]}], "\[LessEqual]", "t", "<", 
          
          RowBox[{
           FractionBox[
            RowBox[{"2", " ", "\[Pi]"}], "\[Omega]"], "num"}]}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{
          RowBox[{
           FractionBox[
            RowBox[{"2", " ", "\[Pi]"}], "\[Omega]"], " ", "num"}], 
          "\[LessEqual]", "t"}]}], "}"}]}], "}"}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["cosPowerFlatTop", "Subsubsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"cosPowerFlatTop", "::", "usage"}], "=", 
   "\"\<cosPowerFlatTop[\[Omega],num,power] returns a Function object \
representing a smooth flat-top envelope of the form 1-Cos(\[Omega] t/2 \
num\!\(\*SuperscriptBox[\()\), \(power\)]\)\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cosPowerFlatTop", "[", 
   RowBox[{"\[Omega]_", ",", "num_", ",", "power_"}], "]"}], ":=", 
  RowBox[{"Function", "[", 
   RowBox[{"t", ",", 
    RowBox[{"1", "-", 
     SuperscriptBox[
      RowBox[{"Cos", "[", 
       FractionBox[
        RowBox[{"\[Omega]", " ", "t"}], 
        RowBox[{"2", "num"}]], "]"}], "power"]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Field duration standard options", "Subsection"],

Cell["\<\
The standard options for the duration of the pulse and the resolution are\
\>", "Text",
 CellChangeTimes->{}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PointsPerCycle", "::", "usage"}], "=", 
   "\"\<PointsPerCycle is a sampling option which specifies the number of \
sampling points per cycle to be used in integrations.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TotalCycles", "::", "usage"}], "=", 
   "\"\<TotalCycles is a sampling option which specifies the total number of \
periods to be integrated over.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CarrierFrequency", "::", "usage"}], "=", 
   "\"\<CarrierFrequency is a sampling option which specifies the carrier \
frequency to be used.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", 
   RowBox[{"PointsPerCycle", ",", "TotalCycles", ",", "CarrierFrequency"}], 
   "]"}], ";"}]}], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"standardOptions", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"PointsPerCycle", "\[Rule]", "90"}], ",", 
     RowBox[{"TotalCycles", "\[Rule]", "1"}], ",", 
     RowBox[{"CarrierFrequency", "\[Rule]", "0.057"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[TextData[{
 "PointsPerCycle dictates how many sampling points are used per laser cycle \
(at frequency CarrierFrequency, of the infrared laser), and it should be at \
least twice the highest harmonic of interest. The total duration is ",
 Cell[BoxData[
  FormBox["TotalCycles", TraditionalForm]]],
 " cycles. ",
 "CarrierFrequency",
 " is the frequency of the fundamental laser, in atomic units."
}], "Text"]
}, Closed]],

Cell[CellGroupData[{

Cell["harmonicOrderAxis", "Subsection"],

Cell[TextData[{
 "harmonicOrderAxis produces a list that can be used as a harmonic order axis \
for the given pulse parameters. \n\nThe length can be fine-tuned (to match \
exactly a spectrum, for instance, and get a matrix of the correct shape) \
using the ",
 Cell[BoxData[
  FormBox["correction", TraditionalForm]]],
 " option, or a TargetLength can be directly specified."
}], "Text",
 CellChangeTimes->{}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"harmonicOrderAxis", "::", "usage"}], "=", 
   "\"\<harmonicOrderAxis[opt\[Rule]value] returns a list of frequencies \
which can be used as a frequency axis for Fourier transforms, scaled in units \
of harmonic order, for the provided field duration and sampling \
options.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TargetLength", "::", "usage"}], "=", 
   "\"\<TargetLength is an option for harmonicOrderAxis which specifies the \
total length required of the resulting list.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LengthCorrection", "::", "usage"}], "=", 
   "\"\<LengthCorrection is an option for harmonicOrderAxis which allows for \
manual correction of the length of the resulting list.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", 
   RowBox[{"LengthCorrection", ",", "TargetLength"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "harmonicOrderAxis", "]"}], "=", 
   RowBox[{"standardOptions", "~", "Join", "~", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"TargetLength", "\[Rule]", "Automatic"}], ",", 
      RowBox[{"LengthCorrection", "\[Rule]", "1"}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"harmonicOrderAxis", "::", "target"}], "=", 
   "\"\<Invalid TargetLength option `1`. This must be a positive integer or \
Automatic.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"harmonicOrderAxis", "[", 
   RowBox[{"OptionsPattern", "[", "]"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"num", "=", 
       RowBox[{"OptionValue", "[", "TotalCycles", "]"}]}], ",", 
      RowBox[{"npp", "=", 
       RowBox[{"OptionValue", "[", "PointsPerCycle", "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Piecewise", "[", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           FractionBox["1", "num"], 
           RowBox[{"Range", "[", 
            RowBox[{"0.", ",", 
             RowBox[{
              RowBox[{"Round", "[", 
               FractionBox[
                RowBox[{
                 RowBox[{"npp", " ", "num"}], "+", "1"}], "2."], "]"}], "-", 
              "1", "+", 
              RowBox[{"OptionValue", "[", "LengthCorrection", "]"}]}]}], 
            "]"}]}], ",", 
          RowBox[{
           RowBox[{"OptionValue", "[", "TargetLength", "]"}], "===", 
           "Automatic"}]}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           FractionBox[
            RowBox[{"Round", "[", 
             FractionBox[
              RowBox[{
               RowBox[{"npp", " ", "num"}], "+", "1"}], "2."], "]"}], "num"], 
           
           FractionBox[
            RowBox[{"Range", "[", 
             RowBox[{"0", ",", 
              RowBox[{
               RowBox[{"OptionValue", "[", "TargetLength", "]"}], "-", 
               "1"}]}], "]"}], 
            RowBox[{"OptionValue", "[", "TargetLength", "]"}]]}], ",", 
          RowBox[{
           RowBox[{"IntegerQ", "[", 
            RowBox[{"OptionValue", "[", "TargetLength", "]"}], "]"}], "&&", 
           RowBox[{
            RowBox[{"OptionValue", "[", "TargetLength", "]"}], 
            "\[GreaterEqual]", "0"}]}]}], "}"}]}], "\[IndentingNewLine]", 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"harmonicOrderAxis", "::", "target"}], ",", 
         RowBox[{"OptionValue", "[", "\"\<TargetLength\>\"", "]"}]}], "]"}], 
       ";", 
       RowBox[{"Abort", "[", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["frequencyAxis", "Subsection"],

Cell["\<\
frequencyAxis produces a list that can be used as a harmonic order axis for \
the given pulse parameters. Identical to harmonicOrderAxis but produces a \
frequency axis (in atomic units) instead.\
\>", "Text"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"frequencyAxis", "::", "usage"}], "=", 
   "\"\<frequencyAxis[opt\[Rule]value] returns a list of frequencies which \
can be used as a frequency axis for Fourier transforms, in atomic units of \
frequency, for the provided field duration and sampling options.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "frequencyAxis", "]"}], "=", 
   RowBox[{"Options", "[", "harmonicOrderAxis", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"frequencyAxis", "[", 
   RowBox[{"options", ":", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"OptionValue", "[", "CarrierFrequency", "]"}], 
   RowBox[{
   "harmonicOrderAxis", "[", "options", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["timeAxis", "Subsection"],

Cell["\<\
timeAxis produces a list that can be used as a time axis for the given pulse \
parameters.\
\>", "Text",
 CellChangeTimes->{}],

Cell[BoxData["Quit"], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"timeAxis", "::", "usage"}], "=", 
   "\"\<timeAxis[opt\[Rule]value] returns a list of times which can be used \
as a time axis \>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TimeScale", "::", "usage"}], "=", 
   "\"\<TimeScale is an option for timeAxis which specifies the units the \
list should use: AtomicUnits by default, or LaserPeriods if required.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AtomicUnits", "::", "usage"}], "=", 
   "\"\<AtomicUnits is a value for the option TimeScale of timeAxis which \
specifies that the times should be in atomic units of time.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LaserPeriods", "::", "usage"}], "=", 
   "\"\<LaserPeriods is a value for the option TimeScale of timeAxis which \
specifies that the times should be in multiples of the carrier laser \
period.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", 
   RowBox[{"TimeScale", ",", "AtomicUnits", ",", "LaserPeriods"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "timeAxis", "]"}], "=", 
   RowBox[{"standardOptions", "~", "Join", "~", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"TimeScale", "\[Rule]", "AtomicUnits"}], ",", 
      RowBox[{"PointNumberCorrection", "\[Rule]", "0"}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"timeAxis", "::", "scale"}], "=", 
   "\"\<Invalid TimeScale option `1`. Available values are AtomicUnits and \
LaserPeriods\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"timeAxis", "[", 
   RowBox[{"OptionsPattern", "[", "]"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"T", "=", 
       RowBox[{"2", 
        RowBox[{"\[Pi]", "/", "\[Omega]"}]}]}], ",", 
      RowBox[{"\[Omega]", "=", 
       RowBox[{"OptionValue", "[", "CarrierFrequency", "]"}]}], ",", 
      RowBox[{"num", "=", 
       RowBox[{"OptionValue", "[", "TotalCycles", "]"}]}], ",", 
      RowBox[{"npp", "=", 
       RowBox[{"OptionValue", "[", "PointsPerCycle", "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Piecewise", "[", 
      RowBox[{
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", 
           RowBox[{
            RowBox[{"OptionValue", "[", "TimeScale", "]"}], "===", 
            "AtomicUnits"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           FractionBox["1", "T"], ",", 
           RowBox[{
            RowBox[{"OptionValue", "[", "TimeScale", "]"}], "===", 
            "LaserPeriods"}]}], "}"}]}], "\[IndentingNewLine]", "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"timeAxis", "::", "scale"}], ",", 
          RowBox[{"OptionValue", "[", "TimeScale", "]"}]}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "\[IndentingNewLine]", "]"}], 
     "\[Times]", 
     RowBox[{"Table", "[", 
      RowBox[{"t", "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"t", ",", "0", ",", 
         RowBox[{"num", 
          FractionBox[
           RowBox[{"2", "\[Pi]"}], "\[Omega]"]}], ",", 
         RowBox[{
          FractionBox["num", 
           RowBox[{
            RowBox[{"num", "\[Times]", "npp"}], "+", 
            RowBox[{"OptionValue", "[", "PointNumberCorrection", "]"}]}]], 
          FractionBox[
           RowBox[{"2", "\[Pi]"}], "\[Omega]"]}]}], "}"}]}], 
      "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"tInit", "=", "0"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tFinal", "=", 
     RowBox[{
      FractionBox[
       RowBox[{"2", "\[Pi]"}], "\[Omega]"], " ", "num"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Delta]t", "=", 
     FractionBox[
      RowBox[{"tFinal", "-", "tInit"}], 
      RowBox[{
       RowBox[{"num", "\[Times]", "npp"}], "+", 
       RowBox[{"OptionValue", "[", "PointNumberCorrection", "]"}]}]]}], ";"}], 
   RowBox[{"(*", 
    RowBox[{"integration", " ", "and", " ", "looping", " ", "timestep"}], 
    "*)"}]}]}]], "Input"]
}, Closed]],

Cell[CellGroupData[{

Cell["getSpectrum", "Subsection"],

Cell[TextData[{
 "getSpectrum takes a time-dependent dipole list and returns its Fourier \
transform in absolute-value-squared. It takes as options\n  ",
 StyleBox["\[CenterDot]",
  FontWeight->"Bold"],
 " pulse parameters \[Omega], TotalCycles and PointsPerCycle,\n  ",
 StyleBox["\[CenterDot]",
  FontWeight->"Bold"],
 " a polarization parameter \[Epsilon], which gives an unpolarized spectrum \
when given False, or polarizes along an ellipticity vector \[Epsilon] (this \
is meant primarily to select right- and left-circularly polarized spectra \
using ",
 Cell[BoxData[
  FormBox[
   RowBox[{"\[Epsilon]", "=", 
    RowBox[{"{", 
     RowBox[{"1", ",", "\[ImaginaryI]"}], "}"}]}], TraditionalForm]]],
 " and ",
 Cell[BoxData[
  FormBox[
   RowBox[{"\[Epsilon]", "=", 
    RowBox[{"{", 
     RowBox[{"1", ",", 
      RowBox[{"-", "\[ImaginaryI]"}]}], "}"}]}], TraditionalForm]]],
 " respectively),\n  ",
 StyleBox["\[CenterDot]",
  FontWeight->"Bold"],
 " a DifferentiationOrder, which can return the dipole value (default,",
 Cell[BoxData[
  FormBox[
   RowBox[{"=", "0"}], TraditionalForm]]],
 "), velocity (",
 Cell[BoxData[
  FormBox[
   RowBox[{"=", "1"}], TraditionalForm]]],
 "), or acceleration (",
 Cell[BoxData[
  FormBox[
   RowBox[{"=", "2"}], TraditionalForm]]],
 "), \n  \[CenterDot] a power of \[Omega], \[Omega]Power, with which to \
multiply the spectrum before returning it (which should be equivalent to \
DifferentiationOrder except for pathological cases), and\n  \[CenterDot] a \
ComplexPart function to apply immediately after differentiation (default is \
the identity function, but Re, Im, or ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SuperscriptBox[
     RowBox[{"Abs", "[", "#", "]"}], "2"], "&"}], TraditionalForm]]],
 " are reasonable choices).\nIf no option is passed to ",
 Cell[BoxData[
  FormBox["\[Omega]Power", TraditionalForm]]],
 " and DifferentiationOrder, the pulse parameters do not really affect the \
output, except by a global factor of ",
 "TotalCycles",
 "."
}], "Text"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"getSpectrum", "::", "usage"}], "=", 
   "\"\<getSpectrum[DipoleList] returns the power spectrum of \
DipoleList.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Polarization", "::", "usage"}], "=", 
   "\"\<Polarization is an option for getSpectrum which specifies a \
polarization vector along which to polarize the dipole list. The default, \
Polarization\[Rule]False, specifies an unpolarized spectrum.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ComplexPart", "::", "usage"}], "=", 
   "\"\<part is an option for getSpectrum which specifies a function (like \
Re, Im, or by default #&) which should be applied to the dipole list before \
the spectrum is taken.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Omega]Power", "::", "usage"}], "=", 
   "\"\<\[Omega]Power is an option for getSpectrum which specifies a power of \
frequency which should multiply the spectrum.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DifferentiationOrder", "::", "usage"}], "=", 
   "\"\<DifferentiationOrder is an option for getSpectrum which specifies the \
order to which the dipole list should be differentiated before the spectrum \
is taken.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Protect", "[", 
    RowBox[{
    "Polarization", ",", "part", ",", "\[Omega]Power", ",", 
     "DifferentiationOrder"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "getSpectrum", "]"}], "=", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Polarization", "\[Rule]", "False"}], ",", 
       RowBox[{"ComplexPart", "\[Rule]", 
        RowBox[{"(", 
         RowBox[{"#", "&"}], ")"}]}], ",", 
       RowBox[{"\[Omega]Power", "\[Rule]", "0"}], ",", 
       RowBox[{"DifferentiationOrder", "\[Rule]", "0"}]}], "}"}], "~", "Join",
      "~", "standardOptions"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"getSpectrum", "::", "diffOrd"}], "=", 
   "\"\<Invalid differentiation order `1`.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"getSpectrum", "::", "\[Omega]Pow"}], "=", 
    "\"\<Invalid \[Omega] power `1`.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"getSpectrum", "[", 
   RowBox[{"dipoleList_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "polarizationVector", ",", "differentiatedList", ",", "depth", ",", 
      "dimensions", ",", "\[IndentingNewLine]", 
      RowBox[{"num", "=", 
       RowBox[{"OptionValue", "[", "TotalCycles", "]"}]}], ",", 
      RowBox[{"npp", "=", 
       RowBox[{"OptionValue", "[", "PointsPerCycle", "]"}]}], ",", 
      RowBox[{"\[Omega]", "=", 
       RowBox[{"OptionValue", "[", "CarrierFrequency", "]"}]}], ",", 
      RowBox[{"\[Delta]t", "=", 
       FractionBox[
        RowBox[{"2", 
         RowBox[{"\[Pi]", "/", "\[Omega]"}]}], "npp"]}]}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"polarizationVector", "=", 
      FractionBox[
       RowBox[{"OptionValue", "[", "Polarization", "]"}], 
       RowBox[{"Norm", "[", 
        RowBox[{"OptionValue", "[", "Polarization", "]"}], "]"}]]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"differentiatedList", "=", 
      RowBox[{
       RowBox[{"OptionValue", "[", "ComplexPart", "]"}], "[", 
       RowBox[{"Piecewise", "[", 
        RowBox[{
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"dipoleList", ",", 
             RowBox[{
              RowBox[{"OptionValue", "[", "DifferentiationOrder", "]"}], 
              "\[Equal]", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              FractionBox["1", 
               RowBox[{"2", "\[Delta]t"}]], 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Most", "[", 
                 RowBox[{"Most", "[", "dipoleList", "]"}], "]"}], "-", 
                RowBox[{"Rest", "[", 
                 RowBox[{"Rest", "[", "dipoleList", "]"}], "]"}]}], ")"}]}], 
             ",", 
             RowBox[{
              RowBox[{"OptionValue", "[", "DifferentiationOrder", "]"}], 
              "\[Equal]", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              FractionBox["1", 
               SuperscriptBox["\[Delta]t", "2"]], 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Most", "[", 
                 RowBox[{"Most", "[", "dipoleList", "]"}], "]"}], "-", 
                RowBox[{"2", 
                 RowBox[{"Most", "[", 
                  RowBox[{"Rest", "[", "dipoleList", "]"}], "]"}]}], "+", 
                RowBox[{"Rest", "[", 
                 RowBox[{"Rest", "[", "dipoleList", "]"}], "]"}]}], ")"}]}], 
             ",", 
             RowBox[{
              RowBox[{"OptionValue", "[", "DifferentiationOrder", "]"}], 
              "\[Equal]", "2"}]}], "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"getSpectrum", "::", "diffOrd"}], ",", 
            RowBox[{"OptionValue", "[", "DifferentiationOrder", "]"}]}], 
           "]"}], ";", 
          RowBox[{"Abort", "[", "]"}]}]}], "\[IndentingNewLine]", "]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"NumberQ", "[", 
        RowBox[{"OptionValue", "[", "\[Omega]Power", "]"}], "]"}], ",", 
       RowBox[{"Null", ";"}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"getSpectrum", "::", "\[Omega]Pow"}], ",", 
          RowBox[{"OptionValue", "[", "\[Omega]Power", "]"}]}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "  ", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"num", " ", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{
           FractionBox["\[Omega]", "num"], " ", "k"}], ")"}], 
         RowBox[{"2", 
          RowBox[{"OptionValue", "[", "\[Omega]Power", "]"}]}]], ",", 
        RowBox[{"{", 
         RowBox[{"k", ",", "1", ",", 
          RowBox[{"Round", "[", 
           FractionBox[
            RowBox[{"Length", "[", "differentiatedList", "]"}], "2"], "]"}]}],
          "}"}]}], "\[IndentingNewLine]", "]"}], "\[Times]", 
      RowBox[{"If", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"OptionValue", "[", "Polarization", "]"}], "===", "False"}], 
        ",", 
        RowBox[{"(*", 
         RowBox[{"unpolarized", " ", "spectrum"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "funky", " ", "depth", " ", "thing", " ", "so", " ", "this", " ", 
           "can", " ", "take", " ", "lists", " ", "of", " ", "numbers", " ", 
           "and", " ", "lists", " ", "of", " ", "vectors"}], ",", " ", 
          RowBox[{"of", " ", "arbitrary", " ", 
           RowBox[{"length", ".", " ", "Makes"}], " ", "for", " ", "easier", 
           " ", 
           RowBox[{"benchmarking", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"depth", "=", 
          RowBox[{"Length", "[", 
           RowBox[{"Dimensions", "[", "dipoleList", "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"dimensions", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "#", "]"}], ">", "1"}], ",", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              ",", "1"}], 
             RowBox[{"(*", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "*)"}], "]"}], "&"}], "[", 
           RowBox[{"Dimensions", "[", "dipoleList", "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Sum", "[", 
          RowBox[{
           SuperscriptBox[
            RowBox[{"Abs", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Fourier", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"depth", ">", "1"}], ",", 
                  RowBox[{"Re", "[", 
                   RowBox[{"differentiatedList", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "i"}], "\[RightDoubleBracket]"}], 
                   "]"}], ",", 
                  RowBox[{"Re", "[", 
                   RowBox[{
                   "differentiatedList", "\[LeftDoubleBracket]", "All", 
                    "\[RightDoubleBracket]"}], "]"}]}], "]"}], 
                "\[IndentingNewLine]", ",", 
                RowBox[{"FourierParameters", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", " ", "1"}], "}"}]}]}], 
               "\[IndentingNewLine]", "]"}], "\[LeftDoubleBracket]", 
              RowBox[{"1", ";;", 
               RowBox[{"Round", "[", 
                FractionBox[
                 RowBox[{"Length", "[", "differentiatedList", "]"}], "2"], 
                "]"}]}], "\[RightDoubleBracket]"}], "\[IndentingNewLine]", 
             "]"}], "2"], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "dimensions"}], "}"}]}], "]"}]}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"(*", 
         RowBox[{"polarized", " ", "spectrum"}], "*)"}], 
        "\[IndentingNewLine]", 
        SuperscriptBox[
         RowBox[{"Abs", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Transpose", "[", 
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Fourier", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Re", "[", 
                  RowBox[{"differentiatedList", "\[LeftDoubleBracket]", 
                   RowBox[{"All", ",", "i"}], "\[RightDoubleBracket]"}], 
                  "]"}], "\[IndentingNewLine]", ",", 
                 RowBox[{"FourierParameters", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "1"}], ",", " ", "1"}], "}"}]}]}], 
                "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", "2"}], "}"}]}], "]"}], "]"}], 
            "\[LeftDoubleBracket]", 
            RowBox[{"1", ";;", 
             RowBox[{"Round", "[", 
              RowBox[{
               RowBox[{"Length", "[", "differentiatedList", "]"}], "/", "2"}],
               "]"}]}], "\[RightDoubleBracket]"}], ".", 
           "polarizationVector"}], "\[IndentingNewLine]", "]"}], "2"]}], 
       "\[IndentingNewLine]", "]"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["spectrumPlotter", "Subsection"],

Cell["\<\
spectrumPlotter takes a spectrum and a list of options and returns a plot of \
the spectrum. The available options are
  \[CenterDot] a FrequencyAxis option, which will give the harmonic order as \
a horizontal axis by default, and an arbitrary scale with any other option,
  \[CenterDot] all the options of harmonicOrderAxis, which will be passed to \
the call that makes the horizontal axis, and
  \[CenterDot] all the options of ListLinePlot, which will be used to format \
the plot.\
\>", "Text"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"spectrumPlotter", "::", "usage"}], "=", 
   "\"\<spectrumPlotter[spectrum] plots the given spectrum with an \
appropriate axis in a \!\(\*SubscriptBox[\(log\), \(10\)]\) scale.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FrequencyAxis", "::", "usage"}], "=", 
   "\"\<FrequencyAxis is an option for spectrumPlotter which specifies the \
axis to use.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "FrequencyAxis", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "spectrumPlotter", "]"}], "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"FrequencyAxis", "\[Rule]", "\"\<HarmonicOrder\>\""}], "}"}], 
     ",", 
     RowBox[{"Options", "[", "harmonicOrderAxis", "]"}], ",", 
     RowBox[{"Options", "[", "ListLinePlot", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"spectrumPlotter", "[", 
   RowBox[{"spectrum_", ",", 
    RowBox[{"options", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Which", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "FrequencyAxis", "]"}], "===", 
          "\"\<HarmonicOrder\>\""}], ",", "\[IndentingNewLine]", 
         RowBox[{"harmonicOrderAxis", "[", 
          RowBox[{
           RowBox[{"\"\<TargetLength\>\"", "\[Rule]", 
            RowBox[{"Length", "[", "spectrum", "]"}]}], ",", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"FilterRules", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", "options", "}"}], "~", "Join", "~", 
               RowBox[{"Options", "[", "spectrumPlotter", "]"}]}], ",", 
              RowBox[{"Options", "[", "harmonicOrderAxis", "]"}]}], "]"}]}]}],
           "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"OptionValue", "[", "FrequencyAxis", "]"}], "===", 
          "\"\<Frequency\>\""}], ",", "\[IndentingNewLine]", 
         RowBox[{"frequencyAxis", "[", 
          RowBox[{
           RowBox[{"\"\<TargetLength\>\"", "\[Rule]", 
            RowBox[{"Length", "[", "spectrum", "]"}]}], ",", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"FilterRules", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", "options", "}"}], "~", "Join", "~", 
               RowBox[{"Options", "[", "spectrumPlotter", "]"}]}], ",", 
              RowBox[{"Options", "[", "harmonicOrderAxis", "]"}]}], "]"}]}]}],
           "]"}], ",", "\[IndentingNewLine]", "True", ",", 
         RowBox[{"Range", "[", 
          RowBox[{"Length", "[", "spectrum", "]"}], "]"}]}], 
        "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Log", "[", 
        RowBox[{"10", ",", "spectrum"}], "]"}]}], "\[IndentingNewLine]", 
      "}"}], "\[Transpose]"}], "\[IndentingNewLine]", ",", 
    RowBox[{"Sequence", "@@", 
     RowBox[{"FilterRules", "[", 
      RowBox[{
       RowBox[{"{", "options", "}"}], ",", 
       RowBox[{"Options", "[", "ListLinePlot", "]"}]}], "]"}]}], 
    "\[IndentingNewLine]", ",", 
    RowBox[{"Joined", "\[Rule]", "True"}], "\[IndentingNewLine]", ",", 
    RowBox[{"PlotRange", "\[Rule]", "Full"}], "\[IndentingNewLine]", ",", 
    RowBox[{"PlotStyle", "\[Rule]", "Thick"}], "\[IndentingNewLine]", ",", 
    RowBox[{"Frame", "\[Rule]", "True"}], "\[IndentingNewLine]", ",", 
    RowBox[{"Axes", "\[Rule]", "False"}], "\[IndentingNewLine]", ",", 
    RowBox[{"ImageSize", "\[Rule]", "800"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["biColorSpectrum", "Subsection"],

Cell["\<\
biColorSpectrum takes a time-dependent dipole list and produces overlaid \
plots of the right- and left-circular components of the spectrum, in red and \
blue respectively. It takes all the options of getSpectrum and \
spectrumPlotter, which are passed directly to the corresponding calls, as \
well as the options of Show, which can be used to modify the plot appearance.\
\
\>", "Text",
 CellChangeTimes->{}],

Cell[BoxData["Quit"], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"biColorSpectrum", "::", "usage"}], "=", 
   "\"\<biColorSpectrum[DipoleList] produces a two-colour spectrum of \
DipoleList, separating the two circular polarizations.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "biColorSpectrum", "]"}], "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"PlotRange", "\[Rule]", "All"}], "}"}], ",", 
     RowBox[{"Options", "[", "Show", "]"}], ",", 
     RowBox[{"Options", "[", "spectrumPlotter", "]"}], ",", 
     RowBox[{"DeleteCases", "[", 
      RowBox[{
       RowBox[{"Options", "[", "getSpectrum", "]"}], ",", 
       RowBox[{"Polarization", "\[Rule]", "False"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"biColorSpectrum", "[", 
   RowBox[{"dipoleList_", ",", 
    RowBox[{"options", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"Show", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"spectrumPlotter", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"getSpectrum", "[", 
         RowBox[{"dipoleList", ",", 
          RowBox[{"Polarization", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"1", ",", 
             RowBox[{"+", "\[ImaginaryI]"}]}], "}"}]}], ",", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"FilterRules", "[", 
            RowBox[{
             RowBox[{"{", "options", "}"}], ",", 
             RowBox[{"Options", "[", "getSpectrum", "]"}]}], "]"}]}]}], "]"}],
         ",", "\[IndentingNewLine]", 
        RowBox[{"PlotStyle", "\[Rule]", "Red"}], ",", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"{", "options", "}"}], ",", 
           RowBox[{"Options", "[", "spectrumPlotter", "]"}]}], "]"}]}]}], 
       "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"spectrumPlotter", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"getSpectrum", "[", 
         RowBox[{"dipoleList", ",", 
          RowBox[{"Polarization", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"1", ",", 
             RowBox[{"-", "\[ImaginaryI]"}]}], "}"}]}], ",", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"FilterRules", "[", 
            RowBox[{
             RowBox[{"{", "options", "}"}], ",", 
             RowBox[{"Options", "[", "getSpectrum", "]"}]}], "]"}]}]}], "]"}],
         ",", "\[IndentingNewLine]", 
        RowBox[{"PlotStyle", "\[Rule]", "Blue"}], ",", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"{", "options", "}"}], ",", 
           RowBox[{"Options", "[", "spectrumPlotter", "]"}]}], "]"}]}]}], 
       "]"}]}], "\[IndentingNewLine]", "}"}], "\[IndentingNewLine]", ",", 
    RowBox[{"PlotRange", "\[Rule]", 
     RowBox[{"OptionValue", "[", "PlotRange", "]"}]}], "\[IndentingNewLine]", 
    ",", 
    RowBox[{"Sequence", "@@", 
     RowBox[{"FilterRules", "[", 
      RowBox[{
       RowBox[{"{", "options", "}"}], ",", 
       RowBox[{"Options", "[", "Show", "]"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["Various gate functions", "Subsection"],

Cell[TextData[{
 "Gate functions are used to suppress the contributions of extra-long \
trajectories with long excursion times, partly to reflect the effect of phase \
matching but mostly to keep integration times reasonable. They are provided \
to the main numerical integrator ",
 StyleBox["makeDipoleList", "Code"],
 " via its ",
 StyleBox["Gate", "Code"],
 " option."
}], "Text"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SineSquaredGate", "::", "usage"}], "=", 
   "\"\<SineSquaredGate[nGateRamp] specifies an integration gate with a \
sine-squared ramp, such that SineSquaredGate[nGateRamp][\[Omega]t,nGate] has \
nGate flat periods and nGateRamp ramp periods.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LinearRampGate", "::", "usage"}], "=", 
   "\"\<LinearRampGate[nGateRamp] specifies an integration gate with a linear \
ramp, such that SineSquaredGate[nGateRamp][\[Omega]t,nGate] has nGate flat \
periods and nGateRamp ramp periods.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SineSquaredGate", "[", "nGateRamp_", "]"}], "[", 
   RowBox[{"\[Omega]\[Tau]_", ",", "nGate_"}], "]"}], ":=", 
  RowBox[{"Piecewise", "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", 
       RowBox[{"\[Omega]\[Tau]", "\[LessEqual]", 
        RowBox[{"2", "\[Pi]", " ", 
         RowBox[{"(", 
          RowBox[{"nGate", "-", "nGateRamp"}], ")"}]}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"Sin", "[", 
         FractionBox[
          RowBox[{
           RowBox[{"2", "\[Pi]", " ", "nGate"}], "-", "\[Omega]\[Tau]"}], 
          RowBox[{"4", "nGateRamp"}]], "]"}], "2"], ",", 
       RowBox[{
        RowBox[{"2", "\[Pi]", " ", 
         RowBox[{"(", 
          RowBox[{"nGate", "-", "nGateRamp"}], ")"}]}], "<", "\[Omega]\[Tau]",
         "\[LessEqual]", 
        RowBox[{"2", "\[Pi]", " ", "nGate"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", 
       RowBox[{"nGate", "<", "\[Omega]\[Tau]"}]}], "}"}]}], "}"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LinearRampGate", "[", "nGateRamp_", "]"}], "[", 
   RowBox[{"\[Omega]\[Tau]_", ",", "nGate_"}], "]"}], ":=", 
  RowBox[{"Piecewise", "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", 
       RowBox[{"\[Omega]\[Tau]", "\[LessEqual]", 
        RowBox[{"2", "\[Pi]", " ", 
         RowBox[{"(", 
          RowBox[{"nGate", "-", "nGateRamp"}], ")"}]}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", 
        FractionBox[
         RowBox[{"\[Omega]\[Tau]", "-", 
          RowBox[{"2", "\[Pi]", " ", 
           RowBox[{"(", 
            RowBox[{"nGate", "+", "nGateRamp"}], ")"}]}]}], 
         RowBox[{"2", "\[Pi]", " ", "nGateRamp"}]]}], ",", 
       RowBox[{
        RowBox[{"2", "\[Pi]", " ", 
         RowBox[{"(", 
          RowBox[{"nGate", "-", "nGateRamp"}], ")"}]}], "<", "\[Omega]\[Tau]",
         "\[LessEqual]", 
        RowBox[{"2", "\[Pi]", " ", "nGate"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", 
       RowBox[{"nGate", "<", "\[Omega]\[Tau]"}]}], "}"}]}], "}"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["getIonizationPotential", "Subsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"getIonizationPotential", "::", "usage"}], "=", 
   "\"\<getIonizationPotential[Target] returns the ionization potential of an \
atomic target, e.g. \\\"Hydrogen\\\", in atomic units.\[IndentingNewLine]\n\
getIonizationPotential[Target,q] returns the ionization potential of the q-th \
ion of the specified Target, in atomic units.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"getIonizationPotential", "[", 
   RowBox[{"Target_", ",", 
    RowBox[{"Charge_:", "0"}]}], "]"}], ":=", 
  RowBox[{"UnitConvert", "[", 
   FractionBox[
    RowBox[{
     RowBox[{"ElementData", "[", 
      RowBox[{"Target", ",", "\"\<IonizationEnergies\>\""}], "]"}], 
     "\[LeftDoubleBracket]", 
     RowBox[{"Charge", "+", "1"}], "\[RightDoubleBracket]"}], 
    RowBox[{
     RowBox[{"Quantity", "[", 
      RowBox[{"1", ",", "\"\<AvogadroConstant\>\""}], "]"}], 
     RowBox[{"Quantity", "[", 
      RowBox[{"1", ",", "\"\<Hartrees\>\""}], "]"}]}]], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Implementation: main integrator function", "Section"],

Cell[TextData[{
 "The main integration function is ",
 StyleBox["makeDipoleList", "Code"],
 ",  and its basic syntax is of the form ",
 StyleBox["makeDipoleList[VectorPotential\[Rule]A]", "Code"],
 ". Here the vector potential A must be a function object, such that for \
numeric ",
 StyleBox[" t ", "Code"],
 " the construct ",
 StyleBox["A[t]", "Code"],
 " returns a list of numbers after the appropriate field parameters have been \
introduced: thus the criterion is that, for a call of the form ",
 StyleBox["makeDipoleList[VectorPotential\[Rule]A, \
FieldParameters\[Rule]pars]", "Code"],
 ", a call of the form ",
 StyleBox["A[t]//.pars", "Code"],
 " returns a list of numbers for numeric ",
 StyleBox[" t ", "Code"],
 ". To see the available options use ",
 StyleBox["Options[makeDipoleList]", "Code"],
 ", and to get information on each option use the ",
 StyleBox["?VectorPotential", "Code"],
 " construct."
}], "Text"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"makeDipoleList", "::", "usage"}], "=", 
    "\"\<makeDipoleList[VectorPotential\[Rule]A] calculates the dipole \
response to the vector potential A.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"VectorPotential", "::", "usage"}], "=", 
   "\"\<VectorPotential is an option for makeDipole list which specifies the \
field's vector potential. Usage should be VectorPotential\[Rule]A, where \
A[t]//.pars must yield a list of numbers for numeric t and parameters \
indicated by FieldParameters\[Rule]pars.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"VectorPotentialGradient", "::", "usage"}], "=", 
   "\"\<VectorPotentialGradient is an option for makeDipole list which \
specifies the gradient of the field's vector potential. Usage should be \
VectorPotentialGradient\[Rule]GA, where GA[t]//.pars must yield a square \
matrix of the same dimension as the vector potential for numeric t and \
parameters indicated by FieldParameters\[Rule]pars. The indices must be such \
that GA[t]\[LeftDoubleBracket]i,j\[RightDoubleBracket] returns \
\!\(\*SubscriptBox[\(\[PartialD]\), \(i\)]\)\!\(\*SubscriptBox[\(A\), \
\(j\)]\)[t].\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FieldParameters", "::", "usage"}], "=", 
   "\"\<FieldParameters is an option for makeDipole list which \>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Preintegrals", "::", "usage"}], "=", 
   "\"\<Preintegrals is an option for makeDipole list which specifies whether \
the preintegrals of the vector potential should be \\\"Analytic\\\" or \
\\\"Numeric\\\".\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReportingFunction", "::", "usage"}], "=", 
   "\"\<ReportingFunction is an option for makeDipole list which specifies a \
function used to report the results, either internally (by the default, \
Identity) or to an external file.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Gate", "::", "usage"}], "=", 
   "\"\<Gate is an option for makeDipole list which specifies the integration \
gate to use. Usage as Gate\[Rule]g, nGate\[Rule]n will gate the integral at \
time \[Omega]t/\[Omega] by g[\[Omega]t,n]. The default is \
Gate\[Rule]SineSquaredGate[1/2].\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"nGate", "::", "usage"}], "=", 
   "\"\<nGate is an option for makeDipole list which specifies the total \
number of cycles in the integration gate.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IonizationPotential", "::", "usage"}], "=", 
   "\"\<IonizationPotential is an option for makeDipoleList which specifies \
the ionization potential \!\(\*SubscriptBox[\(I\), \(p\)]\) of the \
target.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Target", "::", "usage"}], "=", 
   "\"\<Target is an option for makeDipoleList which specifies chemical \
species producing the HHG emission, pulling the ionization potential from the \
Wolfram ElementData curated data set.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DipoleTransitionMatrixElement", "::", "usage"}], "=", 
   "\"\<DipoleTransitionMatrixElement is an option for makeDipoleList which \
specifies a function f, of the form f[p,\[Kappa]]=f[p,\!\(\*SqrtBox[
RowBox[{\"2\", SubscriptBox[
StyleBox[\"I\",
FontSlant->\"Italic\"], \"p\"]}]]\)], to use as the dipole transition matrix \
element.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Epsilon]Correction", "::", "usage"}], "=", 
   "\"\<\[Epsilon]Correction is an option for makeDipoleList which specifies \
the regularization correction \[Epsilon], i.e. as used in the factor \
\!\(\*FractionBox[\(1\), SuperscriptBox[\((t - tt + \[ImaginaryI]\\\ \
\[Epsilon])\), \(3/2\)]]\).\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PointNumberCorrection", "::", "usage"}], "=", 
    "\"\<PointNumberCorrection is an option for makeDipoleList and timeAxis \
which specifies an extra number of points to be integrated over, which is \
useful to prevent Indeterminate errors when a Piecewise envelope is being \
differentiated at the boundaries.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IntegrationPointsPerCycle", "::", "usage"}], "=", 
    "\"\<IntegrationPointsPerCycle is an option for makeDipoleList which \
controls the number of points per cycle to use for the integration. Set to \
Automatic, to follow PointsPerCycle, or to an integer.\>\""}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Protect", "[", 
    RowBox[{
    "VectorPotential", ",", "VectorPotentialGradient", ",", "FieldParameters",
      ",", "Preintegrals", ",", "ReportingFunction", ",", "Gate", ",", 
     "IonizationPotential", ",", "Target", ",", "nGate", ",", 
     "\[Epsilon]Correction"}], "]"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "makeDipoleList", "]"}], "=", 
   RowBox[{"standardOptions", "~", "Join", "~", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"VectorPotential", "\[Rule]", "Automatic"}], ",", 
      RowBox[{"FieldParameters", "\[Rule]", 
       RowBox[{"{", "}"}]}], ",", 
      RowBox[{"VectorPotentialGradient", "\[Rule]", "None"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Preintegrals", "\[Rule]", "\"\<Analytic\>\""}], ",", 
      RowBox[{"ReportingFunction", "\[Rule]", "Identity"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Gate", "\[Rule]", 
       RowBox[{"SineSquaredGate", "[", 
        RowBox[{"1", "/", "2"}], "]"}]}], ",", 
      RowBox[{"nGate", "\[Rule]", 
       RowBox[{"3", "/", "2"}]}], ",", 
      RowBox[{"\[Epsilon]Correction", "\[Rule]", "0.1"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"IonizationPotential", "\[Rule]", "0.5"}], ",", 
      RowBox[{"Target", "\[Rule]", "Automatic"}], ",", 
      RowBox[{"DipoleTransitionMatrixElement", "\[Rule]", "hydrogenicDTME"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{"PointNumberCorrection", "\[Rule]", "0"}], ",", 
      RowBox[{"Verbose", "\[Rule]", "0"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", ",", 
      RowBox[{"IntegrationPointsPerCycle", "\[Rule]", "Automatic"}]}], 
     "\[IndentingNewLine]", "}"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makeDipoleList", "::", "gate"}], "=", 
   "\"\<The integration gate g provided as Gate\[Rule]`1` is incorrect. Its \
usage as g[`2`,`3`] returns `4` and should return a number.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makeDipoleList", "::", "pot"}], "=", 
   "\"\<The vector potential A provided as VectorPotential\[Rule]`1` is \
incorrect or is missing FieldParameters. Its usage as A[`2`] returns `3` and \
should return a list of numbers.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makeDipoleList", "::", "gradpot"}], "=", 
   "\"\<The vector potential GA provided as VectorPotentialGradient\[Rule]`1` \
is incorrect or is missing FieldParameters. Its usage as GA[`2`] returns `3` \
and should return a square matrix of numbers. Alternatively, use \
VectorPotentialGradient\[Rule]None.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"makeDipoleList", "::", "preint"}], "=", 
    "\"\<Wrong Preintegrals option `1`. Valid options are \\\"Analytic\\\" \
and \\\"Numeric\\\".\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"makeDipoleList", "::", "numnondip"}], "=", 
    "\"\<The option Preintegrals\[Rule]\\\"Numeric\\\" is currently \
unreliable when a vector potential is specified.\>\""}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"makeDipoleList", "[", 
   RowBox[{"OptionsPattern", "[", "]"}], "]"}], ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"num", "=", 
       RowBox[{"OptionValue", "[", "TotalCycles", "]"}]}], ",", 
      RowBox[{"npp", "=", 
       RowBox[{"OptionValue", "[", "PointsPerCycle", "]"}]}], ",", 
      RowBox[{"\[Omega]", "=", 
       RowBox[{"OptionValue", "[", "CarrierFrequency", "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"dipole", "=", 
       RowBox[{"OptionValue", "[", "DipoleTransitionMatrixElement", "]"}]}], 
      ",", "\[Kappa]", ",", "\[IndentingNewLine]", "A", ",", "F", ",", "GA", 
      ",", "pi", ",", "ps", ",", "S", ",", "\[IndentingNewLine]", "gate", ",",
       "tGate", ",", "setPreintegral", ",", "\[IndentingNewLine]", "tInit", 
      ",", "tFinal", ",", "\[Delta]t", ",", "\[Delta]tint", ",", 
      RowBox[{"\[Epsilon]", "=", 
       RowBox[{"OptionValue", "[", "\[Epsilon]Correction", "]"}]}], ",", 
      "\[IndentingNewLine]", "AInt", ",", "A2Int", ",", "GAInt", ",", 
      "GAdotAInt", ",", "AdotGAInt", ",", "GAIntInt", ",", 
      "bigPScorrectionInt", ",", "AdotGAdotAInt", ",", "\[IndentingNewLine]", 
      "AIntList", ",", "A2IntList", ",", "GAIntList", ",", "GAdotAIntList", 
      ",", "AdotGAIntList", ",", "GAIntIntList", ",", 
      "bigPScorrectionIntList", ",", "AdotGAdotAIntList", ",", 
      "\[IndentingNewLine]", "integrand", ",", "dipoleList"}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"A", "[", "t_", "]"}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{"OptionValue", "[", "VectorPotential", "]"}], "[", "t", "]"}],
        "//.", 
       RowBox[{"OptionValue", "[", "FieldParameters", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"F", "[", "t_", "]"}], "=", 
      RowBox[{"-", 
       RowBox[{"D", "[", 
        RowBox[{
         RowBox[{"A", "[", "t", "]"}], ",", "t"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"GA", "[", "t_", "]"}], "=", 
      RowBox[{"If", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"TrueQ", "[", 
         RowBox[{
          RowBox[{"OptionValue", "[", "VectorPotentialGradient", "]"}], 
          "\[Equal]", "None"}], "]"}], ",", "        ", 
        RowBox[{"Table", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{"Length", "[", 
            RowBox[{"A", "[", "tInit", "]"}], "]"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"Length", "[", 
            RowBox[{"A", "[", "tInit", "]"}], "]"}], "}"}]}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "VectorPotentialGradient", "]"}], "[", 
          "t", "]"}], "//.", 
         RowBox[{"OptionValue", "[", "FieldParameters", "]"}]}]}], 
       "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Which", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"OptionValue", "[", "Target", "]"}], "===", "Automatic"}], 
       ",", 
       RowBox[{"\[Kappa]", "=", 
        SqrtBox[
         RowBox[{"2", 
          RowBox[{"OptionValue", "[", "IonizationPotential", "]"}]}]]}], ",", 
       "\[IndentingNewLine]", "True", ",", 
       RowBox[{"\[Kappa]", "=", 
        SqrtBox[
         RowBox[{"2", 
          RowBox[{"getIonizationPotential", "[", 
           RowBox[{"OptionValue", "[", "Target", "]"}], "]"}]}]]}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"tInit", "=", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{"tFinal", "=", 
      RowBox[{
       FractionBox[
        RowBox[{"2", "\[Pi]"}], "\[Omega]"], " ", "num"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"looping", " ", "timestep"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"\[Delta]t", "=", 
      FractionBox[
       RowBox[{"tFinal", "-", "tInit"}], 
       RowBox[{
        RowBox[{"num", "\[Times]", "npp"}], "+", 
        RowBox[{"OptionValue", "[", "PointNumberCorrection", "]"}]}]]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"integration", " ", "timestep"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"\[Delta]tint", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"OptionValue", "[", "IntegrationPointsPerCycle", "]"}], "===",
          "Automatic"}], ",", "\[Delta]t", ",", 
        FractionBox[
         RowBox[{"tFinal", "-", "tInit"}], 
         RowBox[{
          RowBox[{"num", "\[Times]", 
           RowBox[{"OptionValue", "[", "IntegrationPointsPerCycle", "]"}]}], 
          "+", 
          RowBox[{"OptionValue", "[", "PointNumberCorrection", "]"}]}]]}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"tGate", "=", 
      RowBox[{
       RowBox[{"OptionValue", "[", "nGate", "]"}], 
       FractionBox[
        RowBox[{"2", "\[Pi]"}], "\[Omega]"]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Check", " ", "potential", " ", "and", " ", "potential", " ", 
       "gradient", " ", "for", " ", 
       RowBox[{"correctness", "."}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]tRandom", "=", 
         RowBox[{"RandomReal", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"\[Omega]", " ", "tInit"}], ",", 
            RowBox[{"\[Omega]", " ", "tFinal"}]}], "}"}], "]"}]}], "}"}], ",",
        "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"And", "@@", 
            RowBox[{"(", 
             RowBox[{"NumberQ", "/@", 
              RowBox[{"A", "[", 
               RowBox[{"\[Omega]tRandom", "/", "\[Omega]"}], "]"}]}], 
             ")"}]}]}], ",", 
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{
             RowBox[{"makeDipoleList", "::", "pot"}], ",", 
             RowBox[{"OptionValue", "[", "VectorPotential", "]"}], ",", 
             "\[Omega]tRandom", ",", 
             RowBox[{"A", "[", "\[Omega]tRandom", "]"}]}], "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"And", "@@", 
            RowBox[{"(", 
             RowBox[{"NumberQ", "/@", 
              RowBox[{"Flatten", "[", 
               RowBox[{"GA", "[", 
                RowBox[{"\[Omega]tRandom", "/", "\[Omega]"}], "]"}], "]"}]}], 
             ")"}]}]}], ",", 
          RowBox[{
           RowBox[{"Message", "[", 
            RowBox[{
             RowBox[{"makeDipoleList", "::", "gradpot"}], ",", 
             RowBox[{"OptionValue", "[", "VectorPotentialGradient", "]"}], 
             ",", "\[Omega]tRandom", ",", 
             RowBox[{"GA", "[", "\[Omega]tRandom", "]"}]}], "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"gate", "[", "\[Omega]\[Tau]_", "]"}], ":=", 
      RowBox[{
       RowBox[{"OptionValue", "[", "Gate", "]"}], "[", 
       RowBox[{"\[Omega]\[Tau]", ",", 
        RowBox[{"OptionValue", "[", "nGate", "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]tRandom", "=", 
         RowBox[{"RandomReal", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"\[Omega]", " ", "tInit"}], ",", 
            RowBox[{"\[Omega]", " ", "tFinal"}]}], "}"}], "]"}]}], "}"}], ",",
        "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"!", 
          RowBox[{"TrueQ", "[", 
           RowBox[{"NumberQ", "[", 
            RowBox[{"gate", "[", "\[Omega]tRandom", "]"}], "]"}], "]"}]}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"makeDipoleList", "::", "gate"}], ",", 
            RowBox[{"OptionValue", "[", "Gate", "]"}], ",", "\[Omega]tRandom",
             ",", 
            RowBox[{"OptionValue", "[", "nGate", "]"}], ",", 
            RowBox[{"gate", "[", "\[Omega]tRandom", "]"}]}], "]"}], ";", 
          RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], "\[IndentingNewLine]", 
      "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"setPreintegral", "[", 
       RowBox[{
       "integralVariable_", ",", "listVariable_", ",", "preintegrand_", ",", 
        "dimensions_", ",", "integrateWithoutGradient_", ",", "parametric_"}],
        "]"}], ":=", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "VectorPotentialGradient", "]"}], "=!=",
           "None"}], "||", 
         RowBox[{"TrueQ", "[", "integrateWithoutGradient", "]"}]}], ",", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Vector", " ", "potential", " ", "gradient", " ", "specified"}], 
          ",", " ", 
          RowBox[{
          "or", " ", "integral", " ", "variable", " ", "does", " ", "not", 
           " ", "depend", " ", "on", " ", "it"}], ",", " ", 
          RowBox[{"so", " ", "integrate"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Which", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"OptionValue", "[", "Preintegrals", "]"}], "\[Equal]", 
            "\"\<Analytic\>\""}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"integralVariable", "[", 
              RowBox[{"t_", ",", "tt_"}], "]"}], "=", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"#", "/.", 
                   RowBox[{"{", 
                    RowBox[{"\[Tau]", "\[Rule]", "t"}], "}"}]}], ")"}], "-", 
                 RowBox[{"(", 
                  RowBox[{"#", "/.", 
                   RowBox[{"{", 
                    RowBox[{"\[Tau]", "\[Rule]", "tt"}], "}"}]}], ")"}]}], 
                ")"}], "&"}], "[", 
              RowBox[{"Integrate", "[", 
               RowBox[{
                RowBox[{"preintegrand", "[", 
                 RowBox[{"\[Tau]", ",", "tt"}], "]"}], ",", "\[Tau]"}], "]"}],
               "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
           ",", 
           RowBox[{
            RowBox[{"OptionValue", "[", "Preintegrals", "]"}], "\[Equal]", 
            "\"\<Numeric\>\""}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Which", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"TrueQ", "[", 
               RowBox[{"Not", "[", "parametric", "]"}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"integralVariable", "[", 
                 RowBox[{"t_", ",", "tt_"}], "]"}], "=", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"innerVariable", "[", "t", "]"}], "-", 
                   RowBox[{"innerVariable", "[", "tt", "]"}]}], "/.", 
                  RowBox[{"First", "[", "\[IndentingNewLine]", 
                   RowBox[{"NDSolve", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"innerVariable", "'"}], "[", "\[Tau]", "]"}], 
                    "\[Equal]", 
                    RowBox[{"preintegrand", "[", "\[Tau]", "]"}]}], ",", 
                    RowBox[{
                    RowBox[{"innerVariable", "[", "tInit", "]"}], "\[Equal]", 
                    
                    RowBox[{"ConstantArray", "[", 
                    RowBox[{"0", ",", "dimensions"}], "]"}]}]}], "}"}], ",", 
                    "innerVariable", ",", 
                    RowBox[{"{", 
                    RowBox[{"\[Tau]", ",", "tInit", ",", "tFinal"}], "}"}]}], 
                    "]"}], "\[IndentingNewLine]", "]"}]}], ")"}]}], ";"}], 
              "\[IndentingNewLine]", ",", "True", ",", 
              RowBox[{"(*", 
               RowBox[{
               "change", " ", "\[Tau]", " ", "to", " ", "protected", " ", 
                "\[Tau]pre", " ", "before", " ", 
                RowBox[{"you", "'"}], "re", " ", "done"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Message", "[", 
                RowBox[{"makeDipoleList", "::", "numnondip"}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"Block", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"matrixpreintegrand", ",", "innerVariable"}], "}"}],
                  ",", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"matrixpreintegrand", "[", 
                    RowBox[{"indices_", ",", 
                    RowBox[{"t_", "?", "NumericQ"}], ",", 
                    RowBox[{"tt_", "?", "NumericQ"}]}], "]"}], ":=", 
                   RowBox[{
                    RowBox[{"preintegrand", "[", 
                    RowBox[{"t", ",", "tt"}], "]"}], "\[LeftDoubleBracket]", 
                    RowBox[{
                    RowBox[{"##", "&"}], "@@", "indices"}], 
                    "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"integralVariable", "[", 
                    RowBox[{"t_", ",", "tt_"}], "]"}], "=", 
                   RowBox[{"Array", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"innerVariable", "[", "##", "]"}], "[", 
                    RowBox[{
                    RowBox[{"t", "-", "tt"}], ",", "tt"}], "]"}], "/.", 
                    RowBox[{"First", "@", 
                    RowBox[{"NDSolve", "[", 
                    RowBox[{
                    RowBox[{"{", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"D", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"innerVariable", "[", "##", "]"}], "[", 
                    RowBox[{"\[Tau]", ",", "tt"}], "]"}], ",", "\[Tau]"}], 
                    "]"}], "\[Equal]", 
                    RowBox[{
                    RowBox[{"matrixpreintegrand", "[", 
                    RowBox[{
                    RowBox[{"{", "##", "}"}], ",", 
                    RowBox[{"tt", "+", "\[Tau]"}], ",", "tt"}], "]"}], "+", 
                    RowBox[{
                    FractionBox["0.00001", "\[Omega]"], 
                    RowBox[{
                    SubsuperscriptBox["\[Del]", 
                    RowBox[{"{", 
                    RowBox[{"\[Tau]", ",", "tt"}], "}"}], "2"], 
                    RowBox[{
                    RowBox[{"innerVariable", "[", "##", "]"}], "[", 
                    RowBox[{"\[Tau]", ",", "tt"}], "]"}]}]}]}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"innerVariable", "[", "##", "]"}], "[", 
                    RowBox[{"0", ",", "tt"}], "]"}], "\[Equal]", "0"}]}], 
                    "\[IndentingNewLine]", "}"}], ",", 
                    RowBox[{"innerVariable", "[", "##", "]"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"\[Tau]", ",", "0", ",", 
                    RowBox[{"tFinal", "-", "tInit"}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"tt", ",", "tInit", ",", "tFinal"}], "}"}]}], 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"\[Tau]", ",", "tt"}], "}"}], "\[Element]", 
                    RowBox[{"Triangle", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"tInit", ",", "tInit"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"tInit", ",", "tFinal"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"tFinal", ",", "tInit"}], "}"}]}], "}"}], 
                    "]"}]}]}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{
                    "Restricted", " ", "triangular", " ", "domain", " ", 
                    "currently", " ", "not", " ", "working", " ", "until", 
                    " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"mm", ".", "se"}], "/", "q"}], "/", "105687"}], 
                    " ", "is", " ", "resolved"}], " ", "-", " ", 
                    RowBox[{"this", " ", "causes", " ", "the", " ", 
                    RowBox[{"makeDipoleList", "::", "numnondip"}], " ", 
                    "error", " ", 
                    RowBox[{"here", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
                    "]"}]}]}], "\[IndentingNewLine]", ")"}], "&"}], ",", 
                    "dimensions"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", 
                "]"}]}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
        RowBox[{
         RowBox[{"OptionValue", "[", "VectorPotentialGradient", "]"}], "===", 
         "None"}], ",", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Vector", " ", "potential", " ", "gradient", " ", "has", " ", "not",
            " ", "been", " ", "specified"}], ",", " ", 
          RowBox[{
          "and", " ", "integral", " ", "variable", " ", "depends", " ", "on", 
           " ", "it"}], ",", " ", 
          RowBox[{
          "so", " ", "return", " ", "appropriate", " ", "zero", " ", 
           "matrix"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"integralVariable", "[", "t_", "]"}], "=", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0", ",", "dimensions"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"integralVariable", "[", 
           RowBox[{"t_", ",", "tt_"}], "]"}], "=", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0", ",", "dimensions"}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Apply", "[", 
      RowBox[{"setPreintegral", ",", 
       RowBox[{"(", GridBox[{
          {"AInt", "AIntList", 
           RowBox[{
            RowBox[{"A", "[", "#1", "]"}], "&"}], 
           RowBox[{"{", 
            RowBox[{"Length", "[", 
             RowBox[{"A", "[", "tInit", "]"}], "]"}], "}"}], "True", 
           "False"},
          {"A2Int", "A2IntList", 
           RowBox[{
            RowBox[{
             RowBox[{"A", "[", "#1", "]"}], ".", 
             RowBox[{"A", "[", "#1", "]"}]}], "&"}], 
           RowBox[{"{", "}"}], "True", "False"},
          {"GAInt", "GAIntList", 
           RowBox[{
            RowBox[{"GA", "[", "#1", "]"}], "&"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"A", "[", "tInit", "]"}], "]"}], ",", 
             RowBox[{"Length", "[", 
              RowBox[{"A", "[", "tInit", "]"}], "]"}]}], "}"}], "False", 
           "False"},
          {"GAdotAInt", "GAdotAIntList", 
           RowBox[{
            RowBox[{
             RowBox[{"GA", "[", "#1", "]"}], ".", 
             RowBox[{"A", "[", "#1", "]"}]}], "&"}], 
           RowBox[{"{", 
            RowBox[{"Length", "[", 
             RowBox[{"A", "[", "tInit", "]"}], "]"}], "}"}], "False", "False"},
          {"AdotGAInt", "AdotGAIntList", 
           RowBox[{
            RowBox[{
             RowBox[{"A", "[", "#1", "]"}], ".", 
             RowBox[{"GA", "[", "#1", "]"}]}], "&"}], 
           RowBox[{"{", 
            RowBox[{"Length", "[", 
             RowBox[{"A", "[", "tInit", "]"}], "]"}], "}"}], "False", "False"},
          {"GAIntInt", "GAIntIntList", 
           RowBox[{
            RowBox[{"GAInt", "[", 
             RowBox[{"#1", ",", "#2"}], "]"}], "&"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"A", "[", "tInit", "]"}], "]"}], ",", 
             RowBox[{"Length", "[", 
              RowBox[{"A", "[", "tInit", "]"}], "]"}]}], "}"}], "False", 
           "True"},
          {"AdotGAdotAInt", "AdotGAdotAIntList", 
           RowBox[{
            RowBox[{
             RowBox[{"A", "[", "#1", "]"}], ".", 
             RowBox[{"GAdotAInt", "[", 
              RowBox[{"#1", ",", "#2"}], "]"}]}], "&"}], 
           RowBox[{"{", "}"}], "False", "True"},
          {"bigPScorrectionInt", "bigPScorrectionIntList", 
           RowBox[{
            RowBox[{
             RowBox[{"GAdotAInt", "[", 
              RowBox[{"#1", ",", "#2"}], "]"}], "+", 
             RowBox[{
              RowBox[{"A", "[", "#1", "]"}], ".", 
              RowBox[{"GAInt", "[", 
               RowBox[{"#1", ",", "#2"}], "]"}]}]}], "&"}], 
           RowBox[{"{", 
            RowBox[{"Length", "[", 
             RowBox[{"A", "[", "tInit", "]"}], "]"}], "}"}], "False", "True"}
         },
         GridBoxAlignment->{"Columns" -> {{Left}}}], ")"}], ",", 
       RowBox[{"{", "1", "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          SubsuperscriptBox["\[Integral]", 
           SubscriptBox["t", "0"], "t"], 
          RowBox[{"A", 
           RowBox[{"(", "\[Tau]", ")"}], 
           RowBox[{"\[DifferentialD]", "\[Tau]"}]}]}], ",", 
         RowBox[{
          SubsuperscriptBox["\[Integral]", 
           SubscriptBox["t", "0"], "t"], 
          RowBox[{"A", 
           SuperscriptBox[
            RowBox[{"(", "\[Tau]", ")"}], "2"], 
           RowBox[{"\[DifferentialD]", "\[Tau]"}]}]}], ",", 
         RowBox[{
          SubsuperscriptBox["\[Integral]", 
           SubscriptBox["t", "0"], "t"], 
          RowBox[{
           RowBox[{"\[Del]", "A"}], 
           RowBox[{"(", "\[Tau]", ")"}], 
           RowBox[{"\[DifferentialD]", "\[Tau]"}]}]}], ",", 
         RowBox[{
          SubsuperscriptBox["\[Integral]", 
           SubscriptBox["t", "0"], "t"], 
          RowBox[{
           RowBox[{"\[Del]", "A"}], 
           RowBox[{
            RowBox[{"(", "\[Tau]", ")"}], "\[CenterDot]", "A"}], 
           RowBox[{"(", "\[Tau]", ")"}], 
           RowBox[{"\[DifferentialD]", "\[Tau]"}]}]}], ",", 
         RowBox[{
          SubsuperscriptBox["\[Integral]", 
           SubscriptBox["t", "0"], "t"], 
          RowBox[{"A", 
           RowBox[{
            RowBox[{"(", "\[Tau]", ")"}], "\[CenterDot]", 
            RowBox[{"\[Del]", "A"}]}], 
           RowBox[{"(", "\[Tau]", ")"}], 
           RowBox[{"\[DifferentialD]", "\[Tau]"}]}]}], ",", 
         RowBox[{
          SubsuperscriptBox["\[Integral]", 
           RowBox[{"t", "'"}], "t"], 
          RowBox[{
           SubsuperscriptBox["\[Integral]", 
            RowBox[{"t", "'"}], "\[Tau]"], 
           RowBox[{
            RowBox[{"\[Del]", "A"}], 
            RowBox[{"(", 
             RowBox[{"\[Tau]", "'"}], ")"}], 
            RowBox[{"\[DifferentialD]", 
             RowBox[{"\[Tau]", "'"}]}], 
            RowBox[{"\[DifferentialD]", "\[Tau]"}]}]}]}], ",", 
         RowBox[{
          SubsuperscriptBox["\[Integral]", 
           RowBox[{"t", "'"}], "t"], 
          RowBox[{
           SubscriptBox["A", "k"], 
           RowBox[{
            RowBox[{"(", "\[Tau]", ")"}], "\[CenterDot]", 
            RowBox[{
             SubsuperscriptBox["\[Integral]", 
              RowBox[{"t", "'"}], "\[Tau]"], 
             RowBox[{
              RowBox[{
               SubscriptBox["\[PartialD]", "k"], 
               SubscriptBox["A", "j"]}], 
              RowBox[{"(", 
               RowBox[{"\[Tau]", "'"}], ")"}], 
              SubscriptBox["A", "j"], 
              RowBox[{"(", 
               RowBox[{"\[Tau]", "'"}], ")"}], 
              RowBox[{"\[DifferentialD]", 
               RowBox[{"\[Tau]", "'"}]}], 
              RowBox[{"\[DifferentialD]", "\[Tau]"}]}]}]}]}]}], ",", 
         RowBox[{
          SubsuperscriptBox["\[Integral]", 
           RowBox[{"t", "'"}], "t"], 
          RowBox[{
           SubsuperscriptBox["\[Integral]", 
            RowBox[{"t", "'"}], "\[Tau]"], 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               SubscriptBox["A", "k"], 
               RowBox[{"(", 
                RowBox[{"\[Tau]", "'"}], ")"}], 
               RowBox[{
                SubscriptBox["\[PartialD]", "j"], 
                SubscriptBox["A", "k"]}], 
               RowBox[{"(", 
                RowBox[{"\[Tau]", "'"}], ")"}]}], "+", 
              RowBox[{
               SubscriptBox["A", "k"], 
               RowBox[{"(", "\[Tau]", ")"}], 
               RowBox[{
                SubscriptBox["\[PartialD]", "k"], 
                SubscriptBox["A", "j"]}], 
               RowBox[{"(", 
                RowBox[{"\[Tau]", "'"}], ")"}]}]}], ")"}], 
            RowBox[{"\[DifferentialD]", 
             RowBox[{"\[Tau]", "'"}]}], 
            RowBox[{"\[DifferentialD]", "\[Tau]"}]}]}]}]}], "}"}], ";"}], 
      "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Displaced", " ", "momentum"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pi", "[", 
       RowBox[{"p_", ",", "t_", ",", "tt_"}], "]"}], ":=", 
      RowBox[{"p", "+", 
       RowBox[{"A", "[", "t", "]"}], "-", 
       RowBox[{
        RowBox[{"GAInt", "[", 
         RowBox[{"t", ",", "tt"}], "]"}], ".", "p"}], "-", 
       RowBox[{"GAdotAInt", "[", 
        RowBox[{"t", ",", "tt"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Stationary", " ", "momentum", " ", "and", " ", "action"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ps", "[", 
       RowBox[{"t_", ",", "tt_"}], "]"}], ":=", 
      RowBox[{
       RowBox[{"ps", "[", 
        RowBox[{"t", ",", "tt"}], "]"}], "=", 
       RowBox[{
        RowBox[{"-", 
         FractionBox["1", 
          RowBox[{"t", "-", "tt", "-", 
           RowBox[{"\[ImaginaryI]", " ", "\[Epsilon]"}]}]]}], 
        RowBox[{
         RowBox[{"Inverse", "[", 
          RowBox[{
           RowBox[{"IdentityMatrix", "[", 
            RowBox[{"Length", "[", 
             RowBox[{"A", "[", "tInit", "]"}], "]"}], "]"}], "-", 
           RowBox[{
            FractionBox["1", 
             RowBox[{"t", "-", "tt", "-", 
              RowBox[{"\[ImaginaryI]", " ", "\[Epsilon]"}]}]], 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"GAIntInt", "[", 
               RowBox[{"t", ",", "tt"}], "]"}], "+", 
              RowBox[{
               RowBox[{"GAIntInt", "[", 
                RowBox[{"t", ",", "tt"}], "]"}], "\[Transpose]"}]}], 
             ")"}]}]}], "]"}], ".", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"AInt", "[", 
            RowBox[{"t", ",", "tt"}], "]"}], "-", 
           RowBox[{"bigPScorrectionInt", "[", 
            RowBox[{"t", ",", "tt"}], "]"}]}], ")"}]}]}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"S", "[", 
       RowBox[{"t_", ",", "tt_"}], "]"}], ":=", 
      RowBox[{
       RowBox[{
        FractionBox["1", "2"], 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"Norm", "[", 
            RowBox[{"ps", "[", 
             RowBox[{"t", ",", "tt"}], "]"}], "]"}], "2"], "+", 
          SuperscriptBox["\[Kappa]", "2"]}], ")"}], 
        RowBox[{"(", 
         RowBox[{"t", "-", "tt"}], ")"}]}], "+", 
       RowBox[{
        RowBox[{"ps", "[", 
         RowBox[{"t", ",", "tt"}], "]"}], ".", 
        RowBox[{"AInt", "[", 
         RowBox[{"t", ",", "tt"}], "]"}]}], "+", 
       RowBox[{
        FractionBox["1", "2"], 
        RowBox[{"A2Int", "[", 
         RowBox[{"t", ",", "tt"}], "]"}]}], "-", 
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"ps", "[", 
           RowBox[{"t", ",", "tt"}], "]"}], ".", 
          RowBox[{"GAIntInt", "[", 
           RowBox[{"t", ",", "tt"}], "]"}], ".", 
          RowBox[{"ps", "[", 
           RowBox[{"t", ",", "tt"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"ps", "[", 
           RowBox[{"t", ",", "tt"}], "]"}], ".", 
          RowBox[{"bigPScorrectionInt", "[", 
           RowBox[{"t", ",", "tt"}], "]"}]}], "+", 
         RowBox[{"AdotGAdotAInt", "[", 
          RowBox[{"t", ",", "tt"}], "]"}]}], "\[IndentingNewLine]", ")"}]}]}],
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"integrand", "[", 
       RowBox[{"t_", ",", "\[Tau]_"}], "]"}], "=", 
      RowBox[{"\[ImaginaryI]", 
       SuperscriptBox[
        RowBox[{"(", 
         FractionBox[
          RowBox[{"2", "\[Pi]"}], 
          RowBox[{"\[Epsilon]", "+", 
           RowBox[{"\[ImaginaryI]", " ", "\[Tau]"}]}]], ")"}], 
        RowBox[{"3", "/", "2"}]], 
       RowBox[{
        RowBox[{"dipole", "[", 
         RowBox[{
          RowBox[{"pi", "[", 
           RowBox[{
            RowBox[{"ps", "[", 
             RowBox[{"t", ",", 
              RowBox[{"t", "-", "\[Tau]"}]}], "]"}], ",", "t", ",", 
            RowBox[{"t", "-", "\[Tau]"}]}], "]"}], ",", "\[Kappa]"}], "]"}], 
        "\[Conjugate]"}], "\[Times]", 
       RowBox[{
        RowBox[{"dipole", "[", 
         RowBox[{
          RowBox[{"pi", "[", 
           RowBox[{
            RowBox[{"ps", "[", 
             RowBox[{"t", ",", 
              RowBox[{"t", "-", "\[Tau]"}]}], "]"}], ",", 
            RowBox[{"t", "-", "\[Tau]"}], ",", 
            RowBox[{"t", "-", "\[Tau]"}]}], "]"}], ",", "\[Kappa]"}], "]"}], 
        ".", 
        RowBox[{"F", "[", 
         RowBox[{"t", "-", "\[Tau]"}], "]"}]}], 
       RowBox[{"Exp", "[", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], " ", 
         RowBox[{"S", "[", 
          RowBox[{"t", ",", 
           RowBox[{"t", "-", "\[Tau]"}]}], "]"}]}], "]"}], 
       RowBox[{"gate", "[", 
        RowBox[{"\[Omega]", " ", "\[Tau]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Debugging", " ", 
        RowBox[{"constructs", ".", " ", "Verbose"}]}], "\[Rule]", 
       RowBox[{
        RowBox[{
        "1", " ", "prints", " ", "information", " ", "about", " ", "the", " ",
          "internal", " ", 
         RowBox[{"functions", ".", " ", "Verbose"}]}], "\[Rule]", 
        RowBox[{
        "2", " ", "returns", " ", "all", " ", "the", " ", "relevant", " ", 
         "internal", " ", "functions", " ", "and", " ", 
         RowBox[{"stops", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Which", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"OptionValue", "[", "Verbose", "]"}], "\[Equal]", "1"}], ",", 
       
       RowBox[{"Information", "/@", 
        RowBox[{"{", 
         RowBox[{
         "A", ",", "GA", ",", "ps", ",", "pi", ",", "S", ",", "AInt", ",", 
          "A2Int", ",", "GAInt", ",", "GAdotAInt", ",", "AdotGAInt", ",", 
          "GAIntInt", ",", "bigPScorrectionInt", ",", "AdotGAdotAInt"}], 
         "}"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"OptionValue", "[", "Verbose", "]"}], "\[Equal]", "2"}], ",", 
       
       RowBox[{"Return", "[", 
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"t", "=", "Global`t"}], ",", 
            RowBox[{"tt", "=", "Global`tt"}], ",", 
            RowBox[{"p", "=", "Global`t"}], ",", 
            RowBox[{"\[Tau]", "=", "Global`\[Tau]"}]}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"A", "[", "t", "]"}], ",", 
            RowBox[{"GA", "[", "t", "]"}], ",", 
            RowBox[{"ps", "[", 
             RowBox[{"t", ",", "tt"}], "]"}], ",", 
            RowBox[{"pi", "[", 
             RowBox[{"p", ",", "t", ",", "tt"}], "]"}], ",", 
            RowBox[{"S", "[", 
             RowBox[{"t", ",", "tt"}], "]"}], ",", 
            RowBox[{"AInt", "[", "t", "]"}], ",", 
            RowBox[{"AInt", "[", 
             RowBox[{"t", ",", "tt"}], "]"}], ",", 
            RowBox[{"A2Int", "[", "t", "]"}], ",", 
            RowBox[{"A2Int", "[", 
             RowBox[{"t", ",", "tt"}], "]"}], ",", 
            RowBox[{"GAInt", "[", "t", "]"}], ",", 
            RowBox[{"GAInt", "[", 
             RowBox[{"t", ",", "tt"}], "]"}], ",", 
            RowBox[{"GAdotAInt", "[", "t", "]"}], ",", 
            RowBox[{"GAdotAInt", "[", 
             RowBox[{"t", ",", "tt"}], "]"}], ",", 
            RowBox[{"AdotGAInt", "[", "t", "]"}], ",", 
            RowBox[{"AdotGAInt", "[", 
             RowBox[{"t", ",", "tt"}], "]"}], ",", 
            RowBox[{"GAIntInt", "[", "t", "]"}], ",", 
            RowBox[{"GAIntInt", "[", 
             RowBox[{"t", ",", "tt"}], "]"}], ",", 
            RowBox[{"bigPScorrectionInt", "[", "t", "]"}], ",", 
            RowBox[{"bigPScorrectionInt", "[", 
             RowBox[{"t", ",", "tt"}], "]"}], ",", 
            RowBox[{"AdotGAdotAInt", "[", "t", "]"}], ",", 
            RowBox[{"AdotGAdotAInt", "[", 
             RowBox[{"t", ",", "tt"}], "]"}], ",", 
            RowBox[{"integrand", "[", 
             RowBox[{"t", ",", "\[Tau]"}], "]"}]}], "}"}]}], "]"}], "]"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Numerical", " ", "integration", " ", "loop"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"(", 
      RowBox[{"dipoleList", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "ReportingFunction", "]"}], "[", 
          "\[IndentingNewLine]", 
          RowBox[{"\[Delta]tint", " ", 
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{"(", "\[IndentingNewLine]", 
              RowBox[{"integrand", "[", 
               RowBox[{"t", ",", "\[Tau]"}], "]"}], "\[IndentingNewLine]", 
              ")"}], ",", 
             RowBox[{"{", 
              RowBox[{"\[Tau]", ",", "0", ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"OptionValue", "[", "Preintegrals", "]"}], 
                  "\[Equal]", "\"\<Analytic\>\""}], ",", "tGate", ",", 
                 RowBox[{"Min", "[", 
                  RowBox[{
                   RowBox[{"t", "-", "tInit"}], ",", "tGate"}], "]"}]}], 
                "]"}], ",", "\[Delta]tint"}], "}"}]}], "]"}]}], 
          "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "tInit", ",", "tFinal", ",", "\[Delta]t"}], 
          "}"}]}], "]"}]}], ")"}], ";", "\[IndentingNewLine]", 
     "dipoleList"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True],

Cell[BoxData["\<\"IntegrationPointsPerCycle is an option for makeDipoleList \
which controls the number of points per cycle to use for the integration. Set \
to Automatic, to follow PointsPerCycle, or to an integer.\"\>"], "Output"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"EndPackage", "[", "]"}]], "Input",
 InitializationCell->True]
}, Open  ]]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
NotebookEventActions->{{"MenuCommand", "Save"} :> (NotebookWrite[
     Part[
      Cells[CellTags -> "version-definition"], 1], 
     Cell[
      BoxData[
       RowBox[{
         StringJoin[
         "RBSFAversion::usage=\"RBSFAversion[] prints the current version of \
the RB-SFA package in use and its \
timestamp.\";\[IndentingNewLine]Begin[\"`Private`\"];\[IndentingNewLine]\
RBSFAversion[]=\"", 
          First[
           StringSplit[
            Part[
             Select[
              Flatten[
               ReplaceAll[
                NotebookRead[
                 Part[
                  Cells[CellTags -> "version-definition"], 1]], {
                Cell -> List, BoxData -> List, RowBox -> List}]], Quiet[
               StringContainsQ[#, "RB-SFA v"]]& ], 1], {"\"", ","}]], ", ", 
          DateString[], "\";\[IndentingNewLine]End[];"]}]], "Input", 
      InitializationCell -> True, CellTags -> "version-definition"], None]; 
   SelectionMove[
     EvaluationNotebook[], Previous, Character, 1]; NotebookSave[]), 
  PassEventsDown -> True},
WindowSize->{1855, 1056},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
PrintingCopies->1,
PrintingStartingPageNumber->1,
PrintingPageRange->{Automatic, Automatic},
PageHeaders->{{None, None, 
   Cell[
    TextData[{
     "RB", "-", "SFA", ":", " ", "Rotating", " ", "Bicircular", " ", "HHG", 
      " ", "in", " ", "the", " ", "Strong", " ", "Field", " ", 
      "Approximation", "|", "   ", 
      StyleBox[
       CounterBox["Page"], "PageNumber"]}], "Header", 
    CellMargins -> {{Inherited, 0}, {Inherited, Inherited}}]}, {None, None, 
   Cell[
    TextData[{
     "RB", "-", "SFA", ":", " ", "Rotating", " ", "Bicircular", " ", "HHG", 
      " ", "in", " ", "the", " ", "Strong", " ", "Field", " ", 
      "Approximation", "|", "   ", 
      StyleBox[
       CounterBox["Page"], "PageNumber"]}], "Header", 
    CellMargins -> {{Inherited, 0}, {Inherited, Inherited}}]}},
PageFooters->{{None, None, None}, {None, None, None}},
PageHeaderLines->{False, False},
PageFooterLines->{False, False},
PrintingOptions->{"FacingPages"->True,
"FirstPageFace"->Right,
"FirstPageFooter"->True,
"FirstPageHeader"->False,
"PaperOrientation"->"Portrait",
"PaperSize"->{594.75, 842.25},
"PostScriptOutputFile"->"~/Desktop/print.pdf",
"PrintingMargins"->{{19.84251968503, 19.84251968503}, {72., 72.}}},
PrivateNotebookOptions->{"FileOutlineCache"->False},
ShowSelection->True,
TrackCellChangeTimes->False,
FrontEndVersion->"10.1 for Linux x86 (64-bit) (March 23, 2015)",
StyleDefinitions->Notebook[{
   Cell[
    StyleData[StyleDefinitions -> "Default.nb"]], 
   Cell[
    StyleData["Code"], FontWeight -> "Plain", FontSlant -> "Plain", 
    FontTracking -> "Plain", 
    FontVariations -> {
     "Outline" -> False, "Shadow" -> False, "StrikeThrough" -> False, 
      "Underline" -> False}]}, Visible -> False, FrontEndVersion -> 
  "10.1 for Linux x86 (64-bit) (March 23, 2015)", StyleDefinitions -> 
  "PrivateStylesheetFormatting.nb"]
]

